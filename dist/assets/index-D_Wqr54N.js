var Ar=Object.defineProperty;var Or=(n,t,s)=>t in n?Ar(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s;var vt=(n,t,s)=>Or(n,typeof t!="symbol"?t+"":t,s);import{r as C,a as Rr,b as $r,c as he,d as Dr}from"./vendor-CM02gYGk.js";import{I as Lr,A as Ur,X as Qt,C as _t,a as At,W as Fr,b as Br,d as Ve,M as Mr,B as fs,U as ce,S as xs,L as qr,e as zr,P as Pe,f as ht,g as Be,T as Me,D as We,h as st,i as Vr,c as gs,j as Wr,k as Ot,l as Gr,m as Jr,n as Ae,o as at,p as ge,q as ue,r as Kr,s as Yt,E as Ie,t as Cs,F as Hr,u as Mt,R as Qr,v as St,w as Yr,x as Xr,y as Xs,z as Xt,G as Es,H as Ts,J as Je,K as Ps,N as Zr,O as ea}from"./ui-k5zTTvLy.js";import{N as ta,a as ps,B as sa,R as ra,b as me}from"./router-DVwqdApC.js";import{R as qe,A as aa,C as kt,X as Ct,Y as Et,T as ze,a as Is,P as vs,b as ys,c as bs,B as Zs,d as Zt,L as na,e as ia}from"./charts-rZyxw3VM.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=s(a);fetch(a.href,i)}})();var er={exports:{}},Rt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oa=C,la=Symbol.for("react.element"),ca=Symbol.for("react.fragment"),da=Object.prototype.hasOwnProperty,ua=oa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ha={key:!0,ref:!0,__self:!0,__source:!0};function tr(n,t,s){var r,a={},i=null,o=null;s!==void 0&&(i=""+s),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(o=t.ref);for(r in t)da.call(t,r)&&!ha.hasOwnProperty(r)&&(a[r]=t[r]);if(n&&n.defaultProps)for(r in t=n.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:la,type:n,key:i,ref:o,props:a,_owner:ua.current}}Rt.Fragment=ca;Rt.jsx=tr;Rt.jsxs=tr;er.exports=Rt;var e=er.exports,sr,As=Rr;sr=As.createRoot,As.hydrateRoot;const ma="modulepreload",fa=function(n){return"/"+n},Os={},ft=function(t,s,r){let a=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));a=Promise.allSettled(s.map(c=>{if(c=fa(c),c in Os)return;Os[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":ma,u||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),u)return new Promise((g,p)=>{h.addEventListener("load",g),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return a.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return t().catch(i)})},xa=n=>{let t;return n?t=n:typeof fetch>"u"?t=(...s)=>ft(async()=>{const{default:r}=await Promise.resolve().then(()=>nt);return{default:r}},void 0).then(({default:r})=>r(...s)):t=fetch,(...s)=>t(...s)};class js extends Error{constructor(t,s="FunctionsError",r){super(t),this.name=s,this.context=r}}class ga extends js{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class Rs extends js{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class $s extends js{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var es;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(es||(es={}));var pa=function(n,t,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):a(d.value).then(l,c)}u((r=r.apply(n,t||[])).next())})};class va{constructor(t,{headers:s={},customFetch:r,region:a=es.Any}={}){this.url=t,this.headers=s,this.region=a,this.fetch=xa(r)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t,s={}){var r;return pa(this,void 0,void 0,function*(){try{const{headers:a,method:i,body:o}=s;let l={},{region:c}=s;c||(c=this.region);const u=new URL(`${this.url}/${t}`);c&&c!=="any"&&(l["x-region"]=c,u.searchParams.set("forceFunctionRegion",c));let d;o&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",d=o):typeof o=="string"?(l["Content-Type"]="text/plain",d=o):typeof FormData<"u"&&o instanceof FormData?d=o:(l["Content-Type"]="application/json",d=JSON.stringify(o)));const h=yield this.fetch(u.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),a),body:d}).catch(E=>{throw new ga(E)}),g=h.headers.get("x-relay-error");if(g&&g==="true")throw new Rs(h);if(!h.ok)throw new $s(h);let p=((r=h.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),w;return p==="application/json"?w=yield h.json():p==="application/octet-stream"?w=yield h.blob():p==="text/event-stream"?w=h:p==="multipart/form-data"?w=yield h.formData():w=yield h.text(),{data:w,error:null,response:h}}catch(a){return{data:null,error:a,response:a instanceof $s||a instanceof Rs?a.context:void 0}}})}}var le={},ws={},$t={},xt={},Dt={},Lt={},ya=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof globalThis<"u")return globalThis;throw new Error("unable to locate global object")},rt=ya();const ba=rt.fetch,rr=rt.fetch.bind(rt),ar=rt.Headers,ja=rt.Request,wa=rt.Response,nt=Object.freeze(Object.defineProperty({__proto__:null,Headers:ar,Request:ja,Response:wa,default:rr,fetch:ba},Symbol.toStringTag,{value:"Module"})),Na=$r(nt);var Ut={};Object.defineProperty(Ut,"__esModule",{value:!0});let _a=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};Ut.default=_a;var nr=he&&he.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Lt,"__esModule",{value:!0});const Sa=nr(Na),ka=nr(Ut);let Ca=class{constructor(t){var s,r;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(s=t.shouldThrowOnError)!==null&&s!==void 0?s:!1,this.signal=t.signal,this.isMaybeSingle=(r=t.isMaybeSingle)!==null&&r!==void 0?r:!1,t.fetch?this.fetch=t.fetch:typeof fetch>"u"?this.fetch=Sa.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,s){return this.headers=new Headers(this.headers),this.headers.set(t,s),this}then(t,s){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const r=this.fetch;let a=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,l,c,u;let d=null,h=null,g=null,p=i.status,w=i.statusText;if(i.ok){if(this.method!=="HEAD"){const I=await i.text();I===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((o=this.headers.get("Accept"))===null||o===void 0)&&o.includes("application/vnd.pgrst.plan+text"))?h=I:h=JSON.parse(I))}const N=(l=this.headers.get("Prefer"))===null||l===void 0?void 0:l.match(/count=(exact|planned|estimated)/),f=(c=i.headers.get("content-range"))===null||c===void 0?void 0:c.split("/");N&&f&&f.length>1&&(g=parseInt(f[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(h)&&(h.length>1?(d={code:"PGRST116",details:`Results contain ${h.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},h=null,g=null,p=406,w="Not Acceptable"):h.length===1?h=h[0]:h=null)}else{const N=await i.text();try{d=JSON.parse(N),Array.isArray(d)&&i.status===404&&(h=[],d=null,p=200,w="OK")}catch{i.status===404&&N===""?(p=204,w="No Content"):d={message:N}}if(d&&this.isMaybeSingle&&(!((u=d==null?void 0:d.details)===null||u===void 0)&&u.includes("0 rows"))&&(d=null,p=200,w="OK"),d&&this.shouldThrowOnError)throw new ka.default(d)}return{error:d,data:h,count:g,status:p,statusText:w}});return this.shouldThrowOnError||(a=a.catch(i=>{var o,l,c;return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(l=i==null?void 0:i.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(c=i==null?void 0:i.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),a.then(t,s)}returns(){return this}overrideTypes(){return this}};Lt.default=Ca;var Ea=he&&he.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Dt,"__esModule",{value:!0});const Ta=Ea(Lt);let Pa=class extends Ta.default{select(t){let s=!1;const r=(t??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:s=!0,nullsFirst:r,foreignTable:a,referencedTable:i=a}={}){const o=i?`${i}.order`:"order",l=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${l?`${l},`:""}${t}.${s?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:s,referencedTable:r=s}={}){const a=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(a,`${t}`),this}range(t,s,{foreignTable:r,referencedTable:a=r}={}){const i=typeof a>"u"?"offset":`${a}.offset`,o=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(i,`${t}`),this.url.searchParams.set(o,`${s-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:s=!1,settings:r=!1,buffers:a=!1,wal:i=!1,format:o="text"}={}){var l;const c=[t?"analyze":null,s?"verbose":null,r?"settings":null,a?"buffers":null,i?"wal":null].filter(Boolean).join("|"),u=(l=this.headers.get("Accept"))!==null&&l!==void 0?l:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${o}; for="${u}"; options=${c};`),o==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};Dt.default=Pa;var Ia=he&&he.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(xt,"__esModule",{value:!0});const Aa=Ia(Dt);let Oa=class extends Aa.default{eq(t,s){return this.url.searchParams.append(t,`eq.${s}`),this}neq(t,s){return this.url.searchParams.append(t,`neq.${s}`),this}gt(t,s){return this.url.searchParams.append(t,`gt.${s}`),this}gte(t,s){return this.url.searchParams.append(t,`gte.${s}`),this}lt(t,s){return this.url.searchParams.append(t,`lt.${s}`),this}lte(t,s){return this.url.searchParams.append(t,`lte.${s}`),this}like(t,s){return this.url.searchParams.append(t,`like.${s}`),this}likeAllOf(t,s){return this.url.searchParams.append(t,`like(all).{${s.join(",")}}`),this}likeAnyOf(t,s){return this.url.searchParams.append(t,`like(any).{${s.join(",")}}`),this}ilike(t,s){return this.url.searchParams.append(t,`ilike.${s}`),this}ilikeAllOf(t,s){return this.url.searchParams.append(t,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(t,s){return this.url.searchParams.append(t,`ilike(any).{${s.join(",")}}`),this}is(t,s){return this.url.searchParams.append(t,`is.${s}`),this}in(t,s){const r=Array.from(new Set(s)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(t,`in.(${r})`),this}contains(t,s){return typeof s=="string"?this.url.searchParams.append(t,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(t,`cs.{${s.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(s)}`),this}containedBy(t,s){return typeof s=="string"?this.url.searchParams.append(t,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(t,`cd.{${s.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(s)}`),this}rangeGt(t,s){return this.url.searchParams.append(t,`sr.${s}`),this}rangeGte(t,s){return this.url.searchParams.append(t,`nxl.${s}`),this}rangeLt(t,s){return this.url.searchParams.append(t,`sl.${s}`),this}rangeLte(t,s){return this.url.searchParams.append(t,`nxr.${s}`),this}rangeAdjacent(t,s){return this.url.searchParams.append(t,`adj.${s}`),this}overlaps(t,s){return typeof s=="string"?this.url.searchParams.append(t,`ov.${s}`):this.url.searchParams.append(t,`ov.{${s.join(",")}}`),this}textSearch(t,s,{config:r,type:a}={}){let i="";a==="plain"?i="pl":a==="phrase"?i="ph":a==="websearch"&&(i="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(t,`${i}fts${o}.${s}`),this}match(t){return Object.entries(t).forEach(([s,r])=>{this.url.searchParams.append(s,`eq.${r}`)}),this}not(t,s,r){return this.url.searchParams.append(t,`not.${s}.${r}`),this}or(t,{foreignTable:s,referencedTable:r=s}={}){const a=r?`${r}.or`:"or";return this.url.searchParams.append(a,`(${t})`),this}filter(t,s,r){return this.url.searchParams.append(t,`${s}.${r}`),this}};xt.default=Oa;var Ra=he&&he.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty($t,"__esModule",{value:!0});const ot=Ra(xt);let $a=class{constructor(t,{headers:s={},schema:r,fetch:a}){this.url=t,this.headers=new Headers(s),this.schema=r,this.fetch=a}select(t,{head:s=!1,count:r}={}){const a=s?"HEAD":"GET";let i=!1;const o=(t??"*").split("").map(l=>/\s/.test(l)&&!i?"":(l==='"'&&(i=!i),l)).join("");return this.url.searchParams.set("select",o),r&&this.headers.append("Prefer",`count=${r}`),new ot.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:s,defaultToNull:r=!0}={}){var a;const i="POST";if(s&&this.headers.append("Prefer",`count=${s}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const o=t.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(o.length>0){const l=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",l.join(","))}}return new ot.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}upsert(t,{onConflict:s,ignoreDuplicates:r=!1,count:a,defaultToNull:i=!0}={}){var o;const l="POST";if(this.headers.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),s!==void 0&&this.url.searchParams.set("on_conflict",s),a&&this.headers.append("Prefer",`count=${a}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const c=t.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(c.length>0){const u=[...new Set(c)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new ot.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}update(t,{count:s}={}){var r;const a="PATCH";return s&&this.headers.append("Prefer",`count=${s}`),new ot.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}delete({count:t}={}){var s;const r="DELETE";return t&&this.headers.append("Prefer",`count=${t}`),new ot.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}};$t.default=$a;var ir=he&&he.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ws,"__esModule",{value:!0});const Da=ir($t),La=ir(xt);let Ua=class or{constructor(t,{headers:s={},schema:r,fetch:a}={}){this.url=t,this.headers=new Headers(s),this.schemaName=r,this.fetch=a}from(t){const s=new URL(`${this.url}/${t}`);return new Da.default(s,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new or(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,s={},{head:r=!1,get:a=!1,count:i}={}){var o;let l;const c=new URL(`${this.url}/rpc/${t}`);let u;r||a?(l=r?"HEAD":"GET",Object.entries(s).filter(([h,g])=>g!==void 0).map(([h,g])=>[h,Array.isArray(g)?`{${g.join(",")}}`:`${g}`]).forEach(([h,g])=>{c.searchParams.append(h,g)})):(l="POST",u=s);const d=new Headers(this.headers);return i&&d.set("Prefer",`count=${i}`),new La.default({method:l,url:c,headers:d,schema:this.schemaName,body:u,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};ws.default=Ua;var it=he&&he.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(le,"__esModule",{value:!0});le.PostgrestError=le.PostgrestBuilder=le.PostgrestTransformBuilder=le.PostgrestFilterBuilder=le.PostgrestQueryBuilder=le.PostgrestClient=void 0;const lr=it(ws);le.PostgrestClient=lr.default;const cr=it($t);le.PostgrestQueryBuilder=cr.default;const dr=it(xt);le.PostgrestFilterBuilder=dr.default;const ur=it(Dt);le.PostgrestTransformBuilder=ur.default;const hr=it(Lt);le.PostgrestBuilder=hr.default;const mr=it(Ut);le.PostgrestError=mr.default;var Fa=le.default={PostgrestClient:lr.default,PostgrestQueryBuilder:cr.default,PostgrestFilterBuilder:dr.default,PostgrestTransformBuilder:ur.default,PostgrestBuilder:hr.default,PostgrestError:mr.default};const{PostgrestClient:Ba,PostgrestQueryBuilder:xo,PostgrestFilterBuilder:go,PostgrestTransformBuilder:po,PostgrestBuilder:vo,PostgrestError:yo}=Fa;class Ma{static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const s=process.versions;if(s&&s.node){const r=s.node,a=parseInt(r.replace(/^v/,"").split(".")[0]);return a>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${a} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${a} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let s=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(s+=`

Suggested solution: ${t.workaround}`),new Error(s)}static createWebSocket(t,s){const r=this.getWebSocketConstructor();return new r(t,s)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const qa="2.15.5",za=`realtime-js/${qa}`,Va="1.0.0",ts=1e4,Wa=1e3,Ga=100;var ct;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(ct||(ct={}));var Z;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(Z||(Z={}));var xe;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(xe||(xe={}));var ss;(function(n){n.websocket="websocket"})(ss||(ss={}));var Le;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Le||(Le={}));class Ja{constructor(){this.HEADER_LENGTH=1}decode(t,s){return t.constructor===ArrayBuffer?s(this._binaryDecode(t)):s(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const s=new DataView(t),r=new TextDecoder;return this._decodeBroadcast(t,s,r)}_decodeBroadcast(t,s,r){const a=s.getUint8(1),i=s.getUint8(2);let o=this.HEADER_LENGTH+2;const l=r.decode(t.slice(o,o+a));o=o+a;const c=r.decode(t.slice(o,o+i));o=o+i;const u=JSON.parse(r.decode(t.slice(o,t.byteLength)));return{ref:null,topic:l,event:c,payload:u}}}class fr{constructor(t,s){this.callback=t,this.timerCalc=s,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=s}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Q;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(Q||(Q={}));const Ds=(n,t,s={})=>{var r;const a=(r=s.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(t).reduce((i,o)=>(i[o]=Ka(o,n,t,a),i),{})},Ka=(n,t,s,r)=>{const a=t.find(l=>l.name===n),i=a==null?void 0:a.type,o=s[n];return i&&!r.includes(i)?xr(i,o):rs(o)},xr=(n,t)=>{if(n.charAt(0)==="_"){const s=n.slice(1,n.length);return Xa(t,s)}switch(n){case Q.bool:return Ha(t);case Q.float4:case Q.float8:case Q.int2:case Q.int4:case Q.int8:case Q.numeric:case Q.oid:return Qa(t);case Q.json:case Q.jsonb:return Ya(t);case Q.timestamp:return Za(t);case Q.abstime:case Q.date:case Q.daterange:case Q.int4range:case Q.int8range:case Q.money:case Q.reltime:case Q.text:case Q.time:case Q.timestamptz:case Q.timetz:case Q.tsrange:case Q.tstzrange:return rs(t);default:return rs(t)}},rs=n=>n,Ha=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},Qa=n=>{if(typeof n=="string"){const t=parseFloat(n);if(!Number.isNaN(t))return t}return n},Ya=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(t){return console.log(`JSON parse error: ${t}`),n}return n},Xa=(n,t)=>{if(typeof n!="string")return n;const s=n.length-1,r=n[s];if(n[0]==="{"&&r==="}"){let i;const o=n.slice(1,s);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(l=>xr(t,l))}return n},Za=n=>typeof n=="string"?n.replace(" ","T"):n,gr=n=>{let t=n;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class qt{constructor(t,s,r={},a=ts){this.channel=t,this.event=s,this.payload=r,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,s){var r;return this._hasReceived(t)&&s((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:t,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=s=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=s,this._matchReceive(s)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:s}){this.recHooks.filter(r=>r.status===t).forEach(r=>r.callback(s))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var Ls;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Ls||(Ls={}));class dt{constructor(t,s){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(s==null?void 0:s.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},a=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=dt.syncState(this.state,a,i,o),this.pendingDiffs.forEach(c=>{this.state=dt.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],l()}),this.channel._on(r.diff,{},a=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=dt.syncDiff(this.state,a,i,o),l())}),this.onJoin((a,i,o)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:i,newPresences:o})}),this.onLeave((a,i,o)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,s,r,a){const i=this.cloneDeep(t),o=this.transformState(s),l={},c={};return this.map(i,(u,d)=>{o[u]||(c[u]=d)}),this.map(o,(u,d)=>{const h=i[u];if(h){const g=d.map(N=>N.presence_ref),p=h.map(N=>N.presence_ref),w=d.filter(N=>p.indexOf(N.presence_ref)<0),E=h.filter(N=>g.indexOf(N.presence_ref)<0);w.length>0&&(l[u]=w),E.length>0&&(c[u]=E)}else l[u]=d}),this.syncDiff(i,{joins:l,leaves:c},r,a)}static syncDiff(t,s,r,a){const{joins:i,leaves:o}={joins:this.transformState(s.joins),leaves:this.transformState(s.leaves)};return r||(r=()=>{}),a||(a=()=>{}),this.map(i,(l,c)=>{var u;const d=(u=t[l])!==null&&u!==void 0?u:[];if(t[l]=this.cloneDeep(c),d.length>0){const h=t[l].map(p=>p.presence_ref),g=d.filter(p=>h.indexOf(p.presence_ref)<0);t[l].unshift(...g)}r(l,d,c)}),this.map(o,(l,c)=>{let u=t[l];if(!u)return;const d=c.map(h=>h.presence_ref);u=u.filter(h=>d.indexOf(h.presence_ref)<0),t[l]=u,a(l,u,c),u.length===0&&delete t[l]}),t}static map(t,s){return Object.getOwnPropertyNames(t).map(r=>s(r,t[r]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((s,r)=>{const a=t[r];return"metas"in a?s[r]=a.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):s[r]=a,s},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Us;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Us||(Us={}));var ut;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(ut||(ut={}));var Se;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Se||(Se={}));class Ns{constructor(t,s={config:{}},r){this.topic=t,this.params=s,this.socket=r,this.bindings={},this.state=Z.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},s.config),this.timeout=this.socket.timeout,this.joinPush=new qt(this,xe.join,this.params,this.timeout),this.rejoinTimer=new fr(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Z.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Z.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=Z.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Z.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=Z.errored,this.rejoinTimer.scheduleTimeout())}),this._on(xe.reply,{},(a,i)=>{this._trigger(this._replyEventName(i),a)}),this.presence=new dt(this),this.broadcastEndpointURL=gr(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(t,s=this.timeout){var r,a,i;if(this.socket.isConnected()||this.socket.connect(),this.state==Z.closed){const{config:{broadcast:o,presence:l,private:c}}=this.params,u=(a=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(p=>p.filter))!==null&&a!==void 0?a:[],d=!!this.bindings[ut.PRESENCE]&&this.bindings[ut.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,h={},g={broadcast:o,presence:Object.assign(Object.assign({},l),{enabled:d}),postgres_changes:u,private:c};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(p=>t==null?void 0:t(Se.CHANNEL_ERROR,p)),this._onClose(()=>t==null?void 0:t(Se.CLOSED)),this.updateJoinPayload(Object.assign({config:g},h)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",async({postgres_changes:p})=>{var w;if(this.socket.setAuth(),p===void 0){t==null||t(Se.SUBSCRIBED);return}else{const E=this.bindings.postgres_changes,N=(w=E==null?void 0:E.length)!==null&&w!==void 0?w:0,f=[];for(let I=0;I<N;I++){const b=E[I],{filter:{event:$,schema:k,table:v,filter:y}}=b,V=p&&p[I];if(V&&V.event===$&&V.schema===k&&V.table===v&&V.filter===y)f.push(Object.assign(Object.assign({},b),{id:V.id}));else{this.unsubscribe(),this.state=Z.errored,t==null||t(Se.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=f,t&&t(Se.SUBSCRIBED);return}}).receive("error",p=>{this.state=Z.errored,t==null||t(Se.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(Se.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,s={}){return await this.send({type:"presence",event:"track",payload:t},s.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,s,r){return this.state===Z.joined&&t===ut.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,s,r)}async send(t,s={}){var r,a;if(!this._canPush()&&t.type==="broadcast"){const{event:i,payload:o}=t,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=s.timeout)!==null&&r!==void 0?r:this.timeout);return await((a=u.body)===null||a===void 0?void 0:a.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,l,c;const u=this._push(t.type,t,s.timeout||this.timeout);t.type==="broadcast"&&!(!((c=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Z.leaving;const s=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(xe.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(a=>{r=new qt(this,xe.leave,{},t),r.receive("ok",()=>{s(),a("ok")}).receive("timeout",()=>{s(),a("timed out")}).receive("error",()=>{a("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Z.closed,this.bindings={}}async _fetchWithTimeout(t,s,r){const a=new AbortController,i=setTimeout(()=>a.abort(),r),o=await this.socket.fetch(t,Object.assign(Object.assign({},s),{signal:a.signal}));return clearTimeout(i),o}_push(t,s,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new qt(this,t,s,r);return this._canPush()?a.send():this._addToPushBuffer(a),a}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>Ga){const s=this.pushBuffer.shift();s&&(s.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${s.event}`,s.payload))}}_onMessage(t,s,r){return s}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,s,r){var a,i;const o=t.toLocaleLowerCase(),{close:l,error:c,leave:u,join:d}=xe;if(r&&[l,c,u,d].indexOf(o)>=0&&r!==this._joinRef())return;let g=this._onMessage(o,s,r);if(s&&!g)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(a=this.bindings.postgres_changes)===null||a===void 0||a.filter(p=>{var w,E,N;return((w=p.filter)===null||w===void 0?void 0:w.event)==="*"||((N=(E=p.filter)===null||E===void 0?void 0:E.event)===null||N===void 0?void 0:N.toLocaleLowerCase())===o}).map(p=>p.callback(g,r)):(i=this.bindings[o])===null||i===void 0||i.filter(p=>{var w,E,N,f,I,b;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const $=p.id,k=(w=p.filter)===null||w===void 0?void 0:w.event;return $&&((E=s.ids)===null||E===void 0?void 0:E.includes($))&&(k==="*"||(k==null?void 0:k.toLocaleLowerCase())===((N=s.data)===null||N===void 0?void 0:N.type.toLocaleLowerCase()))}else{const $=(I=(f=p==null?void 0:p.filter)===null||f===void 0?void 0:f.event)===null||I===void 0?void 0:I.toLocaleLowerCase();return $==="*"||$===((b=s==null?void 0:s.event)===null||b===void 0?void 0:b.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof g=="object"&&"ids"in g){const w=g.data,{schema:E,table:N,commit_timestamp:f,type:I,errors:b}=w;g=Object.assign(Object.assign({},{schema:E,table:N,commit_timestamp:f,eventType:I,new:{},old:{},errors:b}),this._getPayloadRecords(w))}p.callback(g,r)})}_isClosed(){return this.state===Z.closed}_isJoined(){return this.state===Z.joined}_isJoining(){return this.state===Z.joining}_isLeaving(){return this.state===Z.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,s,r){const a=t.toLocaleLowerCase(),i={type:a,filter:s,callback:r};return this.bindings[a]?this.bindings[a].push(i):this.bindings[a]=[i],this}_off(t,s){const r=t.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(a=>{var i;return!(((i=a.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Ns.isEqual(a.filter,s))})),this}static isEqual(t,s){if(Object.keys(t).length!==Object.keys(s).length)return!1;for(const r in t)if(t[r]!==s[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(xe.close,{},t)}_onError(t){this._on(xe.error,{},s=>t(s))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Z.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const s={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(s.new=Ds(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(s.old=Ds(t.columns,t.old_record)),s}}const zt=()=>{},yt={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},en=[1e3,2e3,5e3,1e4],tn=1e4,sn=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class rn{constructor(t,s){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=ts,this.transport=null,this.heartbeatIntervalMs=yt.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=zt,this.ref=0,this.reconnectTimer=null,this.logger=zt,this.conn=null,this.sendBuffer=[],this.serializer=new Ja,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=a=>{let i;return a?i=a:typeof fetch>"u"?i=(...o)=>ft(async()=>{const{default:l}=await Promise.resolve().then(()=>nt);return{default:l}},void 0).then(({default:l})=>l(...o)).catch(l=>{throw new Error(`Failed to load @supabase/node-fetch: ${l.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):i=fetch,(...o)=>i(...o)},!(!((r=s==null?void 0:s.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=s.params.apikey,this.endPoint=`${t}/${ss.websocket}`,this.httpEndpoint=gr(t),this._initializeOptions(s),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(s==null?void 0:s.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Ma.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const s=t.message;throw s.includes("Node.js")?new Error(`${s}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${s}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Va}))}disconnect(t,s){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},t?this.conn.close(t,s??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const s=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),s}async removeAllChannels(){const t=await Promise.all(this.channels.map(s=>s.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,s,r){this.logger(t,s,r)}connectionState(){switch(this.conn&&this.conn.readyState){case ct.connecting:return Le.Connecting;case ct.open:return Le.Open;case ct.closing:return Le.Closing;default:return Le.Closed}}isConnected(){return this.connectionState()===Le.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,s={config:{}}){const r=`realtime:${t}`,a=this.getChannels().find(i=>i.topic===r);if(a)return a;{const i=new Ns(`realtime:${t}`,s,this);return this.channels.push(i),i}}push(t){const{topic:s,event:r,payload:a,ref:i}=t,o=()=>{this.encode(t,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${s} ${r} (${i})`,a),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(s){this.log("error","error in heartbeat callback",s)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(s){this.log("error","error in heartbeat callback",s)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(Wa,"heartbeat timeout"),setTimeout(()=>{var s;this.isConnected()||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout()},yt.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(s){this.log("error","error in heartbeat callback",s)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let s=this.channels.find(r=>r.topic===t&&(r._isJoined()||r._isJoining()));s&&(this.log("transport",`leaving duplicate topic "${t}"`),s.unsubscribe())}_remove(t){this.channels=this.channels.filter(s=>s.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,s=>{if(s.topic==="phoenix"&&s.event==="phx_reply")try{this.heartbeatCallback(s.payload.status==="ok"?"ok":"error")}catch(u){this.log("error","error in heartbeat callback",u)}s.ref&&s.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:a,payload:i,ref:o}=s,l=o?`(${o})`:"",c=i.status||"";this.log("receive",`${c} ${r} ${a} ${l}`.trim(),i),this.channels.filter(u=>u._isMember(r)).forEach(u=>u._trigger(a,i,o)),this._triggerStateCallbacks("message",s)})}_clearTimer(t){var s;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((s=this.reconnectTimer)===null||s===void 0||s.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=s=>{this.log("worker","worker error",s.message),this.workerRef.terminate()},this.workerRef.onmessage=s=>{s.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var s;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(xe.error))}_appendParams(t,s){if(Object.keys(s).length===0)return t;const r=t.match(/\?/)?"&":"?",a=new URLSearchParams(s);return`${t}${r}${a}`}_workerObjectUrl(t){let s;if(t)s=t;else{const r=new Blob([sn],{type:"application/javascript"});s=URL.createObjectURL(r)}return s}_setConnectionState(t,s=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=s)}async _performAuth(t=null){let s;t?s=t:this.accessToken?s=await this.accessToken():s=this.accessTokenValue,this.accessTokenValue!=s&&(this.accessTokenValue=s,this.channels.forEach(r=>{const a={access_token:s,version:za};s&&r.updateJoinPayload(a),r.joinedOnce&&r._isJoined()&&r._push(xe.access_token,{access_token:s})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(s=>{this.log("error",`error setting auth in ${t}`,s)})}_triggerStateCallbacks(t,s){try{this.stateChangeCallbacks[t].forEach(r=>{try{r(s)}catch(a){this.log("error",`error in ${t} callback`,a)}})}catch(r){this.log("error",`error triggering ${t} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new fr(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},yt.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var s,r,a,i,o,l,c,u,d;if(this.transport=(s=t==null?void 0:t.transport)!==null&&s!==void 0?s:null,this.timeout=(r=t==null?void 0:t.timeout)!==null&&r!==void 0?r:ts,this.heartbeatIntervalMs=(a=t==null?void 0:t.heartbeatIntervalMs)!==null&&a!==void 0?a:yt.HEARTBEAT_INTERVAL,this.worker=(i=t==null?void 0:t.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=t==null?void 0:t.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(l=t==null?void 0:t.heartbeatCallback)!==null&&l!==void 0?l:zt,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=t==null?void 0:t.reconnectAfterMs)!==null&&c!==void 0?c:h=>en[h-1]||tn,this.encode=(u=t==null?void 0:t.encode)!==null&&u!==void 0?u:(h,g)=>g(JSON.stringify(h)),this.decode=(d=t==null?void 0:t.decode)!==null&&d!==void 0?d:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}class _s extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function ee(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class an extends _s{constructor(t,s,r){super(t),this.name="StorageApiError",this.status=s,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class as extends _s{constructor(t,s){super(t),this.name="StorageUnknownError",this.originalError=s}}var nn=function(n,t,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):a(d.value).then(l,c)}u((r=r.apply(n,t||[])).next())})};const pr=n=>{let t;return n?t=n:typeof fetch>"u"?t=(...s)=>ft(async()=>{const{default:r}=await Promise.resolve().then(()=>nt);return{default:r}},void 0).then(({default:r})=>r(...s)):t=fetch,(...s)=>t(...s)},on=()=>nn(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield ft(()=>Promise.resolve().then(()=>nt),void 0)).Response:Response}),ns=n=>{if(Array.isArray(n))return n.map(s=>ns(s));if(typeof n=="function"||n!==Object(n))return n;const t={};return Object.entries(n).forEach(([s,r])=>{const a=s.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));t[a]=ns(r)}),t},ln=n=>{if(typeof n!="object"||n===null)return!1;const t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)};var Ge=function(n,t,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):a(d.value).then(l,c)}u((r=r.apply(n,t||[])).next())})};const Vt=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),cn=(n,t,s)=>Ge(void 0,void 0,void 0,function*(){const r=yield on();n instanceof r&&!(s!=null&&s.noResolveJson)?n.json().then(a=>{const i=n.status||500,o=(a==null?void 0:a.statusCode)||i+"";t(new an(Vt(a),i,o))}).catch(a=>{t(new as(Vt(a),a))}):t(new as(Vt(n),n))}),dn=(n,t,s,r)=>{const a={method:n,headers:(t==null?void 0:t.headers)||{}};return n==="GET"||!r?a:(ln(r)?(a.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),a.body=JSON.stringify(r)):a.body=r,t!=null&&t.duplex&&(a.duplex=t.duplex),Object.assign(Object.assign({},a),s))};function gt(n,t,s,r,a,i){return Ge(this,void 0,void 0,function*(){return new Promise((o,l)=>{n(s,dn(t,r,a,i)).then(c=>{if(!c.ok)throw c;return r!=null&&r.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>cn(c,l,r))})})}function Tt(n,t,s,r){return Ge(this,void 0,void 0,function*(){return gt(n,"GET",t,s,r)})}function pe(n,t,s,r,a){return Ge(this,void 0,void 0,function*(){return gt(n,"POST",t,r,a,s)})}function is(n,t,s,r,a){return Ge(this,void 0,void 0,function*(){return gt(n,"PUT",t,r,a,s)})}function un(n,t,s,r){return Ge(this,void 0,void 0,function*(){return gt(n,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),r)})}function vr(n,t,s,r,a){return Ge(this,void 0,void 0,function*(){return gt(n,"DELETE",t,r,a,s)})}var ie=function(n,t,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):a(d.value).then(l,c)}u((r=r.apply(n,t||[])).next())})};const hn={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Fs={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class mn{constructor(t,s={},r,a){this.shouldThrowOnError=!1,this.url=t,this.headers=s,this.bucketId=r,this.fetch=pr(a)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(t,s,r,a){return ie(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},Fs),a);let l=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=r,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),a!=null&&a.headers&&(l=Object.assign(Object.assign({},l),a.headers));const u=this._removeEmptyFolders(s),d=this._getFinalPath(u),h=yield(t=="PUT"?is:pe)(this.fetch,`${this.url}/object/${d}`,i,Object.assign({headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:u,id:h.Id,fullPath:h.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(ee(i))return{data:null,error:i};throw i}})}upload(t,s,r){return ie(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,s,r)})}uploadToSignedUrl(t,s,r,a){return ie(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(t),o=this._getFinalPath(i),l=new URL(this.url+`/object/upload/sign/${o}`);l.searchParams.set("token",s);try{let c;const u=Object.assign({upsert:Fs.upsert},a),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",u.cacheControl)):(c=r,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType);const h=yield is(this.fetch,l.toString(),c,{headers:d});return{data:{path:i,fullPath:h.Key},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(ee(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(t,s){return ie(this,void 0,void 0,function*(){try{let r=this._getFinalPath(t);const a=Object.assign({},this.headers);s!=null&&s.upsert&&(a["x-upsert"]="true");const i=yield pe(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:a}),o=new URL(this.url+i.url),l=o.searchParams.get("token");if(!l)throw new _s("No token returned by API");return{data:{signedUrl:o.toString(),path:t,token:l},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ee(r))return{data:null,error:r};throw r}})}update(t,s,r){return ie(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,s,r)})}move(t,s,r){return ie(this,void 0,void 0,function*(){try{return{data:yield pe(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:s,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ee(a))return{data:null,error:a};throw a}})}copy(t,s,r){return ie(this,void 0,void 0,function*(){try{return{data:{path:(yield pe(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:s,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ee(a))return{data:null,error:a};throw a}})}createSignedUrl(t,s,r){return ie(this,void 0,void 0,function*(){try{let a=this._getFinalPath(t),i=yield pe(this.fetch,`${this.url}/object/sign/${a}`,Object.assign({expiresIn:s},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ee(a))return{data:null,error:a};throw a}})}createSignedUrls(t,s,r){return ie(this,void 0,void 0,function*(){try{const a=yield pe(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:s,paths:t},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:a.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ee(a))return{data:null,error:a};throw a}})}download(t,s){return ie(this,void 0,void 0,function*(){const a=typeof(s==null?void 0:s.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((s==null?void 0:s.transform)||{}),o=i?`?${i}`:"";try{const l=this._getFinalPath(t);return{data:yield(yield Tt(this.fetch,`${this.url}/${a}/${l}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ee(l))return{data:null,error:l};throw l}})}info(t){return ie(this,void 0,void 0,function*(){const s=this._getFinalPath(t);try{const r=yield Tt(this.fetch,`${this.url}/object/info/${s}`,{headers:this.headers});return{data:ns(r),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ee(r))return{data:null,error:r};throw r}})}exists(t){return ie(this,void 0,void 0,function*(){const s=this._getFinalPath(t);try{return yield un(this.fetch,`${this.url}/object/${s}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ee(r)&&r instanceof as){const a=r.originalError;if([400,404].includes(a==null?void 0:a.status))return{data:!1,error:r}}throw r}})}getPublicUrl(t,s){const r=this._getFinalPath(t),a=[],i=s!=null&&s.download?`download=${s.download===!0?"":s.download}`:"";i!==""&&a.push(i);const l=typeof(s==null?void 0:s.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((s==null?void 0:s.transform)||{});c!==""&&a.push(c);let u=a.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${r}${u}`)}}}remove(t){return ie(this,void 0,void 0,function*(){try{return{data:yield vr(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ee(s))return{data:null,error:s};throw s}})}list(t,s,r){return ie(this,void 0,void 0,function*(){try{const a=Object.assign(Object.assign(Object.assign({},hn),s),{prefix:t||""});return{data:yield pe(this.fetch,`${this.url}/object/list/${this.bucketId}`,a,{headers:this.headers},r),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ee(a))return{data:null,error:a};throw a}})}listV2(t,s){return ie(this,void 0,void 0,function*(){try{const r=Object.assign({},t);return{data:yield pe(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ee(r))return{data:null,error:r};throw r}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const s=[];return t.width&&s.push(`width=${t.width}`),t.height&&s.push(`height=${t.height}`),t.resize&&s.push(`resize=${t.resize}`),t.format&&s.push(`format=${t.format}`),t.quality&&s.push(`quality=${t.quality}`),s.join("&")}}const fn="2.12.1",xn={"X-Client-Info":`storage-js/${fn}`};var Ke=function(n,t,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):a(d.value).then(l,c)}u((r=r.apply(n,[])).next())})};class gn{constructor(t,s={},r,a){this.shouldThrowOnError=!1;const i=new URL(t);a!=null&&a.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href,this.headers=Object.assign(Object.assign({},xn),s),this.fetch=pr(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return Ke(this,void 0,void 0,function*(){try{return{data:yield Tt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ee(t))return{data:null,error:t};throw t}})}getBucket(t){return Ke(this,void 0,void 0,function*(){try{return{data:yield Tt(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ee(s))return{data:null,error:s};throw s}})}createBucket(t,s={public:!1}){return Ke(this,void 0,void 0,function*(){try{return{data:yield pe(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:s.type,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ee(r))return{data:null,error:r};throw r}})}updateBucket(t,s){return Ke(this,void 0,void 0,function*(){try{return{data:yield is(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ee(r))return{data:null,error:r};throw r}})}emptyBucket(t){return Ke(this,void 0,void 0,function*(){try{return{data:yield pe(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ee(s))return{data:null,error:s};throw s}})}deleteBucket(t){return Ke(this,void 0,void 0,function*(){try{return{data:yield vr(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ee(s))return{data:null,error:s};throw s}})}}class pn extends gn{constructor(t,s={},r,a){super(t,s,r,a)}from(t){return new mn(this.url,this.headers,t,this.fetch)}}const vn="2.57.4";let lt="";typeof Deno<"u"?lt="deno":typeof document<"u"?lt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?lt="react-native":lt="node";const yn={"X-Client-Info":`supabase-js-${lt}/${vn}`},bn={headers:yn},jn={schema:"public"},wn={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Nn={};var _n=function(n,t,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):a(d.value).then(l,c)}u((r=r.apply(n,t||[])).next())})};const Sn=n=>{let t;return n?t=n:typeof fetch>"u"?t=rr:t=fetch,(...s)=>t(...s)},kn=()=>typeof Headers>"u"?ar:Headers,Cn=(n,t,s)=>{const r=Sn(s),a=kn();return(i,o)=>_n(void 0,void 0,void 0,function*(){var l;const c=(l=yield t())!==null&&l!==void 0?l:n;let u=new a(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",n),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},o),{headers:u}))})};var En=function(n,t,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):a(d.value).then(l,c)}u((r=r.apply(n,[])).next())})};function Tn(n){return n.endsWith("/")?n:n+"/"}function Pn(n,t){var s,r;const{db:a,auth:i,realtime:o,global:l}=n,{db:c,auth:u,realtime:d,global:h}=t,g={db:Object.assign(Object.assign({},c),a),auth:Object.assign(Object.assign({},u),i),realtime:Object.assign(Object.assign({},d),o),storage:{},global:Object.assign(Object.assign(Object.assign({},h),l),{headers:Object.assign(Object.assign({},(s=h==null?void 0:h.headers)!==null&&s!==void 0?s:{}),(r=l==null?void 0:l.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>En(this,void 0,void 0,function*(){return""})};return n.accessToken?g.accessToken=n.accessToken:delete g.accessToken,g}function In(n){const t=n==null?void 0:n.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Tn(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const yr="2.71.1",et=30*1e3,os=3,Wt=os*et,An="http://localhost:9999",On="supabase.auth.token",Rn={"X-Client-Info":`gotrue-js/${yr}`},ls="X-Supabase-Api-Version",br={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},$n=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Dn=10*60*1e3;class Ss extends Error{constructor(t,s,r){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=s,this.code=r}}function M(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class Ln extends Ss{constructor(t,s,r){super(t,s,r),this.name="AuthApiError",this.status=s,this.code=r}}function Un(n){return M(n)&&n.name==="AuthApiError"}class jr extends Ss{constructor(t,s){super(t),this.name="AuthUnknownError",this.originalError=s}}class Oe extends Ss{constructor(t,s,r,a){super(t,r,a),this.name=s,this.status=r}}class Ee extends Oe{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Fn(n){return M(n)&&n.name==="AuthSessionMissingError"}class bt extends Oe{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class jt extends Oe{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class wt extends Oe{constructor(t,s=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Bn(n){return M(n)&&n.name==="AuthImplicitGrantRedirectError"}class Bs extends Oe{constructor(t,s=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class cs extends Oe{constructor(t,s){super(t,"AuthRetryableFetchError",s,void 0)}}function Gt(n){return M(n)&&n.name==="AuthRetryableFetchError"}class Ms extends Oe{constructor(t,s,r){super(t,"AuthWeakPasswordError",s,"weak_password"),this.reasons=r}}class ds extends Oe{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Pt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),qs=` 	
\r=`.split(""),Mn=(()=>{const n=new Array(128);for(let t=0;t<n.length;t+=1)n[t]=-1;for(let t=0;t<qs.length;t+=1)n[qs[t].charCodeAt(0)]=-2;for(let t=0;t<Pt.length;t+=1)n[Pt[t].charCodeAt(0)]=t;return n})();function zs(n,t,s){if(n!==null)for(t.queue=t.queue<<8|n,t.queuedBits+=8;t.queuedBits>=6;){const r=t.queue>>t.queuedBits-6&63;s(Pt[r]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const r=t.queue>>t.queuedBits-6&63;s(Pt[r]),t.queuedBits-=6}}function wr(n,t,s){const r=Mn[n];if(r>-1)for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Vs(n){const t=[],s=o=>{t.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},i=o=>{Vn(o,r,s)};for(let o=0;o<n.length;o+=1)wr(n.charCodeAt(o),a,i);return t.join("")}function qn(n,t){if(n<=127){t(n);return}else if(n<=2047){t(192|n>>6),t(128|n&63);return}else if(n<=65535){t(224|n>>12),t(128|n>>6&63),t(128|n&63);return}else if(n<=1114111){t(240|n>>18),t(128|n>>12&63),t(128|n>>6&63),t(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function zn(n,t){for(let s=0;s<n.length;s+=1){let r=n.charCodeAt(s);if(r>55295&&r<=56319){const a=(r-55296)*1024&65535;r=(n.charCodeAt(s+1)-56320&65535|a)+65536,s+=1}qn(r,t)}}function Vn(n,t,s){if(t.utf8seq===0){if(n<=127){s(n);return}for(let r=1;r<6;r+=1)if(!(n>>7-r&1)){t.utf8seq=r;break}if(t.utf8seq===2)t.codepoint=n&31;else if(t.utf8seq===3)t.codepoint=n&15;else if(t.utf8seq===4)t.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|n&63,t.utf8seq-=1,t.utf8seq===0&&s(t.codepoint)}}function Wn(n){const t=[],s={queue:0,queuedBits:0},r=a=>{t.push(a)};for(let a=0;a<n.length;a+=1)wr(n.charCodeAt(a),s,r);return new Uint8Array(t)}function Gn(n){const t=[];return zn(n,s=>t.push(s)),new Uint8Array(t)}function Jn(n){const t=[],s={queue:0,queuedBits:0},r=a=>{t.push(a)};return n.forEach(a=>zs(a,s,r)),zs(null,s,r),t.join("")}function Kn(n){return Math.round(Date.now()/1e3)+n}function Hn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const t=Math.random()*16|0;return(n=="x"?t:t&3|8).toString(16)})}const fe=()=>typeof window<"u"&&typeof document<"u",Re={tested:!1,writable:!1},Nr=()=>{if(!fe())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Re.tested)return Re.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Re.tested=!0,Re.writable=!0}catch{Re.tested=!0,Re.writable=!1}return Re.writable};function Qn(n){const t={},s=new URL(n);if(s.hash&&s.hash[0]==="#")try{new URLSearchParams(s.hash.substring(1)).forEach((a,i)=>{t[i]=a})}catch{}return s.searchParams.forEach((r,a)=>{t[a]=r}),t}const _r=n=>{let t;return n?t=n:typeof fetch>"u"?t=(...s)=>ft(async()=>{const{default:r}=await Promise.resolve().then(()=>nt);return{default:r}},void 0).then(({default:r})=>r(...s)):t=fetch,(...s)=>t(...s)},Yn=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",tt=async(n,t,s)=>{await n.setItem(t,JSON.stringify(s))},$e=async(n,t)=>{const s=await n.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch{return s}},Ce=async(n,t)=>{await n.removeItem(t)};class Ft{constructor(){this.promise=new Ft.promiseConstructor((t,s)=>{this.resolve=t,this.reject=s})}}Ft.promiseConstructor=Promise;function Jt(n){const t=n.split(".");if(t.length!==3)throw new ds("Invalid JWT structure");for(let r=0;r<t.length;r++)if(!$n.test(t[r]))throw new ds("JWT not in base64url format");return{header:JSON.parse(Vs(t[0])),payload:JSON.parse(Vs(t[1])),signature:Wn(t[2]),raw:{header:t[0],payload:t[1]}}}async function Xn(n){return await new Promise(t=>{setTimeout(()=>t(null),n)})}function Zn(n,t){return new Promise((r,a)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await n(i);if(!t(i,null,o)){r(o);return}}catch(o){if(!t(i,o)){a(o);return}}})()})}function ei(n){return("0"+n.toString(16)).substr(-2)}function ti(){const t=new Uint32Array(56);if(typeof crypto>"u"){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=s.length;let a="";for(let i=0;i<56;i++)a+=s.charAt(Math.floor(Math.random()*r));return a}return crypto.getRandomValues(t),Array.from(t,ei).join("")}async function si(n){const s=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",s),a=new Uint8Array(r);return Array.from(a).map(i=>String.fromCharCode(i)).join("")}async function ri(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const s=await si(n);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function He(n,t,s=!1){const r=ti();let a=r;s&&(a+="/PASSWORD_RECOVERY"),await tt(n,`${t}-code-verifier`,a);const i=await ri(r);return[i,r===i?"plain":"s256"]}const ai=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function ni(n){const t=n.headers.get(ls);if(!t||!t.match(ai))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function ii(n){if(!n)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(n<=t)throw new Error("JWT has expired")}function oi(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const li=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Qe(n){if(!li.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Kt(){const n={};return new Proxy(n,{get:(t,s)=>{if(s==="__isUserNotAvailableProxy")return!0;if(typeof s=="symbol"){const r=s.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${s}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Ws(n){return JSON.parse(JSON.stringify(n))}var ci=function(n,t){var s={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(s[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(n);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(n,r[a])&&(s[r[a]]=n[r[a]]);return s};const De=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),di=[502,503,504];async function Gs(n){var t;if(!Yn(n))throw new cs(De(n),0);if(di.includes(n.status))throw new cs(De(n),n.status);let s;try{s=await n.json()}catch(i){throw new jr(De(i),i)}let r;const a=ni(n);if(a&&a.getTime()>=br["2024-01-01"].timestamp&&typeof s=="object"&&s&&typeof s.code=="string"?r=s.code:typeof s=="object"&&s&&typeof s.error_code=="string"&&(r=s.error_code),r){if(r==="weak_password")throw new Ms(De(s),n.status,((t=s.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(r==="session_not_found")throw new Ee}else if(typeof s=="object"&&s&&typeof s.weak_password=="object"&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Ms(De(s),n.status,s.weak_password.reasons);throw new Ln(De(s),n.status||500,r)}const ui=(n,t,s,r)=>{const a={method:n,headers:(t==null?void 0:t.headers)||{}};return n==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),s))};async function z(n,t,s,r){var a;const i=Object.assign({},r==null?void 0:r.headers);i[ls]||(i[ls]=br["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(a=r==null?void 0:r.query)!==null&&a!==void 0?a:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await hi(n,t,s+l,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(c):{data:Object.assign({},c),error:null}}async function hi(n,t,s,r,a,i){const o=ui(t,r,a,i);let l;try{l=await n(s,Object.assign({},o))}catch(c){throw console.error(c),new cs(De(c),0)}if(l.ok||await Gs(l),r!=null&&r.noResolveJson)return l;try{return await l.json()}catch(c){await Gs(c)}}function _e(n){var t;let s=null;gi(n)&&(s=Object.assign({},n),n.expires_at||(s.expires_at=Kn(n.expires_in)));const r=(t=n.user)!==null&&t!==void 0?t:n;return{data:{session:s,user:r},error:null}}function Js(n){const t=_e(n);return!t.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((s,r)=>s&&typeof r=="string",!0)&&(t.data.weak_password=n.weak_password),t}function Te(n){var t;return{data:{user:(t=n.user)!==null&&t!==void 0?t:n},error:null}}function mi(n){return{data:n,error:null}}function fi(n){const{action_link:t,email_otp:s,hashed_token:r,redirect_to:a,verification_type:i}=n,o=ci(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:t,email_otp:s,hashed_token:r,redirect_to:a,verification_type:i},c=Object.assign({},o);return{data:{properties:l,user:c},error:null}}function xi(n){return n}function gi(n){return n.access_token&&n.refresh_token&&n.expires_in}const Ht=["global","local","others"];var pi=function(n,t){var s={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(s[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(n);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(n,r[a])&&(s[r[a]]=n[r[a]]);return s};class vi{constructor({url:t="",headers:s={},fetch:r}){this.url=t,this.headers=s,this.fetch=_r(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(t,s=Ht[0]){if(Ht.indexOf(s)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Ht.join(", ")}`);try{return await z(this.fetch,"POST",`${this.url}/logout?scope=${s}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(r){if(M(r))return{data:null,error:r};throw r}}async inviteUserByEmail(t,s={}){try{return await z(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:s.data},headers:this.headers,redirectTo:s.redirectTo,xform:Te})}catch(r){if(M(r))return{data:{user:null},error:r};throw r}}async generateLink(t){try{const{options:s}=t,r=pi(t,["options"]),a=Object.assign(Object.assign({},r),s);return"newEmail"in r&&(a.new_email=r==null?void 0:r.newEmail,delete a.newEmail),await z(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:fi,redirectTo:s==null?void 0:s.redirectTo})}catch(s){if(M(s))return{data:{properties:null,user:null},error:s};throw s}}async createUser(t){try{return await z(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Te})}catch(s){if(M(s))return{data:{user:null},error:s};throw s}}async listUsers(t){var s,r,a,i,o,l,c;try{const u={nextPage:null,lastPage:0,total:0},d=await z(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(s=t==null?void 0:t.page)===null||s===void 0?void 0:s.toString())!==null&&r!==void 0?r:"",per_page:(i=(a=t==null?void 0:t.perPage)===null||a===void 0?void 0:a.toString())!==null&&i!==void 0?i:""},xform:xi});if(d.error)throw d.error;const h=await d.json(),g=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(l=d.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(w=>{const E=parseInt(w.split(";")[0].split("=")[1].substring(0,1)),N=JSON.parse(w.split(";")[1].split("=")[1]);u[`${N}Page`]=E}),u.total=parseInt(g)),{data:Object.assign(Object.assign({},h),u),error:null}}catch(u){if(M(u))return{data:{users:[]},error:u};throw u}}async getUserById(t){Qe(t);try{return await z(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Te})}catch(s){if(M(s))return{data:{user:null},error:s};throw s}}async updateUserById(t,s){Qe(t);try{return await z(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:s,headers:this.headers,xform:Te})}catch(r){if(M(r))return{data:{user:null},error:r};throw r}}async deleteUser(t,s=!1){Qe(t);try{return await z(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:s},xform:Te})}catch(r){if(M(r))return{data:{user:null},error:r};throw r}}async _listFactors(t){Qe(t.userId);try{const{data:s,error:r}=await z(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:s,error:r}}catch(s){if(M(s))return{data:null,error:s};throw s}}async _deleteFactor(t){Qe(t.userId),Qe(t.id);try{return{data:await z(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(s){if(M(s))return{data:null,error:s};throw s}}}function Ks(n={}){return{getItem:t=>n[t]||null,setItem:(t,s)=>{n[t]=s},removeItem:t=>{delete n[t]}}}function yi(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Ye={debug:!!(globalThis&&Nr()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Sr extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class bi extends Sr{}async function ji(n,t,s){Ye.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,t);const r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),Ye.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async a=>{if(a){Ye.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,a.name);try{return await s()}finally{Ye.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,a.name)}}else{if(t===0)throw Ye.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new bi(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Ye.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}}))}yi();const wi={url:An,storageKey:On,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Rn,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Hs(n,t,s){return await s()}const Xe={};class mt{constructor(t){var s,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=mt.nextInstanceID,mt.nextInstanceID+=1,this.instanceID>0&&fe()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const a=Object.assign(Object.assign({},wi),t);if(this.logDebugMessages=!!a.debug,typeof a.debug=="function"&&(this.logger=a.debug),this.persistSession=a.persistSession,this.storageKey=a.storageKey,this.autoRefreshToken=a.autoRefreshToken,this.admin=new vi({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=_r(a.fetch),this.lock=a.lock||Hs,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,this.hasCustomAuthorizationHeader=a.hasCustomAuthorizationHeader,a.lock?this.lock=a.lock:fe()&&(!((s=globalThis==null?void 0:globalThis.navigator)===null||s===void 0)&&s.locks)?this.lock=ji:this.lock=Hs,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(a.storage?this.storage=a.storage:Nr()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Ks(this.memoryStorage)),a.userStorage&&(this.userStorage=a.userStorage)):(this.memoryStorage={},this.storage=Ks(this.memoryStorage)),fe()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}get jwks(){var t,s;return(s=(t=Xe[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&s!==void 0?s:{keys:[]}}set jwks(t){Xe[this.storageKey]=Object.assign(Object.assign({},Xe[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,s;return(s=(t=Xe[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&s!==void 0?s:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){Xe[this.storageKey]=Object.assign(Object.assign({},Xe[this.storageKey]),{cachedAt:t})}_debug(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${yr}) ${new Date().toISOString()}`,...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{const s=Qn(window.location.href);let r="none";if(this._isImplicitGrantCallback(s)?r="implicit":await this._isPKCECallback(s)&&(r="pkce"),fe()&&this.detectSessionInUrl&&r!=="none"){const{data:a,error:i}=await this._getSessionFromURL(s,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Bn(i)){const c=(t=i.details)===null||t===void 0?void 0:t.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:l}=a;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(s){return M(s)?{error:s}:{error:new jr("Unexpected error during initialization",s)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var s,r,a;try{const i=await z(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(s=t==null?void 0:t.options)===null||s===void 0?void 0:s.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(a=t==null?void 0:t.options)===null||a===void 0?void 0:a.captchaToken}},xform:_e}),{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(M(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(t){var s,r,a;try{let i;if("email"in t){const{email:d,password:h,options:g}=t;let p=null,w=null;this.flowType==="pkce"&&([p,w]=await He(this.storage,this.storageKey)),i=await z(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:g==null?void 0:g.emailRedirectTo,body:{email:d,password:h,data:(s=g==null?void 0:g.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken},code_challenge:p,code_challenge_method:w},xform:_e})}else if("phone"in t){const{phone:d,password:h,options:g}=t;i=await z(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:h,data:(r=g==null?void 0:g.data)!==null&&r!==void 0?r:{},channel:(a=g==null?void 0:g.channel)!==null&&a!==void 0?a:"sms",gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken}},xform:_e})}else throw new jt("You must provide either an email or phone number and a password");const{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(M(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(t){try{let s;if("email"in t){const{email:i,password:o,options:l}=t;s=await z(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Js})}else if("phone"in t){const{phone:i,password:o,options:l}=t;s=await z(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Js})}else throw new jt("You must provide either an email or phone number and a password");const{data:r,error:a}=s;return a?{data:{user:null,session:null},error:a}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new bt}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:a})}catch(s){if(M(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOAuth(t){var s,r,a,i;return await this._handleProviderSignIn(t.provider,{redirectTo:(s=t.options)===null||s===void 0?void 0:s.redirectTo,scopes:(r=t.options)===null||r===void 0?void 0:r.scopes,queryParams:(a=t.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:(i=t.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:s}=t;if(s==="solana")return await this.signInWithSolana(t);throw new Error(`@supabase/auth-js: Unsupported chain "${s}"`)}async signInWithSolana(t){var s,r,a,i,o,l,c,u,d,h,g,p;let w,E;if("message"in t)w=t.message,E=t.signature;else{const{chain:N,wallet:f,statement:I,options:b}=t;let $;if(fe())if(typeof f=="object")$=f;else{const v=window;if("solana"in v&&typeof v.solana=="object"&&("signIn"in v.solana&&typeof v.solana.signIn=="function"||"signMessage"in v.solana&&typeof v.solana.signMessage=="function"))$=v.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof f!="object"||!(b!=null&&b.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");$=f}const k=new URL((s=b==null?void 0:b.url)!==null&&s!==void 0?s:window.location.href);if("signIn"in $&&$.signIn){const v=await $.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},b==null?void 0:b.signInWithSolana),{version:"1",domain:k.host,uri:k.href}),I?{statement:I}:null));let y;if(Array.isArray(v)&&v[0]&&typeof v[0]=="object")y=v[0];else if(v&&typeof v=="object"&&"signedMessage"in v&&"signature"in v)y=v;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in y&&"signature"in y&&(typeof y.signedMessage=="string"||y.signedMessage instanceof Uint8Array)&&y.signature instanceof Uint8Array)w=typeof y.signedMessage=="string"?y.signedMessage:new TextDecoder().decode(y.signedMessage),E=y.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in $)||typeof $.signMessage!="function"||!("publicKey"in $)||typeof $!="object"||!$.publicKey||!("toBase58"in $.publicKey)||typeof $.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");w=[`${k.host} wants you to sign in with your Solana account:`,$.publicKey.toBase58(),...I?["",I,""]:[""],"Version: 1",`URI: ${k.href}`,`Issued At: ${(a=(r=b==null?void 0:b.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&a!==void 0?a:new Date().toISOString()}`,...!((i=b==null?void 0:b.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${b.signInWithSolana.notBefore}`]:[],...!((o=b==null?void 0:b.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${b.signInWithSolana.expirationTime}`]:[],...!((l=b==null?void 0:b.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${b.signInWithSolana.chainId}`]:[],...!((c=b==null?void 0:b.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${b.signInWithSolana.nonce}`]:[],...!((u=b==null?void 0:b.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${b.signInWithSolana.requestId}`]:[],...!((h=(d=b==null?void 0:b.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||h===void 0)&&h.length?["Resources",...b.signInWithSolana.resources.map(y=>`- ${y}`)]:[]].join(`
`);const v=await $.signMessage(new TextEncoder().encode(w),"utf8");if(!v||!(v instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");E=v}}try{const{data:N,error:f}=await z(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:w,signature:Jn(E)},!((g=t.options)===null||g===void 0)&&g.captchaToken?{gotrue_meta_security:{captcha_token:(p=t.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:_e});if(f)throw f;return!N||!N.session||!N.user?{data:{user:null,session:null},error:new bt}:(N.session&&(await this._saveSession(N.session),await this._notifyAllSubscribers("SIGNED_IN",N.session)),{data:Object.assign({},N),error:f})}catch(N){if(M(N))return{data:{user:null,session:null},error:N};throw N}}async _exchangeCodeForSession(t){const s=await $e(this.storage,`${this.storageKey}-code-verifier`),[r,a]=(s??"").split("/");try{const{data:i,error:o}=await z(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:r},xform:_e});if(await Ce(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new bt}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:a??null}),error:o})}catch(i){if(M(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(t){try{const{options:s,provider:r,token:a,access_token:i,nonce:o}=t,l=await z(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:a,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},xform:_e}),{data:c,error:u}=l;return u?{data:{user:null,session:null},error:u}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new bt}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:u})}catch(s){if(M(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOtp(t){var s,r,a,i,o;try{if("email"in t){const{email:l,options:c}=t;let u=null,d=null;this.flowType==="pkce"&&([u,d]=await He(this.storage,this.storageKey));const{error:h}=await z(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(s=c==null?void 0:c.data)!==null&&s!==void 0?s:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in t){const{phone:l,options:c}=t,{data:u,error:d}=await z(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(a=c==null?void 0:c.data)!==null&&a!==void 0?a:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:d}}throw new jt("You must provide either an email or phone number.")}catch(l){if(M(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(t){var s,r;try{let a,i;"options"in t&&(a=(s=t.options)===null||s===void 0?void 0:s.redirectTo,i=(r=t.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:l}=await z(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:i}}),redirectTo:a,xform:_e});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,u=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(a){if(M(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithSSO(t){var s,r,a;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await He(this.storage,this.storageKey)),await z(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(r=(s=t.options)===null||s===void 0?void 0:s.redirectTo)!==null&&r!==void 0?r:void 0}),!((a=t==null?void 0:t.options)===null||a===void 0)&&a.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:mi})}catch(i){if(M(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:s},error:r}=t;if(r)throw r;if(!s)throw new Ee;const{error:a}=await z(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:s.access_token});return{data:{user:null,session:null},error:a}})}catch(t){if(M(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const s=`${this.url}/resend`;if("email"in t){const{email:r,type:a,options:i}=t,{error:o}=await z(this.fetch,"POST",s,{headers:this.headers,body:{email:r,type:a,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in t){const{phone:r,type:a,options:i}=t,{data:o,error:l}=await z(this.fetch,"POST",s,{headers:this.headers,body:{phone:r,type:a,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l}}throw new jt("You must provide either an email or phone number and a type")}catch(s){if(M(s))return{data:{user:null,session:null},error:s};throw s}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async s=>s))}async _acquireLock(t,s){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),a=(async()=>(await r,await s()))();return this.pendingInLock.push((async()=>{try{await a}catch{}})()),a}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=s();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const s=await this.__loadSession();return await t(s)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const s=await $e(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?t=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const r=t.expires_at?t.expires_at*1e3-Date.now()<Wt:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",t.expires_at),!r){if(this.userStorage){const o=await $e(this.userStorage,this.storageKey+"-user");o!=null&&o.user?t.user=o.user:t.user=Kt()}if(this.storage.isServer&&t.user){let o=this.suppressGetSessionWarning;t=new Proxy(t,{get:(c,u,d)=>(!o&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,u,d))})}return{data:{session:t},error:null}}const{session:a,error:i}=await this._callRefreshToken(t.refresh_token);return i?{data:{session:null},error:i}:{data:{session:a},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await z(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Te}):await this._useSession(async s=>{var r,a,i;const{data:o,error:l}=s;if(l)throw l;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ee}:await z(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(a=o.session)===null||a===void 0?void 0:a.access_token)!==null&&i!==void 0?i:void 0,xform:Te})})}catch(s){if(M(s))return Fn(s)&&(await this._removeSession(),await Ce(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:s};throw s}}async updateUser(t,s={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,s))}async _updateUser(t,s={}){try{return await this._useSession(async r=>{const{data:a,error:i}=r;if(i)throw i;if(!a.session)throw new Ee;const o=a.session;let l=null,c=null;this.flowType==="pkce"&&t.email!=null&&([l,c]=await He(this.storage,this.storageKey));const{data:u,error:d}=await z(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:s==null?void 0:s.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:l,code_challenge_method:c}),jwt:o.access_token,xform:Te});if(d)throw d;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(M(r))return{data:{user:null},error:r};throw r}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Ee;const s=Date.now()/1e3;let r=s,a=!0,i=null;const{payload:o}=Jt(t.access_token);if(o.exp&&(r=o.exp,a=r<=s),a){const{session:l,error:c}=await this._callRefreshToken(t.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:c}=await this._getUser(t.access_token);if(c)throw c;i={access_token:t.access_token,refresh_token:t.refresh_token,user:l.user,token_type:"bearer",expires_in:r-s,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(s){if(M(s))return{data:{session:null,user:null},error:s};throw s}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async s=>{var r;if(!t){const{data:o,error:l}=s;if(l)throw l;t=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(t!=null&&t.refresh_token))throw new Ee;const{session:a,error:i}=await this._callRefreshToken(t.refresh_token);return i?{data:{user:null,session:null},error:i}:a?{data:{user:a.user,session:a},error:null}:{data:{user:null,session:null},error:null}})}catch(s){if(M(s))return{data:{user:null,session:null},error:s};throw s}}async _getSessionFromURL(t,s){try{if(!fe())throw new wt("No browser detected.");if(t.error||t.error_description||t.error_code)throw new wt(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(s){case"implicit":if(this.flowType==="pkce")throw new Bs("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new wt("Not a valid implicit grant flow url.");break;default:}if(s==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new Bs("No code detected.");const{data:I,error:b}=await this._exchangeCodeForSession(t.code);if(b)throw b;const $=new URL(window.location.href);return $.searchParams.delete("code"),window.history.replaceState(window.history.state,"",$.toString()),{data:{session:I.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:a,access_token:i,refresh_token:o,expires_in:l,expires_at:c,token_type:u}=t;if(!i||!l||!o||!u)throw new wt("No session defined in URL");const d=Math.round(Date.now()/1e3),h=parseInt(l);let g=d+h;c&&(g=parseInt(c));const p=g-d;p*1e3<=et&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${h}s`);const w=g-h;d-w>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",w,g,d):d-w<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",w,g,d);const{data:E,error:N}=await this._getUser(i);if(N)throw N;const f={provider_token:r,provider_refresh_token:a,access_token:i,expires_in:h,expires_at:g,refresh_token:o,token_type:u,user:E.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:f,redirectType:t.type},error:null}}catch(r){if(M(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const s=await $e(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&s)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async s=>{var r;const{data:a,error:i}=s;if(i)return{error:i};const o=(r=a.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:l}=await this.admin.signOut(o,t);if(l&&!(Un(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return t!=="others"&&(await this._removeSession(),await Ce(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(t){const s=Hn(),r={id:s,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(s)})))(),{data:{subscription:r}}}async _emitInitialSession(t){return await this._useSession(async s=>{var r,a;try{const{data:{session:i},error:o}=s;if(o)throw o;await((r=this.stateChangeEmitters.get(t))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",t,"session",i)}catch(i){await((a=this.stateChangeEmitters.get(t))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",i),console.error(i)}})}async resetPasswordForEmail(t,s={}){let r=null,a=null;this.flowType==="pkce"&&([r,a]=await He(this.storage,this.storageKey,!0));try{return await z(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:r,code_challenge_method:a,gotrue_meta_security:{captcha_token:s.captchaToken}},headers:this.headers,redirectTo:s.redirectTo})}catch(i){if(M(i))return{data:null,error:i};throw i}}async getUserIdentities(){var t;try{const{data:s,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(t=s.user.identities)!==null&&t!==void 0?t:[]},error:null}}catch(s){if(M(s))return{data:null,error:s};throw s}}async linkIdentity(t){var s;try{const{data:r,error:a}=await this._useSession(async i=>{var o,l,c,u,d;const{data:h,error:g}=i;if(g)throw g;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(o=t.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=t.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=t.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await z(this.fetch,"GET",p,{headers:this.headers,jwt:(d=(u=h.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(a)throw a;return fe()&&!(!((s=t.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:t.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(M(r))return{data:{provider:t.provider,url:null},error:r};throw r}}async unlinkIdentity(t){try{return await this._useSession(async s=>{var r,a;const{data:i,error:o}=s;if(o)throw o;return await z(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(a=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&a!==void 0?a:void 0})})}catch(s){if(M(s))return{data:null,error:s};throw s}}async _refreshAccessToken(t){const s=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{const r=Date.now();return await Zn(async a=>(a>0&&await Xn(200*Math.pow(2,a-1)),this._debug(s,"refreshing attempt",a),await z(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:_e})),(a,i)=>{const o=200*Math.pow(2,a);return i&&Gt(i)&&Date.now()+o-r<et})}catch(r){if(this._debug(s,"error",r),M(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(s,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,s){const r=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",s,"url",r),fe()&&!s.skipBrowserRedirect&&window.location.assign(r),{data:{provider:t,url:r},error:null}}async _recoverAndRefresh(){var t,s;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const a=await $e(this.storage,this.storageKey);if(a&&this.userStorage){let o=await $e(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:a.user},await tt(this.userStorage,this.storageKey+"-user",o)),a.user=(t=o==null?void 0:o.user)!==null&&t!==void 0?t:Kt()}else if(a&&!a.user&&!a.user){const o=await $e(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(a.user=o.user,await Ce(this.storage,this.storageKey+"-user"),await tt(this.storage,this.storageKey,a)):a.user=Kt()}if(this._debug(r,"session from storage",a),!this._isValidSession(a)){this._debug(r,"session is not valid"),a!==null&&await this._removeSession();return}const i=((s=a.expires_at)!==null&&s!==void 0?s:1/0)*1e3-Date.now()<Wt;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${Wt}s`),i){if(this.autoRefreshToken&&a.refresh_token){const{error:o}=await this._callRefreshToken(a.refresh_token);o&&(console.error(o),Gt(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(a.user&&a.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:l}=await this._getUser(a.access_token);!l&&(o!=null&&o.user)?(a.user=o.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(r,"error",a),console.error(a);return}finally{this._debug(r,"end")}}async _callRefreshToken(t){var s,r;if(!t)throw new Ee;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new Ft;const{data:i,error:o}=await this._refreshAccessToken(t);if(o)throw o;if(!i.session)throw new Ee;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={session:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(a,"error",i),M(i)){const o={session:null,error:i};return Gt(i)||await this._removeSession(),(s=this.refreshingDeferred)===null||s===void 0||s.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(t,s,r=!0){const a=`#_notifyAllSubscribers(${t})`;this._debug(a,"begin",s,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:t,session:s});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(t,s)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(a,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const s=Object.assign({},t),r=s.user&&s.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&s.user&&await tt(this.userStorage,this.storageKey+"-user",{user:s.user});const a=Object.assign({},s);delete a.user;const i=Ws(a);await tt(this.storage,this.storageKey,i)}else{const a=Ws(s);await tt(this.storage,this.storageKey,a)}}async _removeSession(){this._debug("#_removeSession()"),await Ce(this.storage,this.storageKey),await Ce(this.storage,this.storageKey+"-code-verifier"),await Ce(this.storage,this.storageKey+"-user"),this.userStorage&&await Ce(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&fe()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(s){console.error("removing visibilitychange callback failed",s)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),et);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async s=>{const{data:{session:r}}=s;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const a=Math.floor((r.expires_at*1e3-t)/et);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${et}ms, refresh threshold is ${os} ticks`),a<=os&&await this._callRefreshToken(r.refresh_token)})}catch(s){console.error("Auto refresh tick failed with error. This is likely a transient error.",s)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof Sr)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!fe()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const s=`#_onVisibilityChanged(${t})`;this._debug(s,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,s,r){const a=[`provider=${encodeURIComponent(s)}`];if(r!=null&&r.redirectTo&&a.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&a.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await He(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});a.push(l.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);a.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&a.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${t}?${a.join("&")}`}async _unenroll(t){try{return await this._useSession(async s=>{var r;const{data:a,error:i}=s;return i?{data:null,error:i}:await z(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token})})}catch(s){if(M(s))return{data:null,error:s};throw s}}async _enroll(t){try{return await this._useSession(async s=>{var r,a;const{data:i,error:o}=s;if(o)return{data:null,error:o};const l=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:{issuer:t.issuer}),{data:c,error:u}=await z(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return u?{data:null,error:u}:(t.factorType==="totp"&&(!((a=c==null?void 0:c.totp)===null||a===void 0)&&a.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(s){if(M(s))return{data:null,error:s};throw s}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var r;const{data:a,error:i}=s;if(i)return{data:null,error:i};const{data:o,error:l}=await z(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:l})})}catch(s){if(M(s))return{data:null,error:s};throw s}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var r;const{data:a,error:i}=s;return i?{data:null,error:i}:await z(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:{channel:t.channel},headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token})})}catch(s){if(M(s))return{data:null,error:s};throw s}})}async _challengeAndVerify(t){const{data:s,error:r}=await this._challenge({factorId:t.factorId});return r?{data:null,error:r}:await this._verify({factorId:t.factorId,challengeId:s.id,code:t.code})}async _listFactors(){const{data:{user:t},error:s}=await this.getUser();if(s)return{data:null,error:s};const r=(t==null?void 0:t.factors)||[],a=r.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=r.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:r,totp:a,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async t=>{var s,r;const{data:{session:a},error:i}=t;if(i)return{data:null,error:i};if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=Jt(a.access_token);let l=null;o.aal&&(l=o.aal);let c=l;((r=(s=a.user.factors)===null||s===void 0?void 0:s.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(c="aal2");const d=o.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:d},error:null}}))}async fetchJwk(t,s={keys:[]}){let r=s.keys.find(l=>l.kid===t);if(r)return r;const a=Date.now();if(r=this.jwks.keys.find(l=>l.kid===t),r&&this.jwks_cached_at+Dn>a)return r;const{data:i,error:o}=await z(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=a,r=i.keys.find(l=>l.kid===t),!r)?null:r}async getClaims(t,s={}){try{let r=t;if(!r){const{data:p,error:w}=await this.getSession();if(w||!p.session)return{data:null,error:w};r=p.session.access_token}const{header:a,payload:i,signature:o,raw:{header:l,payload:c}}=Jt(r);s!=null&&s.allowExpired||ii(i.exp);const u=!a.alg||a.alg.startsWith("HS")||!a.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(a.kid,s!=null&&s.keys?{keys:s.keys}:s==null?void 0:s.jwks);if(!u){const{error:p}=await this.getUser(r);if(p)throw p;return{data:{claims:i,header:a,signature:o},error:null}}const d=oi(a.alg),h=await crypto.subtle.importKey("jwk",u,d,!0,["verify"]);if(!await crypto.subtle.verify(d,h,o,Gn(`${l}.${c}`)))throw new ds("Invalid JWT signature");return{data:{claims:i,header:a,signature:o},error:null}}catch(r){if(M(r))return{data:null,error:r};throw r}}}mt.nextInstanceID=0;const Ni=mt;class _i extends Ni{constructor(t){super(t)}}var Si=function(n,t,s,r){function a(i){return i instanceof s?i:new s(function(o){o(i)})}return new(s||(s=Promise))(function(i,o){function l(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):a(d.value).then(l,c)}u((r=r.apply(n,[])).next())})};class ki{constructor(t,s,r){var a,i,o;this.supabaseUrl=t,this.supabaseKey=s;const l=In(t);if(!s)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,u={db:jn,realtime:Nn,auth:Object.assign(Object.assign({},wn),{storageKey:c}),global:bn},d=Pn(r??{},u);this.storageKey=(a=d.auth.storageKey)!==null&&a!==void 0?a:"",this.headers=(i=d.global.headers)!==null&&i!==void 0?i:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(h,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=d.auth)!==null&&o!==void 0?o:{},this.headers,d.global.fetch),this.fetch=Cn(s,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new Ba(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),this.storage=new pn(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),d.accessToken||this._listenForAuthEvents()}get functions(){return new va(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,s={},r={}){return this.rest.rpc(t,s,r)}channel(t,s={config:{}}){return this.realtime.channel(t,s)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,s;return Si(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(s=(t=r.session)===null||t===void 0?void 0:t.access_token)!==null&&s!==void 0?s:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:s,detectSessionInUrl:r,storage:a,userStorage:i,storageKey:o,flowType:l,lock:c,debug:u},d,h){const g={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new _i({url:this.authUrl.href,headers:Object.assign(Object.assign({},g),d),storageKey:o,autoRefreshToken:t,persistSession:s,detectSessionInUrl:r,storage:a,userStorage:i,flowType:l,lock:c,debug:u,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(p=>p.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new rn(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((s,r)=>{this._handleTokenChanged(s,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(t,s,r){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:t==="SIGNED_OUT"&&(this.realtime.setAuth(),s=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Ci=(n,t,s)=>new ki(n,t,s);function Ei(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const t=n.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}Ei()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");class Ti{constructor(){vt(this,"isDevelopment",!1)}log(t,s,...r){if(!this.isDevelopment&&t==="debug")return;const i=`[${new Date().toISOString()}] [${t.toUpperCase()}]`;switch(t){case"error":console.error(i,s,...r);break;case"warn":console.warn(i,s,...r);break;case"debug":console.debug(i,s,...r);break;default:console.log(i,s,...r)}}info(t,...s){this.log("info",t,...s)}warn(t,...s){this.log("warn",t,...s)}error(t,...s){this.log("error",t,...s)}debug(t,...s){this.log("debug",t,...s)}}const It=new Ti,Pi="https://lrwwrfgbcfjjxqvcenbx.supabase.co",Ii="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxyd3dyZmdiY2ZqanhxdmNlbmJ4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4MTA0MTksImV4cCI6MjA3MjM4NjQxOX0.W8Ct38soTnzbw2Wbne0D8BcwtG3KU_hB0tqrc8vp2So",Qs=Ci(Pi,Ii),kr=C.createContext(void 0),pt=()=>{const n=C.useContext(kr);if(!n)throw new Error("useAuth must be used within an AuthProvider");return n},Ai=({children:n})=>{const[t,s]=C.useState(null),r=async(i,o)=>{try{const{data:l,error:c}=await Qs.auth.signInWithPassword({email:i,password:o});return c?(console.error("Erro no login:",c.message),!1):(s(l.user),!0)}catch(l){return console.error("Erro inesperado:",l),!1}},a=async()=>{await Qs.auth.signOut(),s(null)};return e.jsx(kr.Provider,{value:{user:t,login:r,logout:a,isAuthenticated:!!t},children:n})},Cr=C.createContext(void 0),Er=()=>{const n=C.useContext(Cr);if(n===void 0)throw new Error("useTheme must be used within a ThemeProvider");return n},Oi=({children:n})=>{const s=()=>{};return e.jsx(Cr.Provider,{value:{isDark:!1,toggleTheme:s},children:n})},Ue=class Ue{static getInstance(){return Ue.instance||(Ue.instance=new Ue),Ue.instance}async requestPermission(){return"Notification"in window?Notification.permission==="granted"?!0:Notification.permission!=="denied"?await Notification.requestPermission()==="granted":!1:(console.log("This browser does not support notifications"),!1)}showNotification(t,s){Notification.permission==="granted"&&new Notification(t,{icon:"/manifest-icon-192.png",badge:"/manifest-icon-192.png",...s})}checkLowStock(t){const s=t.filter(r=>r.stock<=r.minStock&&r.isActive);s.length>0&&this.showNotification(`Estoque Baixo - ${s.length} produto(s)`,{body:`${s.map(r=>r.name).join(", ")} precisam de reposio`,tag:"low-stock"})}notifyNewSale(t,s,r){this.showNotification("Nova Venda Realizada",{body:`Cliente: ${s} - Total: R$ ${r.toFixed(2)}`,tag:"new-sale"})}notifyDeliveryUpdate(t,s,r){const a={pending:"Pendente",in_transit:"Em Trnsito",delivered:"Entregue",failed:"Falhou"}[s]||s;this.showNotification(`Entrega ${a}`,{body:`Cliente: ${r} - Entrega #${t.slice(-6)}`,tag:"delivery-update"})}};vt(Ue,"instance");let us=Ue;function Ri(){const n=us.getInstance();return C.useEffect(()=>{n.requestPermission()},[]),{showNotification:(t,s)=>{n.showNotification(t,s)},checkLowStock:t=>{n.checkLowStock(t)},notifyNewSale:(t,s,r)=>{n.notifyNewSale(t,s,r)},notifyDeliveryUpdate:(t,s,r)=>{n.notifyDeliveryUpdate(t,s,r)}}}const Ze=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const t=Math.random()*16|0;return(n==="x"?t:t&3|8).toString(16)}),Tr=C.createContext(void 0),ye=()=>{const n=C.useContext(Tr);if(n===void 0)throw new Error("useData must be used within a DataProvider");return n},hs={name:"Distribuidora de Gs So Paulo Ltda",document:"98.765.432/0001-10",phone:"(11) 99999-9999",email:"contato@distribuidorasp.com.br",address:{street:"Av. Industrial",number:"1500",district:"Distrito Industrial",city:"So Paulo",zipCode:"08500-000"},logo:"",deliveryRadius:15,minimumDeliveryValue:80,socialMedia:{whatsapp:"(11) 99999-9999",instagram:"@distribuidorasp",facebook:"distribuidoraspoficial"}},Ys={company:hs,notifications:{email:!0,sms:!1,whatsapp:!0},integrations:{whatsappApi:{enabled:!1},paymentGateway:{enabled:!1}},features:{deliveryModule:!0,invoiceGeneration:!0,multiplePaymentMethods:!0,customerPortal:!1}},$i=[{id:"1",name:"Botijo P13 - 13kg",category:"Botijes",price:85,stock:50,minStock:10,unit:"un",description:"Botijo de gs P13 para uso residencial",supplier:"Ultragaz",barcode:"7891234567890",weight:13,isActive:!0},{id:"2",name:"Botijo P20 - 20kg",category:"Botijes",price:120,stock:30,minStock:8,unit:"un",description:"Botijo de gs P20 para uso comercial",supplier:"Ultragaz",barcode:"7891234567891",weight:20,isActive:!0},{id:"3",name:"Regulador de Presso",category:"Acessrios",price:25,stock:100,minStock:20,unit:"un",description:"Regulador de presso para botijes",supplier:"Aliana",barcode:"7891234567892",isActive:!0},{id:"4",name:"Mangueira 1,5m",category:"Acessrios",price:15,stock:80,minStock:15,unit:"un",description:"Mangueira de gs 1,5 metros",supplier:"Aliana",barcode:"7891234567893",isActive:!0}],Di=[{id:"1",name:"Maria Santos",document:"123.456.789-00",phone:"(11) 98765-4321",email:"maria@email.com",address:{street:"Rua das Palmeiras",number:"123",district:"Vila Nova",city:"So Paulo",zipCode:"01234-567",reference:"Prximo  padaria"},totalPurchases:1250,lastPurchase:new Date("2024-12-15"),isActive:!0,customerType:"residential",creditLimit:500},{id:"2",name:"Padaria Central",document:"12.345.678/0001-90",phone:"(11) 91234-5678",email:"contato@padariacentral.com",address:{street:"Rua do Comrcio",number:"456",district:"Centro",city:"So Paulo",zipCode:"01234-568"},totalPurchases:3200,lastPurchase:new Date("2024-12-20"),isActive:!0,customerType:"commercial",creditLimit:1e3}],Li=({children:n})=>{const{checkLowStock:t,notifyNewSale:s,notifyDeliveryUpdate:r}=Ri(),[a,i]=C.useState([]),[o,l]=C.useState([]),[c,u]=C.useState([]),[d,h]=C.useState([]),[g,p]=C.useState([]),[w,E]=C.useState([]),[N,f]=C.useState(hs),[I,b]=C.useState(Ys),[$,k]=C.useState({totalSales:0,totalCustomers:0,lowStockItems:0,pendingPayments:0,monthlyRevenue:0,monthlyExpenses:0,pendingDeliveries:0,completedDeliveries:0,averageTicket:0,topProducts:[]});C.useEffect(()=>{const S=(T,A)=>{const m=localStorage.getItem(T);return m?JSON.parse(m):A};i(S("products",$i)),l(S("customers",Di)),u(S("transactions",[])),h(S("sales",[])),p(S("deliveries",[])),E(S("users",[])),f(S("company",hs)),b(S("settings",Ys))},[]),C.useEffect(()=>{const S=setInterval(()=>{t(a)},3e5);return()=>clearInterval(S)},[a,t]),C.useEffect(()=>{const S=a.filter(J=>J.stock<=J.minStock&&J.isActive).length,T=c.filter(J=>J.status==="pending").length,A=g.filter(J=>J.status==="pending"||J.status==="in_transit").length,m=g.filter(J=>J.status==="delivered").length,O=new Date;O.setDate(1),O.setHours(0,0,0,0);const B=c.filter(J=>J.type==="income"&&new Date(J.date)>=O).reduce((J,ne)=>J+ne.amount,0),je=c.filter(J=>J.type==="expense"&&new Date(J.date)>=O).reduce((J,ne)=>J+ne.amount,0),ae=d.filter(J=>new Date(J.date)>=O),de=ae.length>0?ae.reduce((J,ne)=>J+ne.total,0)/ae.length:0,ke=new Map;d.forEach(J=>{J.items.forEach(ne=>{const Bt=ke.get(ne.productId)||{quantity:0,revenue:0,name:ne.productName};Bt.quantity+=ne.quantity,Bt.revenue+=ne.total,ke.set(ne.productId,Bt)})});const Ir=Array.from(ke.entries()).map(([J,ne])=>({id:J,...ne})).sort((J,ne)=>ne.revenue-J.revenue).slice(0,5);k({totalSales:d.length,totalCustomers:o.length,lowStockItems:S,pendingPayments:T,monthlyRevenue:B,monthlyExpenses:je,pendingDeliveries:A,completedDeliveries:m,averageTicket:de,topProducts:Ir})},[a,o,c,d,g]);const v=(S,T)=>{localStorage.setItem(S,JSON.stringify(T))},y=S=>{const T={...S,id:Ze()},A=[...a,T];i(A),v("products",A)},V=(S,T)=>{const A=a.map(m=>m.id===S?{...m,...T}:m);i(A),v("products",A)},Y=S=>{const T=a.filter(A=>A.id!==S);i(T),v("products",T)},H=S=>{const T={...S,id:Ze()},A=[...o,T];l(A),v("customers",A)},te=(S,T)=>{const A=o.map(m=>m.id===S?{...m,...T}:m);l(A),v("customers",A)},oe=S=>{const T=o.filter(A=>A.id!==S);l(T),v("customers",T)},se=S=>{const T={...S,id:Ze()},A=[...c,T];u(A),v("transactions",A)},_=(S,T)=>{const A=c.map(m=>m.id===S?{...m,...T}:m);u(A),v("transactions",A)},F=S=>{const T=c.filter(A=>A.id!==S);u(T),v("transactions",T)},W=S=>{const T={...S,id:Ze()},A=[...d,T];h(A),v("sales",A);const m=o.find(B=>B.id===S.customerId);m&&s(T.id,m.name,S.total),S.items.forEach(B=>{if(a.find(ae=>ae.id===B.productId)){const ae=a.map(de=>de.id===B.productId?{...de,stock:de.stock-B.quantity}:de);i(ae),v("products",ae)}}),se({type:"income",category:"Venda",description:`Venda #${T.id}`,amount:S.total,date:S.date,status:S.paymentMethod==="cash"?"paid":"pending",customerId:S.customerId,paymentMethod:S.paymentMethod});const O=o.map(B=>B.id===S.customerId?{...B,totalPurchases:B.totalPurchases+S.total,lastPurchase:S.date}:B);l(O),v("customers",O)},j=(S,T)=>{const A=d.map(m=>m.id===S?{...m,...T}:m);h(A),v("sales",A)},q=S=>{const T=d.filter(A=>A.id!==S);h(T),v("sales",T)},G=S=>{const T={...S,id:Ze()},A=[...g,T];p(A),v("deliveries",A)},X=(S,T)=>{const A=g.find(B=>B.id===S),m=A?o.find(B=>B.id===A.customerId):null,O=g.map(B=>B.id===S?{...B,...T}:B);p(O),v("deliveries",O),A&&m&&T.status&&r(S,T.status,m.name)},K=S=>{const T=g.filter(A=>A.id!==S);p(T),v("deliveries",T)},re=S=>{const T={...S,id:Ze()},A=[...w,T];E(A),v("users",A)},be=(S,T)=>{const A=w.map(m=>m.id===S?{...m,...T}:m);E(A),v("users",A)},x=S=>{const T=w.filter(A=>A.id!==S);E(T),v("users",T)},D=S=>{const T={...N,...S};f(T),v("company",T)},L=S=>{const T={...I,...S};b(T),v("settings",T)};return e.jsx(Tr.Provider,{value:{products:a,customers:o,transactions:c,sales:d,deliveries:g,users:w,company:N,settings:I,dashboardStats:$,addProduct:y,updateProduct:V,deleteProduct:Y,addCustomer:H,updateCustomer:te,deleteCustomer:oe,addTransaction:se,updateTransaction:_,deleteTransaction:F,addSale:W,updateSale:j,deleteSale:q,addDelivery:G,updateDelivery:X,deleteDelivery:K,addUser:re,updateUser:be,deleteUser:x,updateCompany:D,updateSettings:L},children:n})},Ui=()=>{const[n,t]=C.useState([]);C.useEffect(()=>{const r=a=>{const{type:i,message:o}=a.detail,l=Math.random().toString(36).substr(2,9);t(c=>[...c,{id:l,type:i,message:o}]),setTimeout(()=>{t(c=>c.filter(u=>u.id!==l))},5e3)};return window.addEventListener("showToast",r),()=>window.removeEventListener("showToast",r)},[]);const s=r=>{t(a=>a.filter(i=>i.id!==r))};return e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:n.map(r=>e.jsx(Fi,{type:r.type,message:r.message,onClose:()=>s(r.id)},r.id))})},Fi=({type:n,message:t,onClose:s,duration:r=5e3})=>{const[a,i]=C.useState(!0);C.useEffect(()=>{const d=setTimeout(()=>{i(!1),setTimeout(s,300)},r);return()=>clearTimeout(d)},[r,s]);const o={success:_t,error:Qt,warning:Ur,info:Lr},l={success:"bg-green-50 border-green-200 text-green-800",error:"bg-red-50 border-red-200 text-red-800",warning:"bg-yellow-50 border-yellow-200 text-yellow-800",info:"bg-blue-50 border-blue-200 text-blue-800"},c={success:"text-green-500",error:"text-red-500",warning:"text-yellow-500",info:"text-blue-500"},u=o[n];return e.jsxs("div",{className:`fixed top-4 right-4 z-50 flex items-center p-4 border rounded-lg shadow-lg transition-all duration-300 ${a?"translate-x-0 opacity-100":"translate-x-full opacity-0"} ${l[n]}`,children:[e.jsx(u,{className:`w-5 h-5 mr-3 ${c[n]}`}),e.jsx("span",{className:"flex-1",children:t}),e.jsx("button",{onClick:()=>{i(!1),setTimeout(s,300)},className:"ml-3 text-gray-400 hover:text-gray-600",children:e.jsx(At,{className:"w-4 h-4"})})]})};function Bi(){const[n,t]=C.useState({isSupported:!0,systemInfo:{userAgent:"",platform:"",language:"",cookiesEnabled:!1,localStorageEnabled:!1,sessionStorageEnabled:!1,onlineStatus:!1},warnings:[],errors:[]});return C.useEffect(()=>{(()=>{const i=[],o=[];let l=!0;const c={userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,cookiesEnabled:navigator.cookieEnabled,localStorageEnabled:Mi(),sessionStorageEnabled:qi(),onlineStatus:navigator.onLine};window.fetch||(o.push("Fetch API no suportada"),l=!1),window.localStorage||(o.push("LocalStorage no suportado"),l=!1),window.sessionStorage||i.push("SessionStorage no suportado"),window.Promise||(o.push("Promises no suportadas"),l=!1),Array.prototype.includes||i.push("Alguns recursos modernos do JavaScript podem no funcionar"),window.innerWidth<320&&i.push("Tela muito pequena - experincia pode ser limitada"),navigator.onLine||i.push("Sem conexo com a internet"),It.info("System Check:",{isSupported:l,systemInfo:c,warnings:i,errors:o}),t({isSupported:l,systemInfo:c,warnings:i,errors:o})})();const r=()=>{t(i=>({...i,systemInfo:{...i.systemInfo,onlineStatus:!0},warnings:i.warnings.filter(o=>!o.includes("conexo"))}))},a=()=>{t(i=>({...i,systemInfo:{...i.systemInfo,onlineStatus:!1},warnings:[...i.warnings,"Sem conexo com a internet"]}))};return window.addEventListener("online",r),window.addEventListener("offline",a),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",a)}},[]),n}function Mi(){try{const n="__localStorage_test__";return localStorage.setItem(n,n),localStorage.removeItem(n),!0}catch{return!1}}function qi(){try{const n="__sessionStorage_test__";return sessionStorage.setItem(n,n),sessionStorage.removeItem(n),!0}catch{return!1}}const zi=()=>{const{isSupported:n,systemInfo:t,warnings:s,errors:r}=Bi();return n&&s.length===0&&r.length===0?null:e.jsxs("div",{className:"fixed bottom-4 right-4 z-50 max-w-sm",children:[e.jsx("div",{className:`mb-2 p-3 rounded-lg shadow-lg ${t.onlineStatus?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[t.onlineStatus?e.jsx(Fr,{className:"w-4 h-4 text-green-600"}):e.jsx(Br,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:`text-sm font-medium ${t.onlineStatus?"text-green-800":"text-red-800"}`,children:t.onlineStatus?"Online":"Offline"})]})}),r.length>0&&e.jsx("div",{className:"mb-2 p-3 bg-red-50 border border-red-200 rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Ve,{className:"w-4 h-4 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Erros do Sistema:"}),e.jsx("ul",{className:"text-xs text-red-700 mt-1 space-y-1",children:r.map((a,i)=>e.jsxs("li",{children:[" ",a]},i))})]})]})}),s.length>0&&e.jsx("div",{className:"mb-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Ve,{className:"w-4 h-4 text-yellow-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Avisos:"}),e.jsx("ul",{className:"text-xs text-yellow-700 mt-1 space-y-1",children:s.map((a,i)=>e.jsxs("li",{children:[" ",a]},i))})]})]})}),n&&s.length===0&&r.length===0&&e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_t,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-800",children:"Sistema funcionando normalmente"})]})})]})},Vi=({onToggleSidebar:n,isSidebarOpen:t})=>{const{user:s,logout:r}=pt(),{company:a}=ye(),[i,o]=C.useState(!1),l=[{id:1,message:"Estoque baixo: Botijo P13",time:"5 min atrs",type:"warning"},{id:2,message:"Nova venda realizada",time:"10 min atrs",type:"success"},{id:3,message:"Entrega pendente",time:"15 min atrs",type:"info"}];return e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200 px-4 py-3 sticky top-0 z-40",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:n,className:"lg:hidden p-2 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors",children:t?e.jsx(At,{className:"w-5 h-5"}):e.jsx(Mr,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg flex items-center justify-center shadow-sm overflow-hidden",children:a.logo?e.jsx("img",{src:a.logo,alt:"Logo",className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-white font-bold text-lg",children:"G+"})}),e.jsxs("div",{className:"hidden sm:block",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 leading-tight",children:a.name}),e.jsx("p",{className:"text-sm text-gray-500",children:"Sistema de Gesto Empresarial"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>o(!i),className:"p-2 text-gray-400 hover:text-gray-600 relative rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx(fs,{className:"w-5 h-5"}),e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full text-xs flex items-center justify-center",children:e.jsx("span",{className:"w-1.5 h-1.5 bg-white rounded-full"})})]}),i&&e.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-lg border border-gray-200 z-50",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsx("h3",{className:"font-semibold text-gray-900",children:"Notificaes"})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:l.map(c=>e.jsxs("div",{className:"p-4 border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("p",{className:"text-sm text-gray-900",children:c.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:c.time})]},c.id))}),e.jsx("div",{className:"p-3 text-center border-t border-gray-200",children:e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-700",children:"Ver todas as notificaes"})})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"hidden sm:block text-right",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s==null?void 0:s.name}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:s==null?void 0:s.role})]}),e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center overflow-hidden",children:s!=null&&s.avatar?e.jsx("img",{src:s.avatar,alt:"Avatar",className:"w-full h-full object-cover"}):e.jsx(ce,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(xs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-red-600 transition-colors rounded-lg hover:bg-red-50",children:e.jsx(qr,{className:"w-4 h-4"})})]})]})]})]})})},Wi=({isOpen:n,onClose:t})=>{var i;const{user:s}=pt(),r=[{path:"/",icon:zr,label:"Dashboard",roles:["admin","seller","delivery","financial"]},{path:"/products",icon:Pe,label:"Estoque",roles:["admin","seller"]},{path:"/customers",icon:ht,label:"Clientes",roles:["admin","seller","delivery"]},{path:"/sales",icon:Be,label:"Vendas",roles:["admin","seller"]},{path:"/deliveries",icon:Me,label:"Entregas",roles:["admin","delivery","seller"]},{path:"/financial",icon:We,label:"Financeiro",roles:["admin","financial"]},{path:"/reports",icon:st,label:"Relatrios",roles:["admin","financial"]},{path:"/users",icon:Vr,label:"Usurios",roles:["admin"]},{path:"/settings",icon:xs,label:"Configuraes",roles:["admin"]}],a=o=>s&&o.includes(s.role);return e.jsxs(e.Fragment,{children:[n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden",onClick:t}),e.jsxs("aside",{className:`
        fixed lg:static inset-y-0 left-0 z-50 w-64 bg-white shadow-sm border-r border-gray-200 
        transform transition-transform duration-300 ease-in-out lg:transform-none
        ${n?"translate-x-0":"-translate-x-full lg:translate-x-0"}
      `,children:[e.jsxs("div",{className:"lg:hidden flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"G+"})}),e.jsx("span",{className:"font-bold text-gray-900",children:"Gas Gesto+"})]}),e.jsx("button",{onClick:t,className:"p-2 rounded-lg text-gray-600 hover:bg-gray-100",children:e.jsx(At,{className:"w-5 h-5"})})]}),e.jsxs("nav",{className:"mt-8 lg:mt-8",children:[e.jsx("div",{className:"px-4 space-y-2",children:r.map(o=>a(o.roles)?e.jsxs(ta,{to:o.path,onClick:()=>window.innerWidth<1024&&t(),className:({isActive:l})=>`flex items-center space-x-3 px-3 py-3 rounded-xl text-sm font-medium transition-all duration-200 ${l?"bg-gradient-to-r from-blue-50 to-blue-100 text-blue-700 shadow-sm border-l-4 border-blue-600":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"}`,children:[e.jsx(o.icon,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{children:o.label})]},o.path):null)}),e.jsx("div",{className:"absolute bottom-4 left-4 right-4 p-3 bg-gray-50 rounded-xl",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-medium text-sm",children:(i=s==null?void 0:s.name)==null?void 0:i.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s==null?void 0:s.name}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:s==null?void 0:s.role})]})]})})]})]})]})},we=({children:n})=>{const[t,s]=C.useState(!1),r=()=>{s(!t)},a=()=>{s(!1)};return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[e.jsx(Vi,{onToggleSidebar:r,isSidebarOpen:t}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx(Wi,{isOpen:t,onClose:a}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 lg:p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:n})})]})]})},P=({variant:n="primary",size:t="md",as:s="button",className:r="",children:a,...i})=>{const o="inline-flex items-center justify-center font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",l={primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",success:"bg-green-600 text-white hover:bg-green-700 focus:ring-green-500",outline:"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:ring-blue-500"},c={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"},u=s;return Dr.createElement(u,{className:gs(o,l[n],c[t],r),...i},a)},R=({label:n,error:t,helper:s,className:r="",...a})=>e.jsxs("div",{className:"space-y-1",children:[n&&e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:n}),e.jsx("input",{className:gs("block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400","focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent","disabled:bg-gray-50 disabled:text-gray-500 disabled:cursor-not-allowed",t&&"border-red-300 focus:ring-red-500",r),...a}),t&&e.jsx("p",{className:"text-sm text-red-600",children:t}),s&&!t&&e.jsx("p",{className:"text-sm text-gray-500",children:s})]}),Gi=()=>{const{login:n,isAuthenticated:t}=pt(),[s,r]=C.useState(""),[a,i]=C.useState(""),[o,l]=C.useState(!1),[c,u]=C.useState("");if(t)return e.jsx(ps,{to:"/",replace:!0});const d=async h=>{h.preventDefault(),l(!0),u(""),await n(s,a)||u("Email ou senha incorretos"),l(!1)};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-md w-full space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-blue-600 rounded-xl flex items-center justify-center mb-4",children:e.jsx("span",{className:"text-white font-bold text-2xl",children:"G+"})}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:"Gas Gesto+"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Sistema de gesto empresarial"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("form",{onSubmit:d,className:"space-y-6",children:[e.jsx("div",{children:e.jsx(R,{label:"Email",type:"email",value:s,onChange:h=>r(h.target.value),placeholder:"seu@email.com",required:!0})}),e.jsx("div",{children:e.jsx(R,{label:"Senha",type:"password",value:a,onChange:h=>i(h.target.value),placeholder:"********",required:!0})}),c&&e.jsx("div",{className:"text-red-600 text-sm text-center",children:c}),e.jsxs(P,{type:"submit",className:"w-full",disabled:o,children:[e.jsx(Wr,{className:"w-4 h-4 mr-2"}),o?"Entrando...":"Entrar"]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{children:e.jsx("strong",{children:"Usurio padro:"})}),e.jsx("p",{children:"Email: admin@gasgestao.com"}),e.jsx("p",{children:"Senha: admin123"})]})})]})]})})},U=({children:n,className:t="",padding:s=!0})=>e.jsx("div",{className:gs("bg-white rounded-xl shadow-sm border border-gray-200",s&&"p-6",t),children:n}),Ji=()=>{const{dashboardStats:n,products:t,sales:s,deliveries:r,customers:a,transactions:i,users:o,company:l}=ye(),{isDark:c}=Er(),u=new Date;u.setDate(1),u.setHours(0,0,0,0);const d=s.filter(v=>new Date(v.date)>=u),h=d.reduce((v,y)=>v+y.total,0),g=i.filter(v=>new Date(v.date)>=u);g.filter(v=>v.type==="income"&&v.status==="paid").reduce((v,y)=>v+y.amount,0),g.filter(v=>v.type==="expense"&&v.status==="paid").reduce((v,y)=>v+y.amount,0);const p=t.filter(v=>v.stock<=v.minStock&&v.isActive).length,w=r.filter(v=>v.status==="pending"||v.status==="in_transit").length,E=r.filter(v=>v.status==="delivered").length,N=d.length>0?h/d.length:0,f=[{month:"Jan",sales:4500,revenue:12e3,deliveries:45},{month:"Fev",sales:5200,revenue:15500,deliveries:52},{month:"Mar",sales:4800,revenue:13200,deliveries:48},{month:"Abr",sales:6100,revenue:18500,deliveries:61},{month:"Mai",sales:5800,revenue:17200,deliveries:58},{month:"Jun",sales:d.length,revenue:h,deliveries:E}],I=[{name:"Botijo P13",value:45,color:"#3B82F6"},{name:"Botijo P20",value:25,color:"#10B981"},{name:"Botijo P45",value:20,color:"#F59E0B"},{name:"Acessrios",value:10,color:"#EF4444"}],b=s.slice(-5).reverse(),$=t.filter(v=>v.stock<=v.minStock&&v.isActive).slice(0,5),k=[{title:"Vendas do Ms",value:d.length.toString(),icon:Be,color:"blue",change:"+12%",trend:"up",subtitle:`Ticket mdio: R$ ${N.toFixed(2)}`},{title:"Total de Clientes",value:a.length.toString(),icon:ht,color:"green",change:"+5%",trend:"up",subtitle:"Clientes ativos"},{title:"Entregas Pendentes",value:w.toString(),icon:Me,color:"orange",change:"-8%",trend:"down",subtitle:`${E} entregues`},{title:"Receita Mensal",value:`R$ ${h.toLocaleString("pt-BR")}`,icon:We,color:"purple",change:"+18%",trend:"up",subtitle:"Faturamento bruto"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-gray-900",children:"Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Viso geral do seu negcio"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 bg-white px-3 py-2 rounded-lg border border-gray-200",children:[e.jsx(Ot,{className:"w-4 h-4"}),e.jsxs("span",{children:["ltima atualizao: ",new Date().toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-orange-600 bg-orange-50 px-3 py-2 rounded-lg border border-orange-200",children:[e.jsx(fs,{className:"w-4 h-4"}),e.jsxs("span",{children:[p," alertas"]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-4 gap-4 lg:gap-6",children:k.map((v,y)=>{const V={blue:"bg-blue-50 text-blue-600 border-blue-200",green:"bg-green-50 text-green-600 border-green-200",orange:"bg-orange-50 text-orange-600 border-orange-200",purple:"bg-purple-50 text-purple-600 border-purple-200"};return e.jsx(U,{className:"hover:shadow-lg transition-all duration-200 transform hover:-translate-y-1 min-h-[160px] p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-3 leading-tight",children:v.title}),e.jsx("p",{className:"text-2xl lg:text-3xl font-bold text-gray-900 mb-3 leading-tight",children:v.value}),e.jsx("p",{className:"text-sm text-gray-500 mb-4 leading-tight",children:v.subtitle}),e.jsxs("div",{className:"flex items-center",children:[v.trend==="up"?e.jsx(Gr,{className:"w-4 h-4 text-green-500 mr-1"}):e.jsx(Jr,{className:"w-4 h-4 text-red-500 mr-1"}),e.jsx("span",{className:`text-sm font-medium ${v.trend==="up"?"text-green-600":"text-red-600"}`,children:v.change}),e.jsx("span",{className:"text-xs text-gray-500 ml-1",children:"vs ms anterior"})]})]}),e.jsx("div",{className:`p-3 rounded-xl border ${V[v.color]}`,children:e.jsx(v.icon,{className:"w-6 h-6"})})]})},y)})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs(U,{className:"xl:col-span-2 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Receita e Vendas"}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),e.jsx("span",{className:"text-gray-600",children:"Receita"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-2"}),e.jsx("span",{className:"text-gray-600",children:"Entregas"})]})]})]}),e.jsx(qe,{width:"100%",height:350,children:e.jsxs(aa,{data:f,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3B82F6",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#3B82F6",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorDeliveries",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10B981",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#10B981",stopOpacity:0})]})]}),e.jsx(kt,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(Ct,{dataKey:"month",stroke:"#6b7280"}),e.jsx(Et,{stroke:"#6b7280"}),e.jsx(ze,{contentStyle:{backgroundColor:"white",color:"#111827",border:"1px solid #e5e7eb",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},formatter:(v,y)=>[y==="revenue"?`R$ ${v}`:v,y==="revenue"?"Receita":"Entregas"]}),e.jsx(Is,{type:"monotone",dataKey:"revenue",stroke:"#3B82F6",fillOpacity:1,fill:"url(#colorRevenue)",strokeWidth:2}),e.jsx(Is,{type:"monotone",dataKey:"deliveries",stroke:"#10B981",fillOpacity:1,fill:"url(#colorDeliveries)",strokeWidth:2})]})})]}),e.jsxs(U,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Distribuio de Produtos"}),e.jsx(qe,{width:"100%",height:350,children:e.jsxs(vs,{children:[e.jsx(ys,{data:I,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:5,dataKey:"value",children:I.map((v,y)=>e.jsx(bs,{fill:v.color},`cell-${y}`))}),e.jsx(ze,{formatter:v=>[`${v}%`,"Participao"]})]})}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-4",children:I.map((v,y)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-2 flex-shrink-0",style:{backgroundColor:v.color}}),e.jsx("span",{className:"text-sm text-gray-600 truncate",children:v.name})]},y))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsxs(U,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Vendas Recentes"}),e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Ver todas"})]}),e.jsx("div",{className:"space-y-4",children:b.length>0?b.map(v=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Be,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-gray-900",children:["Venda #",v.id.slice(-6)]}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(v.date).toLocaleDateString("pt-BR")})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-gray-900 text-lg",children:["R$ ",v.total.toFixed(2)]}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${v.status==="delivered"?"bg-green-100 text-green-800":v.status==="confirmed"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:v.status==="delivered"?"Entregue":v.status==="confirmed"?"Confirmado":"Pendente"})]})]},v.id)):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Be,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"Nenhuma venda recente"})]})})]}),e.jsxs(U,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Estoque Baixo"}),e.jsxs("span",{className:"bg-red-100 text-red-800 text-xs font-medium px-2.5 py-0.5 rounded-full",children:[n.lowStockItems," itens"]})]}),e.jsx("div",{className:"space-y-4",children:$.length>0?$.map(v=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(Ve,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:v.name}),e.jsx("p",{className:"text-sm text-gray-500",children:v.category})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-red-600 text-lg",children:[v.stock," ",v.unit]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Mn: ",v.minStock]})]})]},v.id)):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Pe,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"Estoque em nveis normais"})]})})]})]}),e.jsxs(U,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Atividades Recentes"}),e.jsx("div",{className:"space-y-4",children:[{type:"sale",message:"Nova venda realizada - Cliente: Joo Silva",time:"2 min atrs",icon:Be,color:"green"},{type:"stock",message:"Estoque baixo - Botijo P13",time:"15 min atrs",icon:Ve,color:"red"},{type:"delivery",message:"Entrega realizada - Pedido #12345",time:"30 min atrs",icon:Me,color:"blue"},{type:"payment",message:"Pagamento recebido - R$ 850,00",time:"1h atrs",icon:We,color:"purple"},{type:"customer",message:"Novo cliente cadastrado - Maria Santos",time:"2h atrs",icon:ht,color:"green"}].map((v,y)=>{const V={green:"bg-green-100 text-green-600",red:"bg-red-100 text-red-600",blue:"bg-blue-100 text-blue-600",purple:"bg-purple-100 text-purple-600"};return e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:`p-3 rounded-lg ${V[v.color]}`,children:e.jsx(v.icon,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:v.message}),e.jsx("p",{className:"text-sm text-gray-500",children:v.time})]})]},y)})})]})]})},ve=({isOpen:n,onClose:t,title:s,children:r,size:a="md"})=>{if(C.useEffect(()=>(n?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[n]),!n)return null;const i={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"};return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:t}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen",children:""}),e.jsxs("div",{className:`inline-block w-full ${i[a]} p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:s}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(At,{className:"w-6 h-6"})})]}),r]})]})})},Ki=()=>{const{products:n,addProduct:t,updateProduct:s,deleteProduct:r}=ye(),[a,i]=C.useState(""),[o,l]=C.useState(!1),[c,u]=C.useState(null),[d,h]=C.useState({name:"",category:"",price:"",stock:"",minStock:"",unit:"",description:"",supplier:""}),g=n.filter(f=>f.name.toLowerCase().includes(a.toLowerCase())||f.category.toLowerCase().includes(a.toLowerCase())),p=f=>{f?(u(f),h({name:f.name,category:f.category,price:f.price.toString(),stock:f.stock.toString(),minStock:f.minStock.toString(),unit:f.unit,description:f.description||"",supplier:f.supplier||""})):(u(null),h({name:"",category:"",price:"",stock:"",minStock:"",unit:"",description:"",supplier:""})),l(!0)},w=()=>{l(!1),u(null)},E=f=>{f.preventDefault();const I={name:d.name,category:d.category,price:parseFloat(d.price),stock:parseInt(d.stock),minStock:parseInt(d.minStock),unit:d.unit,description:d.description,supplier:d.supplier,isActive:!0};c?s(c.id,I):t(I),w()},N=f=>{confirm("Tem certeza que deseja excluir este produto?")&&r(f)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gesto de Estoque"}),e.jsxs(P,{onClick:()=>p(),className:"w-full sm:w-auto",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Novo Produto"]})]}),e.jsxs(U,{children:[e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4 mb-6",children:e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(at,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Buscar produtos...",value:a,onChange:f=>i(f.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsx("div",{className:"xl:hidden space-y-4",children:g.map(f=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-14 h-14 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Pe,{className:"w-7 h-7 text-blue-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-lg leading-tight",children:f.name}),e.jsx("p",{className:"text-gray-600 mt-1",children:f.category}),f.supplier&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Fornecedor: ",f.supplier]})]})]}),f.stock<=f.minStock?e.jsxs("span",{className:"inline-flex items-center px-3 py-1 text-sm font-medium bg-red-100 text-red-800 rounded-full flex-shrink-0",children:[e.jsx(Ve,{className:"w-3 h-3 mr-1"}),"Baixo"]}):e.jsx("span",{className:"inline-flex items-center px-3 py-1 text-sm font-medium bg-green-100 text-green-800 rounded-full flex-shrink-0",children:"Normal"})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"Preo:"}),e.jsxs("span",{className:"font-bold text-green-600 text-lg",children:["R$ ",f.price.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"Estoque:"}),e.jsxs("span",{className:"font-bold text-gray-900 text-lg",children:[f.stock," ",f.unit]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"Mnimo:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[f.minStock," ",f.unit]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block",children:"Cdigo:"}),e.jsxs("span",{className:"font-medium text-gray-900 text-xs",children:["#",f.id.slice(-6)]})]})]}),f.description&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-600 block mb-1",children:"Descrio:"}),e.jsx("p",{className:"text-gray-900 text-sm leading-relaxed",children:f.description})]}),f.barcode&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-600 block",children:"Cdigo de Barras:"}),e.jsx("span",{className:"font-mono text-sm text-gray-900",children:f.barcode})]}),f.weight&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-600 block",children:"Peso:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[f.weight,"kg"]})]})]}),e.jsx("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(P,{size:"sm",variant:"outline",onClick:()=>p(f),children:[e.jsx(ge,{className:"w-3 h-3 mr-1"}),"Editar"]}),e.jsxs(P,{size:"sm",variant:"danger",onClick:()=>N(f.id),children:[e.jsx(ue,{className:"w-3 h-3 mr-1"}),"Excluir"]})]})})]},f.id))}),e.jsxs("div",{className:"hidden xl:block overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Produto"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Categoria"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Preo"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Estoque"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Aes"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:g.map(f=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Pe,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:f.name}),e.jsx("p",{className:"text-sm text-gray-500",children:f.unit})]})]})}),e.jsx("td",{className:"py-4 px-2 text-gray-600",children:f.category}),e.jsx("td",{className:"py-4 px-2 text-gray-900 font-medium",children:e.jsxs("span",{className:"font-bold text-lg",children:["R$ ",f.price.toFixed(2)]})}),e.jsxs("td",{className:"py-4 px-2",children:[e.jsxs("span",{className:"font-semibold text-gray-900",children:[f.stock," ",f.unit]}),e.jsxs("span",{className:"text-gray-500 text-sm ml-1",children:["(min: ",f.minStock,")"]})]}),e.jsx("td",{className:"py-4 px-2",children:f.stock<=f.minStock?e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800",children:[e.jsx(Ve,{className:"w-3 h-3 mr-1"}),"Baixo"]}):e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800",children:"Normal"})}),e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{size:"sm",variant:"outline",onClick:()=>p(f),children:e.jsx(ge,{className:"w-3 h-3"})}),e.jsx(P,{size:"sm",variant:"danger",onClick:()=>N(f.id),children:e.jsx(ue,{className:"w-3 h-3"})})]})})]},f.id))})]}),g.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Pe,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Nenhum produto encontrado"})]})]})]}),e.jsx(ve,{isOpen:o,onClose:w,title:c?"Editar Produto":"Novo Produto",size:"lg",children:e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Nome do Produto",value:d.name,onChange:f=>h({...d,name:f.target.value}),required:!0}),e.jsx(R,{label:"Categoria",value:d.category,onChange:f=>h({...d,category:f.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(R,{label:"Preo (R$)",type:"number",step:"0.01",value:d.price,onChange:f=>h({...d,price:f.target.value}),required:!0}),e.jsx(R,{label:"Estoque Atual",type:"number",value:d.stock,onChange:f=>h({...d,stock:f.target.value}),required:!0}),e.jsx(R,{label:"Estoque Mnimo",type:"number",value:d.minStock,onChange:f=>h({...d,minStock:f.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Unidade",value:d.unit,onChange:f=>h({...d,unit:f.target.value}),placeholder:"ex: un, kg, L",required:!0}),e.jsx(R,{label:"Fornecedor",value:d.supplier,onChange:f=>h({...d,supplier:f.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descrio"}),e.jsx("textarea",{value:d.description,onChange:f=>h({...d,description:f.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Descrio opcional do produto..."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(P,{type:"button",variant:"outline",onClick:w,children:"Cancelar"}),e.jsxs(P,{type:"submit",children:[c?"Atualizar":"Adicionar"," Produto"]})]})]})})]})},Hi=()=>{const{customers:n,addCustomer:t,updateCustomer:s,deleteCustomer:r}=ye(),[a,i]=C.useState(""),[o,l]=C.useState(!1),[c,u]=C.useState(null),[d,h]=C.useState({name:"",document:"",phone:"",email:"",street:"",number:"",district:"",city:"",zipCode:""}),g=n.filter(f=>f.name.toLowerCase().includes(a.toLowerCase())||f.document.includes(a)||f.phone.includes(a)),p=f=>{f?(u(f),h({name:f.name,document:f.document,phone:f.phone,email:f.email||"",street:f.address.street,number:f.address.number,district:f.address.district,city:f.address.city,zipCode:f.address.zipCode})):(u(null),h({name:"",document:"",phone:"",email:"",street:"",number:"",district:"",city:"",zipCode:""})),l(!0)},w=()=>{l(!1),u(null)},E=f=>{f.preventDefault();const I={name:d.name,document:d.document,phone:d.phone,email:d.email,address:{street:d.street,number:d.number,district:d.district,city:d.city,zipCode:d.zipCode},totalPurchases:(c==null?void 0:c.totalPurchases)||0,isActive:!0,customerType:"residential"};c?s(c.id,I):t(I),w()},N=f=>{confirm("Tem certeza que deseja excluir este cliente?")&&r(f)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gesto de Clientes"}),e.jsxs(P,{onClick:()=>p(),className:"w-full sm:w-auto",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Novo Cliente"]})]}),e.jsxs(U,{children:[e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4 mb-6",children:e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(at,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Buscar clientes...",value:a,onChange:f=>i(f.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-6",children:g.map(f=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-14 h-14 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(ce,{className:"w-7 h-7 text-blue-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-lg leading-tight",children:f.name}),e.jsx("p",{className:"text-gray-500 mt-1",children:f.document}),e.jsx("p",{className:"text-sm text-gray-500 mt-1 capitalize",children:f.customerType==="residential"?"Residencial":"Comercial"})]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsxs(P,{size:"sm",variant:"outline",onClick:()=>p(f),children:[e.jsx(ge,{className:"w-3 h-3 mr-1"}),"Editar"]}),e.jsxs(P,{size:"sm",variant:"danger",onClick:()=>N(f.id),children:[e.jsx(ue,{className:"w-3 h-3 mr-1"}),"Excluir"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(Kr,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"font-medium",children:f.phone})]}),f.email&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx("span",{className:"w-4 h-4 mr-2 text-center",children:"@"}),e.jsx("span",{className:"font-medium break-all",children:f.email})]}),e.jsxs("div",{className:"flex items-start text-gray-600",children:[e.jsx(Yt,{className:"w-4 h-4 mr-2"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-medium leading-tight",children:[f.address.street,", ",f.address.number]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[f.address.district,", ",f.address.city]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["CEP: ",f.address.zipCode]}),f.address.complement&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Complemento: ",f.address.complement]}),f.address.reference&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Referncia: ",f.address.reference]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block",children:"Total de Compras:"}),e.jsxs("span",{className:"font-bold text-green-600 text-lg",children:["R$ ",f.totalPurchases.toFixed(2)]})]}),f.creditLimit&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block",children:"Limite de Crdito:"}),e.jsxs("span",{className:"font-semibold text-blue-600 text-lg",children:["R$ ",f.creditLimit.toFixed(2)]})]})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-3",children:["ID: ",e.jsxs("span",{className:"font-mono text-xs",children:["#",f.id.slice(-8)]})]}),f.lastPurchase&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["ltima compra: ",new Date(f.lastPurchase).toLocaleDateString("pt-BR")]}),f.notes&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-gray-500 text-sm block",children:"Observaes:"}),e.jsx("p",{className:"text-sm text-gray-900 mt-1 leading-relaxed",children:f.notes})]})]})]})]},f.id))}),g.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ce,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Nenhum cliente encontrado"})]})]}),e.jsx(ve,{isOpen:o,onClose:w,title:c?"Editar Cliente":"Novo Cliente",size:"lg",children:e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Nome Completo",value:d.name,onChange:f=>h({...d,name:f.target.value}),required:!0}),e.jsx(R,{label:"CPF/CNPJ",value:d.document,onChange:f=>h({...d,document:f.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Telefone",value:d.phone,onChange:f=>h({...d,phone:f.target.value}),required:!0}),e.jsx(R,{label:"Email",type:"email",value:d.email,onChange:f=>h({...d,email:f.target.value})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Endereo"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(R,{label:"Logradouro",value:d.street,onChange:f=>h({...d,street:f.target.value}),required:!0})}),e.jsx(R,{label:"Nmero",value:d.number,onChange:f=>h({...d,number:f.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(R,{label:"Bairro",value:d.district,onChange:f=>h({...d,district:f.target.value}),required:!0}),e.jsx(R,{label:"Cidade",value:d.city,onChange:f=>h({...d,city:f.target.value}),required:!0}),e.jsx(R,{label:"CEP",value:d.zipCode,onChange:f=>h({...d,zipCode:f.target.value}),required:!0})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(P,{type:"button",variant:"outline",onClick:w,children:"Cancelar"}),e.jsxs(P,{type:"submit",children:[c?"Atualizar":"Adicionar"," Cliente"]})]})]})})]})},ks=({isOpen:n,onClose:t,onConfirm:s,title:r,message:a,confirmText:i="Confirmar",cancelText:o="Cancelar",type:l="danger"})=>{const c=()=>{s(),t()};return e.jsx(ve,{isOpen:n,onClose:t,title:r,size:"sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center w-12 h-12 rounded-full bg-red-100 mb-4",children:e.jsx(Ve,{className:"w-6 h-6 text-red-600"})}),e.jsx("p",{className:"text-gray-600 mb-6",children:a}),e.jsxs("div",{className:"flex justify-center space-x-3",children:[e.jsx(P,{variant:"outline",onClick:t,children:o}),e.jsx(P,{variant:l==="danger"?"danger":"primary",onClick:c,children:i})]})]})})};class Pr{static generateSaleReceipt(t,s,r){const a=window.open("","_blank");if(!a)return;const i=`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Recibo de Venda #${t.id.slice(-6)}</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; }
          .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 20px; }
          .company-name { font-size: 24px; font-weight: bold; color: #2563EB; }
          .company-info { margin-top: 10px; color: #666; }
          .sale-info { margin: 20px 0; }
          .items-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
          .items-table th, .items-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
          .items-table th { background-color: #f5f5f5; }
          .total-section { margin-top: 20px; text-align: right; }
          .total-line { margin: 5px 0; }
          .total-final { font-size: 18px; font-weight: bold; border-top: 2px solid #333; padding-top: 10px; }
          .footer { margin-top: 40px; text-align: center; color: #666; font-size: 12px; }
          @media print { body { margin: 0; } }
        </style>
      </head>
      <body>
        <div class="header">
          <div class="company-name">${r.name}</div>
          <div class="company-info">
            ${r.document} | ${r.phone}<br>
            ${r.address.street}, ${r.address.number} - ${r.address.city}
          </div>
        </div>

        <div class="sale-info">
          <h2>Recibo de Venda #${t.id.slice(-6)}</h2>
          <p><strong>Data:</strong> ${new Date(t.date).toLocaleDateString("pt-BR")}</p>
          <p><strong>Cliente:</strong> ${s.name}</p>
          <p><strong>Documento:</strong> ${s.document}</p>
          <p><strong>Telefone:</strong> ${s.phone}</p>
          <p><strong>Forma de Pagamento:</strong> ${t.paymentMethod}</p>
        </div>

        <table class="items-table">
          <thead>
            <tr>
              <th>Produto</th>
              <th>Quantidade</th>
              <th>Preo Unit.</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            ${t.items.map(o=>`
              <tr>
                <td>${o.productName}</td>
                <td>${o.quantity}</td>
                <td>R$ ${o.price.toFixed(2)}</td>
                <td>R$ ${o.total.toFixed(2)}</td>
              </tr>
            `).join("")}
          </tbody>
        </table>

        <div class="total-section">
          <div class="total-line">Subtotal: R$ ${t.subtotal.toFixed(2)}</div>
          ${t.discount>0?`<div class="total-line">Desconto: R$ ${t.discount.toFixed(2)}</div>`:""}
          ${t.deliveryFee>0?`<div class="total-line">Taxa de Entrega: R$ ${t.deliveryFee.toFixed(2)}</div>`:""}
          <div class="total-final">Total: R$ ${t.total.toFixed(2)}</div>
        </div>

        <div class="footer">
          <p>Obrigado pela preferncia!</p>
          <p>Sistema Gas Gesto+ - ${new Date().toLocaleDateString("pt-BR")}</p>
        </div>
      </body>
      </html>
    `;a.document.write(i),a.document.close(),a.print()}static generateDeliveryList(t,s,r){const a=window.open("","_blank");if(!a)return;const i=`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Lista de Entregas</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; }
          .header { text-align: center; margin-bottom: 30px; }
          .delivery-item { border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 5px; }
          .delivery-header { font-weight: bold; color: #2563EB; margin-bottom: 10px; }
          .delivery-info { margin: 5px 0; }
          .items-list { margin: 10px 0; padding-left: 20px; }
          @media print { body { margin: 0; } }
        </style>
      </head>
      <body>
        <div class="header">
          <h1>Lista de Entregas - ${new Date().toLocaleDateString("pt-BR")}</h1>
        </div>

        ${t.map(o=>{const l=s.find(u=>u.id===o.customerId),c=r.find(u=>u.id===o.deliveryPersonId);return`
            <div class="delivery-item">
              <div class="delivery-header">Entrega #${o.id.slice(-6)}</div>
              <div class="delivery-info"><strong>Cliente:</strong> ${l==null?void 0:l.name}</div>
              <div class="delivery-info"><strong>Telefone:</strong> ${l==null?void 0:l.phone}</div>
              <div class="delivery-info"><strong>Endereo:</strong> ${o.address.street}, ${o.address.number} - ${o.address.district}</div>
              <div class="delivery-info"><strong>Entregador:</strong> ${c==null?void 0:c.name}</div>
              <div class="delivery-info"><strong>Data Agendada:</strong> ${new Date(o.scheduledDate).toLocaleString("pt-BR")}</div>
              <div class="delivery-info"><strong>Status:</strong> ${o.status}</div>
              <div class="items-list">
                <strong>Itens:</strong>
                <ul>
                  ${o.items.map(u=>`<li>${u.productName} - ${u.quantity}x</li>`).join("")}
                </ul>
              </div>
              ${o.notes?`<div class="delivery-info"><strong>Observaes:</strong> ${o.notes}</div>`:""}
            </div>
          `}).join("")}
      </body>
      </html>
    `;a.document.write(i),a.document.close(),a.print()}}const Qi=()=>{var re,be;const{sales:n,customers:t,products:s,company:r,addSale:a,updateSale:i,deleteSale:o}=ye(),[l,c]=C.useState(""),[u,d]=C.useState("all"),[h,g]=C.useState(!1),[p,w]=C.useState(!1),[E,N]=C.useState({isOpen:!1,saleId:""}),[f,I]=C.useState(null),[b,$]=C.useState(null),[k,v]=C.useState({customerId:"",items:[{productId:"",quantity:1,price:0}],discount:0,paymentMethod:"cash",deliveryFee:0,notes:"",deliveryAddress:{street:"",number:"",district:"",city:"",zipCode:"",complement:"",reference:""}}),y=n.filter(x=>{const D=t.find(T=>T.id===x.customerId),L=(D==null?void 0:D.name.toLowerCase().includes(l.toLowerCase()))||x.id.toLowerCase().includes(l.toLowerCase()),S=u==="all"||x.status===u;return L&&S}),V=x=>{if(x){I(x);const D=t.find(L=>L.id===x.customerId);v({customerId:x.customerId,items:x.items.map(L=>({productId:L.productId,quantity:L.quantity,price:L.price})),discount:x.discount,paymentMethod:x.paymentMethod,deliveryFee:x.deliveryFee,notes:x.notes||"",deliveryAddress:x.deliveryAddress||(D==null?void 0:D.address)||{street:"",number:"",district:"",city:"",zipCode:"",complement:"",reference:""}})}else I(null),v({customerId:"",items:[{productId:"",quantity:1,price:0}],discount:0,paymentMethod:"cash",deliveryFee:0,notes:"",deliveryAddress:{street:"",number:"",district:"",city:"",zipCode:"",complement:"",reference:""}});g(!0)},Y=x=>{$(x),w(!0)},H=()=>{g(!1),w(!1),I(null),$(null)},te=()=>{v({...k,items:[...k.items,{productId:"",quantity:1,price:0}]})},oe=x=>{k.items.length>1&&v({...k,items:k.items.filter((D,L)=>L!==x)})},se=(x,D,L)=>{const S=k.items.map((T,A)=>{if(A===x){const m={...T,[D]:L};if(D==="productId"){const O=s.find(B=>B.id===L);m.price=(O==null?void 0:O.price)||0}return m}return T});v({...k,items:S})},_=()=>k.items.reduce((x,D)=>x+D.quantity*D.price,0),F=()=>_()-k.discount+k.deliveryFee,W=x=>{x.preventDefault();const D=_(),L=F(),S={customerId:k.customerId,items:k.items.map(T=>{const A=s.find(m=>m.id===T.productId);return{productId:T.productId,productName:(A==null?void 0:A.name)||"",quantity:T.quantity,price:T.price,total:T.quantity*T.price}}),subtotal:D,discount:k.discount,total:L,date:new Date,status:"pending",paymentMethod:k.paymentMethod,sellerId:"1",deliveryFee:k.deliveryFee,notes:k.notes,deliveryAddress:k.deliveryAddress};f?i(f.id,S):a(S),H()},j=x=>{N({isOpen:!0,saleId:x})},q=()=>{o(E.saleId),N({isOpen:!1,saleId:""})},G=x=>{const D=t.find(L=>L.id===x.customerId);D&&Pr.generateSaleReceipt(x,D,r)},X=x=>{switch(x){case"delivered":return"bg-green-100 text-green-800";case"confirmed":return"bg-blue-100 text-blue-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-yellow-100 text-yellow-800"}},K=x=>{switch(x){case"delivered":return"Entregue";case"confirmed":return"Confirmado";case"cancelled":return"Cancelado";default:return"Pendente"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-gray-900",children:"Gesto de Vendas"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Controle completo das suas vendas"})]}),e.jsxs(P,{onClick:()=>V(),className:"w-full sm:w-auto",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Nova Venda"]})]}),e.jsxs(U,{children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(at,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Buscar vendas...",value:l,onChange:x=>c(x.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("select",{value:u,onChange:x=>d(x.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"Todos os status"}),e.jsx("option",{value:"pending",children:"Pendente"}),e.jsx("option",{value:"confirmed",children:"Confirmado"}),e.jsx("option",{value:"delivered",children:"Entregue"}),e.jsx("option",{value:"cancelled",children:"Cancelado"})]})})]}),e.jsx("div",{className:"lg:hidden space-y-4",children:y.map(x=>{const D=t.find(L=>L.id===x.customerId);return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900",children:["Venda #",x.id.slice(-6)]}),e.jsx("p",{className:"text-sm text-gray-600",children:D==null?void 0:D.name})]}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${X(x.status)}`,children:K(x.status)})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Data:"}),e.jsx("span",{className:"font-medium",children:new Date(x.date).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsxs("span",{className:"font-bold text-green-600",children:["R$ ",x.total.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Itens:"}),e.jsx("span",{className:"font-medium",children:x.items.length})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{size:"sm",variant:"outline",onClick:()=>Y(x),children:e.jsx(Ie,{className:"w-3 h-3"})}),e.jsx(P,{size:"sm",variant:"outline",onClick:()=>V(x),children:e.jsx(ge,{className:"w-3 h-3"})}),e.jsx(P,{size:"sm",variant:"outline",onClick:()=>G(x),children:"Imprimir"}),e.jsx(P,{size:"sm",variant:"danger",onClick:()=>j(x.id),children:e.jsx(ue,{className:"w-3 h-3"})})]}),e.jsx("span",{className:"text-xs text-gray-500 capitalize",children:x.paymentMethod})]})]},x.id)})}),e.jsxs("div",{className:"hidden lg:block overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Venda"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Cliente"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Data"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Itens"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Total"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Aes"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:y.map(x=>{const D=t.find(L=>L.id===x.customerId);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Be,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["#",x.id.slice(-6)]}),e.jsx("p",{className:"text-sm text-gray-500 capitalize",children:x.paymentMethod})]})]})}),e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-900",children:D==null?void 0:D.name})]})}),e.jsx("td",{className:"py-4 px-2 text-gray-600",children:new Date(x.date).toLocaleDateString("pt-BR")}),e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-900",children:[x.items.length," itens"]})]})}),e.jsx("td",{className:"py-4 px-2",children:e.jsxs("span",{className:"font-bold text-green-600",children:["R$ ",x.total.toFixed(2)]})}),e.jsx("td",{className:"py-4 px-2",children:e.jsx("span",{className:`inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium ${X(x.status)}`,children:K(x.status)})}),e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{size:"sm",variant:"outline",onClick:()=>Y(x),children:e.jsx(Ie,{className:"w-3 h-3"})}),e.jsx(P,{size:"sm",variant:"outline",onClick:()=>V(x),children:e.jsx(ge,{className:"w-3 h-3"})}),e.jsx(P,{size:"sm",variant:"outline",onClick:()=>G(x),children:"Imprimir"}),e.jsx(P,{size:"sm",variant:"danger",onClick:()=>j(x.id),children:e.jsx(ue,{className:"w-3 h-3"})})]})})]},x.id)})})]}),y.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Be,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Nenhuma venda encontrada"})]})]})]}),e.jsx(ve,{isOpen:h,onClose:H,title:f?"Editar Venda":"Nova Venda",size:"xl",children:e.jsxs("form",{onSubmit:W,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cliente"}),e.jsxs("select",{value:k.customerId,onChange:x=>v({...k,customerId:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"Selecione um cliente"}),t.map(x=>e.jsx("option",{value:x.id,children:x.name},x.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Forma de Pagamento"}),e.jsxs("select",{value:k.paymentMethod,onChange:x=>v({...k,paymentMethod:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"cash",children:"Dinheiro"}),e.jsx("option",{value:"card",children:"Carto"}),e.jsx("option",{value:"pix",children:"PIX"}),e.jsx("option",{value:"credit",children:"Credirio"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Itens da Venda"}),e.jsxs(P,{type:"button",size:"sm",onClick:te,children:[e.jsx(Ae,{className:"w-4 h-4 mr-1"}),"Adicionar Item"]})]}),e.jsx("div",{className:"space-y-3",children:k.items.map((x,D)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{children:e.jsxs("select",{value:x.productId,onChange:L=>se(D,"productId",L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",required:!0,children:[e.jsx("option",{value:"",children:"Selecione um produto"}),s.filter(L=>L.isActive).map(L=>e.jsx("option",{value:L.id,children:L.name},L.id))]})}),e.jsx("div",{children:e.jsx("input",{type:"number",min:"1",value:x.quantity,onChange:L=>se(D,"quantity",parseInt(L.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"Qtd",required:!0})}),e.jsx("div",{children:e.jsx("input",{type:"number",step:"0.01",value:x.price,onChange:L=>se(D,"price",parseFloat(L.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"Preo",required:!0})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["R$ ",(x.quantity*x.price).toFixed(2)]}),k.items.length>1&&e.jsx(P,{type:"button",size:"sm",variant:"danger",onClick:()=>oe(D),children:e.jsx(ue,{className:"w-3 h-3"})})]})]},D))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(R,{label:"Desconto (R$)",type:"number",step:"0.01",value:k.discount,onChange:x=>v({...k,discount:parseFloat(x.target.value)||0})}),e.jsx(R,{label:"Taxa de Entrega (R$)",type:"number",step:"0.01",value:k.deliveryFee,onChange:x=>v({...k,deliveryFee:parseFloat(x.target.value)||0})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Total"}),e.jsxs("div",{className:"px-3 py-2 bg-gray-100 border border-gray-300 rounded-lg text-lg font-bold text-green-600",children:["R$ ",F().toFixed(2)]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observaes"}),e.jsx("textarea",{value:k.notes,onChange:x=>v({...k,notes:x.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Observaes sobre a venda..."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx(P,{type:"button",variant:"outline",onClick:H,children:"Cancelar"}),e.jsxs(P,{type:"submit",children:[f?"Atualizar":"Criar"," Venda"]})]})]})}),e.jsx(ve,{isOpen:p,onClose:H,title:`Venda #${b==null?void 0:b.id.slice(-6)}`,size:"lg",children:b&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Informaes da Venda"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Data:"}),e.jsx("span",{className:"font-medium",children:new Date(b.date).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${X(b.status)}`,children:K(b.status)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Pagamento:"}),e.jsx("span",{className:"font-medium capitalize",children:b.paymentMethod})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Cliente"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium",children:(re=t.find(x=>x.id===b.customerId))==null?void 0:re.name}),e.jsx("p",{className:"text-gray-600",children:(be=t.find(x=>x.id===b.customerId))==null?void 0:be.phone})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Itens"}),e.jsx("div",{className:"space-y-2",children:b.items.map((x,D)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:x.productName}),e.jsxs("p",{className:"text-sm text-gray-600",children:[x.quantity,"x R$ ",x.price.toFixed(2)]})]}),e.jsxs("span",{className:"font-medium text-gray-900",children:["R$ ",x.total.toFixed(2)]})]},D))})]}),e.jsx("div",{className:"border-t border-gray-200 pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",b.subtotal.toFixed(2)]})]}),b.discount>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Desconto:"}),e.jsxs("span",{className:"font-medium text-red-600",children:["- R$ ",b.discount.toFixed(2)]})]}),b.deliveryFee>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Taxa de Entrega:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",b.deliveryFee.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t border-gray-200 pt-2",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["R$ ",b.total.toFixed(2)]})]})]})}),b.notes&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Observaes"}),e.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded-lg",children:b.notes})]})]})}),e.jsx(ks,{isOpen:E.isOpen,onClose:()=>N({isOpen:!1,saleId:""}),onConfirm:q,title:"Excluir Venda",message:"Tem certeza que deseja excluir esta venda? Esta ao no pode ser desfeita.",confirmText:"Excluir",cancelText:"Cancelar"})]})},Yi=()=>{var F,W;const{deliveries:n,sales:t,customers:s,users:r,addDelivery:a,updateDelivery:i}=ye(),[o,l]=C.useState(""),[c,u]=C.useState("all"),[d,h]=C.useState(!1),[g,p]=C.useState(!1),[w,E]=C.useState(null),[N,f]=C.useState(null),[I,b]=C.useState({saleId:"",deliveryPersonId:"",scheduledDate:"",notes:"",route:""}),$=t.filter(j=>j.status==="confirmed"&&!n.some(q=>q.saleId===j.id)),k=n.filter(j=>{const q=s.find(re=>re.id===j.customerId),G=r.find(re=>re.id===j.deliveryPersonId),X=(q==null?void 0:q.name.toLowerCase().includes(o.toLowerCase()))||j.id.toLowerCase().includes(o.toLowerCase())||(G==null?void 0:G.name.toLowerCase().includes(o.toLowerCase())),K=c==="all"||j.status===c;return X&&K}),v=j=>{j?(E(j),b({saleId:j.saleId,deliveryPersonId:j.deliveryPersonId,scheduledDate:new Date(j.scheduledDate).toISOString().slice(0,16),notes:j.notes||"",route:j.route||""})):(E(null),b({saleId:"",deliveryPersonId:"",scheduledDate:"",notes:"",route:""})),h(!0)},y=j=>{f(j),p(!0)},V=()=>{h(!1),p(!1),E(null),f(null)},Y=j=>{j.preventDefault();const q=t.find(K=>K.id===I.saleId);if(!q)return;const G=s.find(K=>K.id===q.customerId);if(!G)return;const X={saleId:I.saleId,customerId:q.customerId,deliveryPersonId:I.deliveryPersonId,status:"pending",scheduledDate:new Date(I.scheduledDate),address:q.deliveryAddress||G.address,items:q.items.map(K=>({productId:K.productId,productName:K.productName,quantity:K.quantity})),deliveryFee:q.deliveryFee,notes:I.notes,route:I.route};w?i(w.id,X):a(X),V()},H=(j,q)=>{const G={status:q};q==="delivered"&&(G.deliveredDate=new Date),i(j,G)},te=j=>{switch(j){case"delivered":return"bg-green-100 text-green-800";case"in_transit":return"bg-blue-100 text-blue-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-yellow-100 text-yellow-800"}},oe=j=>{switch(j){case"delivered":return"Entregue";case"in_transit":return"Em Trnsito";case"failed":return"Falhou";default:return"Pendente"}},se=j=>{switch(j){case"delivered":return _t;case"in_transit":return Me;case"failed":return Qt;default:return Cs}},_=r.filter(j=>j.role==="delivery"&&j.isActive);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-gray-900",children:"Gesto de Entregas"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Controle completo das suas entregas"})]}),e.jsxs(P,{onClick:()=>v(),className:"w-full sm:w-auto",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Nova Entrega"]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(U,{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-yellow-100 rounded-lg mx-auto mb-3",children:e.jsx(Cs,{className:"w-6 h-6 text-yellow-600"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.filter(j=>j.status==="pending").length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Pendentes"})]}),e.jsxs(U,{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-blue-100 rounded-lg mx-auto mb-3",children:e.jsx(Me,{className:"w-6 h-6 text-blue-600"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.filter(j=>j.status==="in_transit").length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Em Trnsito"})]}),e.jsxs(U,{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-green-100 rounded-lg mx-auto mb-3",children:e.jsx(_t,{className:"w-6 h-6 text-green-600"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.filter(j=>j.status==="delivered").length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Entregues"})]}),e.jsxs(U,{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-red-100 rounded-lg mx-auto mb-3",children:e.jsx(Qt,{className:"w-6 h-6 text-red-600"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.filter(j=>j.status==="failed").length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Falharam"})]})]}),e.jsxs(U,{children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(at,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Buscar entregas...",value:o,onChange:j=>l(j.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("select",{value:c,onChange:j=>u(j.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"Todos os status"}),e.jsx("option",{value:"pending",children:"Pendente"}),e.jsx("option",{value:"in_transit",children:"Em Trnsito"}),e.jsx("option",{value:"delivered",children:"Entregue"}),e.jsx("option",{value:"failed",children:"Falhou"})]})})]}),e.jsx("div",{className:"lg:hidden space-y-4",children:k.map(j=>{const q=s.find(K=>K.id===j.customerId),G=r.find(K=>K.id===j.deliveryPersonId),X=se(j.status);return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${te(j.status).replace("text-","bg-").replace("800","100")}`,children:e.jsx(X,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900",children:["Entrega #",j.id.slice(-6)]}),e.jsx("p",{className:"text-sm text-gray-600",children:q==null?void 0:q.name})]})]}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${te(j.status)}`,children:oe(j.status)})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(Ot,{className:"w-4 h-4 mr-2"}),new Date(j.scheduledDate).toLocaleDateString("pt-BR")]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),G==null?void 0:G.name]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(Yt,{className:"w-4 h-4 mr-2"}),j.address.street,", ",j.address.number]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{size:"sm",variant:"outline",onClick:()=>y(j),children:e.jsx(Ie,{className:"w-3 h-3"})}),e.jsx(P,{size:"sm",variant:"outline",onClick:()=>v(j),children:e.jsx(ge,{className:"w-3 h-3"})}),j.status==="pending"&&e.jsx(P,{size:"sm",onClick:()=>H(j.id,"in_transit"),children:"Iniciar"}),j.status==="in_transit"&&e.jsx(P,{size:"sm",variant:"success",onClick:()=>H(j.id,"delivered"),children:"Entregar"})]}),e.jsxs("span",{className:"text-sm font-medium text-green-600",children:["R$ ",j.deliveryFee.toFixed(2)]})]})]},j.id)})}),e.jsxs("div",{className:"hidden lg:block overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Entrega"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Cliente"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Entregador"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Data"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Endereo"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Aes"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:k.map(j=>{const q=s.find(K=>K.id===j.customerId),G=r.find(K=>K.id===j.deliveryPersonId),X=se(j.status);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${te(j.status).replace("text-","bg-").replace("800","100")}`,children:e.jsx(X,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["#",j.id.slice(-6)]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[j.items.length," itens"]})]})]})}),e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-900",children:q==null?void 0:q.name})]})}),e.jsx("td",{className:"py-4 px-2 text-gray-600",children:G==null?void 0:G.name}),e.jsx("td",{className:"py-4 px-2 text-gray-600",children:new Date(j.scheduledDate).toLocaleDateString("pt-BR")}),e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Yt,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-900 truncate max-w-xs",children:[j.address.street,", ",j.address.number]})]})}),e.jsx("td",{className:"py-4 px-2",children:e.jsx("span",{className:`inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium ${te(j.status)}`,children:oe(j.status)})}),e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{size:"sm",variant:"outline",onClick:()=>y(j),children:e.jsx(Ie,{className:"w-3 h-3"})}),e.jsx(P,{size:"sm",variant:"outline",onClick:()=>v(j),children:e.jsx(ge,{className:"w-3 h-3"})}),j.status==="pending"&&e.jsx(P,{size:"sm",onClick:()=>H(j.id,"in_transit"),children:"Iniciar"}),j.status==="in_transit"&&e.jsx(P,{size:"sm",variant:"success",onClick:()=>H(j.id,"delivered"),children:"Entregar"})]})})]},j.id)})})]}),k.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Me,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Nenhuma entrega encontrada"})]})]})]}),e.jsx(ve,{isOpen:d,onClose:V,title:w?"Editar Entrega":"Nova Entrega",size:"lg",children:e.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Venda"}),e.jsxs("select",{value:I.saleId,onChange:j=>b({...I,saleId:j.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:!!w,children:[e.jsx("option",{value:"",children:"Selecione uma venda"}),(w?t:$).map(j=>{const q=s.find(G=>G.id===j.customerId);return e.jsxs("option",{value:j.id,children:["Venda #",j.id.slice(-6)," - ",q==null?void 0:q.name]},j.id)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Entregador"}),e.jsxs("select",{value:I.deliveryPersonId,onChange:j=>b({...I,deliveryPersonId:j.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"Selecione um entregador"}),_.map(j=>e.jsx("option",{value:j.id,children:j.name},j.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Data/Hora Agendada",type:"datetime-local",value:I.scheduledDate,onChange:j=>b({...I,scheduledDate:j.target.value}),required:!0}),e.jsx(R,{label:"Rota",value:I.route,onChange:j=>b({...I,route:j.target.value}),placeholder:"Ex: Rota A, Centro"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observaes"}),e.jsx("textarea",{value:I.notes,onChange:j=>b({...I,notes:j.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Observaes sobre a entrega..."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(P,{type:"button",variant:"outline",onClick:V,children:"Cancelar"}),e.jsxs(P,{type:"submit",children:[w?"Atualizar":"Criar"," Entrega"]})]})]})}),e.jsx(ve,{isOpen:g,onClose:V,title:`Entrega #${N==null?void 0:N.id.slice(-6)}`,size:"lg",children:N&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Informaes da Entrega"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Data Agendada:"}),e.jsx("span",{className:"font-medium",children:new Date(N.scheduledDate).toLocaleString("pt-BR")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${te(N.status)}`,children:oe(N.status)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Taxa de Entrega:"}),e.jsxs("span",{className:"font-medium",children:["R$ ",N.deliveryFee.toFixed(2)]})]}),N.deliveredDate&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Data de Entrega:"}),e.jsx("span",{className:"font-medium",children:new Date(N.deliveredDate).toLocaleString("pt-BR")})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Cliente e Entregador"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Cliente:"}),e.jsx("p",{className:"font-medium",children:(F=s.find(j=>j.id===N.customerId))==null?void 0:F.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Entregador:"}),e.jsx("p",{className:"font-medium",children:(W=r.find(j=>j.id===N.deliveryPersonId))==null?void 0:W.name})]}),N.route&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Rota:"}),e.jsx("p",{className:"font-medium",children:N.route})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Endereo de Entrega"}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs("p",{className:"text-sm",children:[N.address.street,", ",N.address.number,N.address.complement&&`, ${N.address.complement}`]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[N.address.district,", ",N.address.city," - ",N.address.zipCode]}),N.address.reference&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("strong",{children:"Referncia:"})," ",N.address.reference]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Itens para Entrega"}),e.jsx("div",{className:"space-y-2",children:N.items.map((j,q)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Pe,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-900",children:j.productName})]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[j.quantity,"x"]})]},q))})]}),N.notes&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Observaes"}),e.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded-lg",children:N.notes})]})]})})]})},Xi=()=>{const{transactions:n,customers:t,addTransaction:s,updateTransaction:r,deleteTransaction:a}=ye(),[i,o]=C.useState(""),[l,c]=C.useState("all"),[u,d]=C.useState("all"),[h,g]=C.useState(!1),[p,w]=C.useState(!1),[E,N]=C.useState({isOpen:!1,transactionId:""}),[f,I]=C.useState(null),[b,$]=C.useState({type:"income",category:"",description:"",amount:"",date:new Date().toISOString().slice(0,10),dueDate:"",status:"pending",paymentMethod:"",customerId:"",installments:1,currentInstallment:1}),[k,v]=C.useState({type:"nfe",customerId:"",items:[{description:"",quantity:1,unitPrice:0,total:0}],observations:"",issueDate:new Date().toISOString().slice(0,10)}),y=n.filter(m=>{const O=m.customerId?t.find(de=>de.id===m.customerId):null,B=m.description.toLowerCase().includes(i.toLowerCase())||m.category.toLowerCase().includes(i.toLowerCase())||O&&O.name.toLowerCase().includes(i.toLowerCase()),je=l==="all"||m.type===l,ae=u==="all"||m.status===u;return B&&je&&ae}),V=new Date;V.setDate(1),V.setHours(0,0,0,0);const Y=n.filter(m=>m.type==="income"&&new Date(m.date)>=V&&m.status==="paid").reduce((m,O)=>m+O.amount,0),H=n.filter(m=>m.type==="expense"&&new Date(m.date)>=V&&m.status==="paid").reduce((m,O)=>m+O.amount,0),te=n.filter(m=>m.type==="income"&&m.status==="pending").reduce((m,O)=>m+O.amount,0),oe=n.filter(m=>m.type==="expense"&&m.status==="pending").reduce((m,O)=>m+O.amount,0),se=[{month:"Jan",income:15e3,expenses:8e3},{month:"Fev",income:18e3,expenses:9500},{month:"Mar",income:16500,expenses:8800},{month:"Abr",income:22e3,expenses:11e3},{month:"Mai",income:19500,expenses:9800},{month:"Jun",income:Y,expenses:H}],_=[{name:"Vendas",value:65,color:"#10B981"},{name:"Servios",value:20,color:"#3B82F6"},{name:"Outros",value:15,color:"#F59E0B"}],F=m=>{m?(I(m),$({type:m.type,category:m.category,description:m.description,amount:m.amount.toString(),date:new Date(m.date).toISOString().slice(0,10),dueDate:m.dueDate?new Date(m.dueDate).toISOString().slice(0,10):"",status:m.status,paymentMethod:m.paymentMethod||"",customerId:m.customerId||"",installments:m.installments||1,currentInstallment:m.currentInstallment||1})):(I(null),$({type:"income",category:"",description:"",amount:"",date:new Date().toISOString().slice(0,10),dueDate:"",status:"pending",paymentMethod:"",customerId:"",installments:1,currentInstallment:1})),g(!0)},W=()=>{g(!1),I(null)},j=m=>{m.preventDefault();const O={type:b.type,category:b.category,description:b.description,amount:parseFloat(b.amount),date:new Date(b.date),dueDate:b.dueDate?new Date(b.dueDate):void 0,status:b.status,paymentMethod:b.paymentMethod||void 0,customerId:b.customerId||void 0,installments:b.installments,currentInstallment:b.currentInstallment};f?r(f.id,O):s(O),W()},q=m=>{N({isOpen:!0,transactionId:m})},G=()=>{a(E.transactionId),N({isOpen:!1,transactionId:""})},X=()=>{v({type:"nfe",customerId:"",items:[{description:"",quantity:1,unitPrice:0,total:0}],observations:"",issueDate:new Date().toISOString().slice(0,10)}),w(!0)},K=()=>{v({...k,items:[...k.items,{description:"",quantity:1,unitPrice:0,total:0}]})},re=(m,O,B)=>{const je=k.items.map((ae,de)=>{if(de===m){const ke={...ae,[O]:B};return(O==="quantity"||O==="unitPrice")&&(ke.total=ke.quantity*ke.unitPrice),ke}return ae});v({...k,items:je})},be=m=>{k.items.length>1&&v({...k,items:k.items.filter((O,B)=>B!==m)})},x=m=>{var je;m.preventDefault();const O=k.items.reduce((ae,de)=>ae+de.total,0);s({type:"income",category:"Nota Fiscal",description:`${k.type.toUpperCase()} - ${((je=k.items[0])==null?void 0:je.description)||"Venda"}`,amount:O,date:new Date(k.issueDate),status:"pending",customerId:k.customerId||void 0,paymentMethod:"Nota Fiscal"});const B=new CustomEvent("showToast",{detail:{type:"success",message:`${k.type.toUpperCase()} emitida com sucesso!`}});window.dispatchEvent(B),w(!1)},D=m=>{switch(m){case"paid":return"bg-green-100 text-green-800";case"overdue":return"bg-red-100 text-red-800";case"cancelled":return"bg-gray-100 text-gray-800";default:return"bg-yellow-100 text-yellow-800"}},L=m=>{switch(m){case"paid":return"Pago";case"overdue":return"Vencido";case"cancelled":return"Cancelado";default:return"Pendente"}},S=["Vendas","Servios","Outros"],T=["Fornecedores","Salrios","Aluguel","Combustvel","Manuteno","Marketing","Outros"],A=["Dinheiro","PIX","Carto de Dbito","Carto de Crdito","Transferncia Bancria","Boleto","Cheque","Credirio"];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-gray-900",children:"Gesto Financeira"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Controle completo das suas finanas"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(P,{onClick:()=>F(),className:"w-full sm:w-auto",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Nova Transao"]}),e.jsxs(P,{onClick:X,variant:"outline",className:"w-full sm:w-auto",children:[e.jsx(Hr,{className:"w-4 h-4 mr-2"}),"Emitir Nota"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6",children:[e.jsxs(U,{className:"text-center hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-green-100 rounded-lg mx-auto mb-3",children:e.jsx(st,{className:"w-6 h-6 text-green-600"})}),e.jsxs("p",{className:"text-2xl lg:text-3xl font-bold text-green-600 mb-1",children:["R$ ",Y.toLocaleString("pt-BR")]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Receitas do Ms"})]}),e.jsxs(U,{className:"text-center hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-red-100 rounded-lg mx-auto mb-3",children:e.jsx(Mt,{className:"w-6 h-6 text-red-600"})}),e.jsxs("p",{className:"text-2xl lg:text-3xl font-bold text-red-600 mb-1",children:["R$ ",H.toLocaleString("pt-BR")]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Despesas do Ms"})]}),e.jsxs(U,{className:"text-center hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-blue-100 rounded-lg mx-auto mb-3",children:e.jsx(We,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("p",{className:"text-2xl lg:text-3xl font-bold text-blue-600 mb-1",children:["R$ ",te.toLocaleString("pt-BR")]}),e.jsx("p",{className:"text-sm text-gray-600",children:"A Receber"})]}),e.jsxs(U,{className:"text-center hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-orange-100 rounded-lg mx-auto mb-3",children:e.jsx(Ot,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("p",{className:"text-2xl lg:text-3xl font-bold text-orange-600 mb-1",children:["R$ ",oe.toLocaleString("pt-BR")]}),e.jsx("p",{className:"text-sm text-gray-600",children:"A Pagar"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs(U,{className:"xl:col-span-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Fluxo de Caixa Mensal"}),e.jsx(qe,{width:"100%",height:300,children:e.jsxs(Zs,{data:se,children:[e.jsx(kt,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(Ct,{dataKey:"month",stroke:"#6b7280"}),e.jsx(Et,{stroke:"#6b7280"}),e.jsx(ze,{formatter:m=>[`R$ ${m}`,""],contentStyle:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(Zt,{dataKey:"income",fill:"#10B981",name:"Receitas",radius:[4,4,0,0]}),e.jsx(Zt,{dataKey:"expenses",fill:"#EF4444",name:"Despesas",radius:[4,4,0,0]})]})})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(U,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Receitas por Categoria"}),e.jsx(qe,{width:"100%",height:200,children:e.jsxs(vs,{children:[e.jsx(ys,{data:_,cx:"50%",cy:"50%",innerRadius:40,outerRadius:80,paddingAngle:5,dataKey:"value",children:_.map((m,O)=>e.jsx(bs,{fill:m.color},`cell-${O}`))}),e.jsx(ze,{formatter:m=>[`${m}%`,"Participao"]})]})}),e.jsx("div",{className:"grid grid-cols-1 gap-2 mt-4",children:_.map((m,O)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:m.color}}),e.jsx("span",{className:"text-sm text-gray-600",children:m.name})]}),e.jsxs("span",{className:"text-sm font-medium",children:[m.value,"%"]})]},O))})]})})]}),e.jsxs(U,{children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(at,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Buscar transaes...",value:i,onChange:m=>o(m.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("select",{value:l,onChange:m=>c(m.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"Todos os tipos"}),e.jsx("option",{value:"income",children:"Receitas"}),e.jsx("option",{value:"expense",children:"Despesas"})]}),e.jsxs("select",{value:u,onChange:m=>d(m.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"Todos os status"}),e.jsx("option",{value:"pending",children:"Pendente"}),e.jsx("option",{value:"paid",children:"Pago"}),e.jsx("option",{value:"overdue",children:"Vencido"}),e.jsx("option",{value:"cancelled",children:"Cancelado"})]})]})]}),e.jsx("div",{className:"lg:hidden space-y-4",children:y.map(m=>{const O=m.customerId?t.find(B=>B.id===m.customerId):null;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${m.type==="income"?"bg-green-100":"bg-red-100"}`,children:m.type==="income"?e.jsx(st,{className:"w-5 h-5 text-green-600"}):e.jsx(Mt,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:m.description}),e.jsx("p",{className:"text-sm text-gray-600",children:m.category})]})]}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${D(m.status)}`,children:L(m.status)})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Valor:"}),e.jsxs("span",{className:`font-bold ${m.type==="income"?"text-green-600":"text-red-600"}`,children:[m.type==="income"?"+":"-"," R$ ",m.amount.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Data:"}),e.jsx("span",{className:"font-medium",children:new Date(m.date).toLocaleDateString("pt-BR")})]}),O&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Cliente:"}),e.jsx("span",{className:"font-medium",children:O.name})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{size:"sm",variant:"outline",onClick:()=>F(m),children:e.jsx(ge,{className:"w-3 h-3"})}),e.jsx(P,{size:"sm",variant:"danger",onClick:()=>q(m.id),children:e.jsx(ue,{className:"w-3 h-3"})})]}),m.paymentMethod&&e.jsx("span",{className:"text-xs text-gray-500 capitalize",children:m.paymentMethod})]})]},m.id)})}),e.jsxs("div",{className:"hidden lg:block overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Tipo"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Descrio"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Categoria"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Valor"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Data"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Aes"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:y.map(m=>{var O;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${m.type==="income"?"bg-green-100":"bg-red-100"}`,children:m.type==="income"?e.jsx(st,{className:"w-4 h-4 text-green-600"}):e.jsx(Mt,{className:"w-4 h-4 text-red-600"})}),e.jsx("span",{className:"text-sm font-medium capitalize",children:m.type==="income"?"Receita":"Despesa"})]})}),e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:m.description}),m.customerId&&e.jsx("p",{className:"text-sm text-gray-500",children:(O=t.find(B=>B.id===m.customerId))==null?void 0:O.name})]})}),e.jsx("td",{className:"py-4 px-2 text-gray-600",children:m.category}),e.jsx("td",{className:"py-4 px-2",children:e.jsxs("span",{className:`font-bold ${m.type==="income"?"text-green-600":"text-red-600"}`,children:[m.type==="income"?"+":"-"," R$ ",m.amount.toFixed(2)]})}),e.jsx("td",{className:"py-4 px-2 text-gray-600",children:new Date(m.date).toLocaleDateString("pt-BR")}),e.jsx("td",{className:"py-4 px-2",children:e.jsx("span",{className:`inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium ${D(m.status)}`,children:L(m.status)})}),e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{size:"sm",variant:"outline",onClick:()=>F(m),children:e.jsx(ge,{className:"w-3 h-3"})}),e.jsx(P,{size:"sm",variant:"danger",onClick:()=>q(m.id),children:e.jsx(ue,{className:"w-3 h-3"})})]})})]},m.id)})})]}),y.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(We,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Nenhuma transao encontrada"})]})]})]}),e.jsx(ve,{isOpen:h,onClose:W,title:f?"Editar Transao":"Nova Transao",size:"lg",children:e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo"}),e.jsxs("select",{value:b.type,onChange:m=>$({...b,type:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"income",children:"Receita"}),e.jsx("option",{value:"expense",children:"Despesa"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoria"}),e.jsxs("select",{value:b.category,onChange:m=>$({...b,category:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"Selecione uma categoria"}),(b.type==="income"?S:T).map(m=>e.jsx("option",{value:m,children:m},m))]})]})]}),e.jsx(R,{label:"Descrio",value:b.description,onChange:m=>$({...b,description:m.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Valor (R$)",type:"number",step:"0.01",value:b.amount,onChange:m=>$({...b,amount:m.target.value}),required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:b.status,onChange:m=>$({...b,status:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"pending",children:"Pendente"}),e.jsx("option",{value:"paid",children:"Pago"}),e.jsx("option",{value:"overdue",children:"Vencido"}),e.jsx("option",{value:"cancelled",children:"Cancelado"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Data",type:"date",value:b.date,onChange:m=>$({...b,date:m.target.value}),required:!0}),e.jsx(R,{label:"Data de Vencimento",type:"date",value:b.dueDate,onChange:m=>$({...b,dueDate:m.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Forma de Pagamento",list:"payment-methods",value:b.paymentMethod,onChange:m=>$({...b,paymentMethod:m.target.value}),placeholder:"Selecione ou digite"}),e.jsx("datalist",{id:"payment-methods",children:A.map(m=>e.jsx("option",{value:m},m))}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cliente (opcional)"}),e.jsxs("select",{value:b.customerId,onChange:m=>$({...b,customerId:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione um cliente"}),t.map(m=>e.jsx("option",{value:m.id,children:m.name},m.id))]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(P,{type:"button",variant:"outline",onClick:W,children:"Cancelar"}),e.jsxs(P,{type:"submit",children:[f?"Atualizar":"Adicionar"," Transao"]})]})]})}),e.jsx(ve,{isOpen:p,onClose:()=>w(!1),title:"Emitir Nota Fiscal",size:"xl",children:e.jsxs("form",{onSubmit:x,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Nota"}),e.jsxs("select",{value:k.type,onChange:m=>v({...k,type:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"nfe",children:"NFe - Nota Fiscal Eletrnica"}),e.jsx("option",{value:"nfce",children:"NFCe - Nota Fiscal Consumidor"}),e.jsx("option",{value:"receipt",children:"Recibo Simples"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cliente"}),e.jsxs("select",{value:k.customerId,onChange:m=>v({...k,customerId:m.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione um cliente"}),t.map(m=>e.jsx("option",{value:m.id,children:m.name},m.id))]})]}),e.jsx(R,{label:"Data de Emisso",type:"date",value:k.issueDate,onChange:m=>v({...k,issueDate:m.target.value})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Itens da Nota"}),e.jsxs(P,{type:"button",size:"sm",onClick:K,children:[e.jsx(Ae,{className:"w-4 h-4 mr-1"}),"Adicionar Item"]})]}),e.jsx("div",{className:"space-y-3",children:k.items.map((m,O)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx("input",{type:"text",value:m.description,onChange:B=>re(O,"description",B.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"Descrio do item",required:!0})}),e.jsx("div",{children:e.jsx("input",{type:"number",min:"1",value:m.quantity,onChange:B=>re(O,"quantity",parseInt(B.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"Qtd",required:!0})}),e.jsx("div",{children:e.jsx("input",{type:"number",step:"0.01",value:m.unitPrice,onChange:B=>re(O,"unitPrice",parseFloat(B.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"Preo Unit.",required:!0})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["R$ ",m.total.toFixed(2)]}),k.items.length>1&&e.jsx(P,{type:"button",size:"sm",variant:"danger",onClick:()=>be(O),children:e.jsx(ue,{className:"w-3 h-3"})})]})]},O))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observaes"}),e.jsx("textarea",{value:k.observations,onChange:m=>v({...k,observations:m.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Observaes da nota fiscal..."})]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Total da Nota:"}),e.jsxs("span",{className:"text-2xl font-bold text-blue-600",children:["R$ ",k.items.reduce((m,O)=>m+O.total,0).toFixed(2)]})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx(P,{type:"button",variant:"outline",onClick:()=>w(!1),children:"Cancelar"}),e.jsxs(P,{type:"submit",children:[e.jsx(Qr,{className:"w-4 h-4 mr-2"}),"Emitir Nota"]})]})]})}),e.jsx(ks,{isOpen:E.isOpen,onClose:()=>N({isOpen:!1,transactionId:""}),onConfirm:G,title:"Excluir Transao",message:"Tem certeza que deseja excluir esta transao? Esta ao no pode ser desfeita.",confirmText:"Excluir",cancelText:"Cancelar"})]})};class Nt{static exportToCSV(t,s){if(t.length===0)return;const r=Object.keys(t[0]),a=[r.join(","),...t.map(c=>r.map(u=>{const d=c[u];return typeof d=="string"&&d.includes(",")?`"${d}"`:d}).join(","))].join(`
`),i=new Blob([a],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),l=URL.createObjectURL(i);o.setAttribute("href",l),o.setAttribute("download",`${s}.csv`),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)}static exportSalesReport(t,s){const r=t.map(a=>{const i=s.find(o=>o.id===a.customerId);return{"ID da Venda":a.id,Data:new Date(a.date).toLocaleDateString("pt-BR"),Cliente:(i==null?void 0:i.name)||"N/A",Documento:(i==null?void 0:i.document)||"N/A",Subtotal:a.subtotal,Desconto:a.discount,"Taxa de Entrega":a.deliveryFee,Total:a.total,"Forma de Pagamento":a.paymentMethod,Status:a.status,Itens:a.items.length}});this.exportToCSV(r,"relatorio-vendas")}static exportCustomersReport(t){const s=t.map(r=>({ID:r.id,Nome:r.name,Documento:r.document,Telefone:r.phone,Email:r.email||"N/A",Cidade:r.address.city,Bairro:r.address.district,"Total de Compras":r.totalPurchases,"ltima Compra":r.lastPurchase?new Date(r.lastPurchase).toLocaleDateString("pt-BR"):"N/A",Status:r.isActive?"Ativo":"Inativo"}));this.exportToCSV(s,"relatorio-clientes")}static exportProductsReport(t){const s=t.map(r=>({ID:r.id,Nome:r.name,Categoria:r.category,Preo:r.price,"Estoque Atual":r.stock,"Estoque Mnimo":r.minStock,Unidade:r.unit,Fornecedor:r.supplier||"N/A",Status:r.isActive?"Ativo":"Inativo"}));this.exportToCSV(s,"relatorio-produtos")}static exportFinancialReport(t){const s=t.map(r=>({ID:r.id,Data:new Date(r.date).toLocaleDateString("pt-BR"),Tipo:r.type==="income"?"Receita":"Despesa",Categoria:r.category,Descrio:r.description,Valor:r.amount,Status:r.status,"Forma de Pagamento":r.paymentMethod||"N/A","Data de Vencimento":r.dueDate?new Date(r.dueDate).toLocaleDateString("pt-BR"):"N/A"}));this.exportToCSV(s,"relatorio-financeiro")}}const Zi=()=>{const{sales:n,customers:t,products:s,transactions:r,deliveries:a}=ye(),[i,o]=C.useState({start:new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString().slice(0,10),end:new Date().toISOString().slice(0,10)}),[l,c]=C.useState("sales"),u=(_,F)=>{const W=new Date(i.start),j=new Date(i.end);return j.setHours(23,59,59,999),_.filter(q=>{const G=new Date(q[F]);return G>=W&&G<=j})},d=u(n,"date"),h=u(r,"date"),g=u(a,"scheduledDate"),p=d.reduce((_,F)=>_+F.total,0),w=d.length,E=w>0?p/w:0,N=new Set(d.map(_=>_.customerId)).size,f=d.reduce((_,F)=>{const W=new Date(F.date).toLocaleDateString("pt-BR");return _[W]=(_[W]||0)+F.total,_},{}),I=Object.entries(f).map(([_,F])=>({date:_,total:F})).slice(-30),b=d.reduce((_,F)=>(F.items.forEach(W=>{_[W.productId]||(_[W.productId]={name:W.productName,quantity:0,revenue:0}),_[W.productId].quantity+=W.quantity,_[W.productId].revenue+=W.total}),_),{}),$=Object.values(b).sort((_,F)=>F.revenue-_.revenue).slice(0,10),k=d.reduce((_,F)=>{const W=t.find(j=>j.id===F.customerId);return W&&(_[W.id]||(_[W.id]={name:W.name,purchases:0,total:0}),_[W.id].purchases+=1,_[W.id].total+=F.total),_},{}),v=Object.values(k).sort((_,F)=>F.total-_.total).slice(0,10),y=h.filter(_=>_.type==="income"&&_.status==="paid").reduce((_,F)=>_+F.amount,0),V=h.filter(_=>_.type==="expense"&&_.status==="paid").reduce((_,F)=>_+F.amount,0),Y=y-V,H={total:g.length,delivered:g.filter(_=>_.status==="delivered").length,pending:g.filter(_=>_.status==="pending").length,inTransit:g.filter(_=>_.status==="in_transit").length,failed:g.filter(_=>_.status==="failed").length},te=[{name:"Entregues",value:H.delivered,color:"#10B981"},{name:"Pendentes",value:H.pending,color:"#F59E0B"},{name:"Em Trnsito",value:H.inTransit,color:"#3B82F6"},{name:"Falharam",value:H.failed,color:"#EF4444"}],oe=_=>{switch(l){case"sales":_==="excel"&&Nt.exportSalesReport(d,t);break;case"customers":_==="excel"&&Nt.exportCustomersReport(t);break;case"products":_==="excel"&&Nt.exportProductsReport(s);break;case"financial":_==="excel"&&Nt.exportFinancialReport(h);break;case"deliveries":_==="pdf"&&Pr.generateDeliveryList(g,t,users);break}},se=[{id:"sales",name:"Vendas",icon:st},{id:"financial",name:"Financeiro",icon:We},{id:"customers",name:"Clientes",icon:ht},{id:"products",name:"Produtos",icon:Pe},{id:"deliveries",name:"Entregas",icon:Me}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-gray-900",children:"Relatrios"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Anlises detalhadas do seu negcio"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(P,{variant:"outline",onClick:()=>oe("pdf"),children:[e.jsx(St,{className:"w-4 h-4 mr-2"}),"Exportar PDF"]}),e.jsxs(P,{variant:"outline",onClick:()=>oe("excel"),children:[e.jsx(St,{className:"w-4 h-4 mr-2"}),"Exportar Excel"]})]})]}),e.jsx(U,{children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ot,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Perodo:"})]}),e.jsx(R,{type:"date",value:i.start,onChange:_=>o({...i,start:_.target.value}),className:"w-auto"}),e.jsx("span",{className:"text-gray-500",children:"at"}),e.jsx(R,{type:"date",value:i.end,onChange:_=>o({...i,end:_.target.value}),className:"w-auto"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Yr,{className:"w-4 h-4 text-gray-400"}),e.jsx("select",{value:l,onChange:_=>c(_.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:se.map(_=>e.jsx("option",{value:_.id,children:_.name},_.id))})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6",children:[e.jsxs(U,{className:"text-center hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-green-100 rounded-lg mx-auto mb-3",children:e.jsx(We,{className:"w-6 h-6 text-green-600"})}),e.jsxs("p",{className:"text-2xl lg:text-3xl font-bold text-green-600 mb-1",children:["R$ ",p.toLocaleString("pt-BR")]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Receita Total"})]}),e.jsxs(U,{className:"text-center hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-blue-100 rounded-lg mx-auto mb-3",children:e.jsx(st,{className:"w-6 h-6 text-blue-600"})}),e.jsx("p",{className:"text-2xl lg:text-3xl font-bold text-blue-600 mb-1",children:w}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total de Vendas"})]}),e.jsxs(U,{className:"text-center hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-purple-100 rounded-lg mx-auto mb-3",children:e.jsx(ht,{className:"w-6 h-6 text-purple-600"})}),e.jsx("p",{className:"text-2xl lg:text-3xl font-bold text-purple-600 mb-1",children:N}),e.jsx("p",{className:"text-sm text-gray-600",children:"Clientes nicos"})]}),e.jsxs(U,{className:"text-center hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-orange-100 rounded-lg mx-auto mb-3",children:e.jsx(Xr,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("p",{className:"text-2xl lg:text-3xl font-bold text-orange-600 mb-1",children:["R$ ",E.toFixed(2)]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Ticket Mdio"})]})]}),l==="sales"&&e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsxs(U,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Vendas por Dia"}),e.jsx(qe,{width:"100%",height:300,children:e.jsxs(na,{data:I,children:[e.jsx(kt,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(Ct,{dataKey:"date",stroke:"#6b7280"}),e.jsx(Et,{stroke:"#6b7280"}),e.jsx(ze,{formatter:_=>[`R$ ${_}`,"Total"],contentStyle:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(ia,{type:"monotone",dataKey:"total",stroke:"#3B82F6",strokeWidth:2})]})})]}),e.jsxs(U,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Top 10 Produtos"}),e.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:$.map((_,F)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-bold text-sm",children:F+1})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:_.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[_.quantity," vendidos"]})]})]}),e.jsxs("span",{className:"font-bold text-green-600",children:["R$ ",_.revenue.toFixed(2)]})]},F))})]})]}),l==="financial"&&e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs(U,{className:"xl:col-span-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Resumo Financeiro"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center p-6 bg-green-50 rounded-lg",children:[e.jsxs("p",{className:"text-3xl font-bold text-green-600 mb-2",children:["R$ ",y.toLocaleString("pt-BR")]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Receitas"})]}),e.jsxs("div",{className:"text-center p-6 bg-red-50 rounded-lg",children:[e.jsxs("p",{className:"text-3xl font-bold text-red-600 mb-2",children:["R$ ",V.toLocaleString("pt-BR")]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Despesas"})]}),e.jsxs("div",{className:"text-center p-6 bg-blue-50 rounded-lg",children:[e.jsxs("p",{className:`text-3xl font-bold mb-2 ${Y>=0?"text-blue-600":"text-red-600"}`,children:["R$ ",Y.toLocaleString("pt-BR")]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Lucro"})]})]})]}),e.jsxs(U,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Margem de Lucro"}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-4xl font-bold mb-2 ${Y>=0?"text-green-600":"text-red-600"}`,children:[y>0?(Y/y*100).toFixed(1):"0.0","%"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Margem sobre receita"})]})]})]}),l==="customers"&&e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsxs(U,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Top 10 Clientes"}),e.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:v.map((_,F)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-purple-600 font-bold text-sm",children:F+1})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:_.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[_.purchases," compras"]})]})]}),e.jsxs("span",{className:"font-bold text-green-600",children:["R$ ",_.total.toFixed(2)]})]},F))})]}),e.jsxs(U,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Anlise de Clientes"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-blue-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-700",children:"Total de Clientes"}),e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:t.length})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-green-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-700",children:"Clientes Ativos"}),e.jsx("span",{className:"text-2xl font-bold text-green-600",children:N})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-purple-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-700",children:"Ticket Mdio"}),e.jsxs("span",{className:"text-2xl font-bold text-purple-600",children:["R$ ",E.toFixed(2)]})]})]})]})]}),l==="deliveries"&&e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsxs(U,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Status das Entregas"}),e.jsx(qe,{width:"100%",height:300,children:e.jsxs(vs,{children:[e.jsx(ys,{data:te,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:5,dataKey:"value",children:te.map((_,F)=>e.jsx(bs,{fill:_.color},`cell-${F}`))}),e.jsx(ze,{})]})}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-4",children:te.map((_,F)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:_.color}}),e.jsxs("span",{className:"text-sm text-gray-600",children:[_.name,": ",_.value]})]},F))})]}),e.jsxs(U,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Estatsticas de Entrega"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-blue-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-700",children:"Total de Entregas"}),e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:H.total})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-green-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-700",children:"Taxa de Sucesso"}),e.jsxs("span",{className:"text-2xl font-bold text-green-600",children:[H.total>0?(H.delivered/H.total*100).toFixed(1):"0","%"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-orange-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-700",children:"Entregas Pendentes"}),e.jsx("span",{className:"text-2xl font-bold text-orange-600",children:H.pending})]})]})]})]}),l==="products"&&e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsxs(U,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Produtos Mais Vendidos"}),e.jsx(qe,{width:"100%",height:300,children:e.jsxs(Zs,{data:$.slice(0,8),children:[e.jsx(kt,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(Ct,{dataKey:"name",stroke:"#6b7280"}),e.jsx(Et,{stroke:"#6b7280"}),e.jsx(ze,{formatter:_=>[_,"Quantidade"],contentStyle:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"8px"}}),e.jsx(Zt,{dataKey:"quantity",fill:"#3B82F6",radius:[4,4,0,0]})]})})]}),e.jsxs(U,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Anlise de Estoque"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-blue-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-700",children:"Total de Produtos"}),e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:s.length})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-red-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-700",children:"Estoque Baixo"}),e.jsx("span",{className:"text-2xl font-bold text-red-600",children:s.filter(_=>_.stock<=_.minStock&&_.isActive).length})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-green-50 rounded-lg",children:[e.jsx("span",{className:"text-gray-700",children:"Produtos Ativos"}),e.jsx("span",{className:"text-2xl font-bold text-green-600",children:s.filter(_=>_.isActive).length})]})]})]})]})]})},eo=()=>{const{users:n,addUser:t,updateUser:s,deleteUser:r}=ye(),[a,i]=C.useState(""),[o,l]=C.useState("all"),[c,u]=C.useState(!1),[d,h]=C.useState(null),[g,p]=C.useState({name:"",email:"",role:"seller",password:"",confirmPassword:"",phone:"",address:"",isActive:!0,permissions:[]}),w=n.filter(y=>{const V=y.name.toLowerCase().includes(a.toLowerCase())||y.email.toLowerCase().includes(a.toLowerCase()),Y=o==="all"||y.role===o;return V&&Y}),E=y=>{y?(h(y),p({name:y.name,email:y.email,role:y.role,password:"",confirmPassword:"",phone:y.phone||"",address:y.address||"",isActive:y.isActive,permissions:y.permissions||[]})):(h(null),p({name:"",email:"",role:"seller",password:"",confirmPassword:"",phone:"",address:"",isActive:!0,permissions:[]})),u(!0)},N=()=>{u(!1),h(null)},f=y=>{if(y.preventDefault(),!d){if(g.password!==g.confirmPassword){const Y=new CustomEvent("showToast",{detail:{type:"error",message:"As senhas no coincidem!"}});window.dispatchEvent(Y);return}if(g.password.length<6){const Y=new CustomEvent("showToast",{detail:{type:"error",message:"A senha deve ter pelo menos 6 caracteres!"}});window.dispatchEvent(Y);return}}const V={name:g.name,email:g.email,role:g.role,phone:g.phone,address:g.address,isActive:g.isActive,permissions:$(g.role),lastLogin:d==null?void 0:d.lastLogin,password:g.password||void 0};d?s(d.id,V):t(V),N()},I=y=>{confirm("Tem certeza que deseja excluir este usurio?")&&r(y)},b=y=>{s(y.id,{isActive:!y.isActive})},$=y=>{switch(y){case"admin":return["all"];case"seller":return["sales","customers","products"];case"delivery":return["deliveries","customers"];case"financial":return["financial","reports"];default:return[]}},k=y=>{switch(y){case"admin":return"bg-purple-100 text-purple-800";case"seller":return"bg-blue-100 text-blue-800";case"delivery":return"bg-green-100 text-green-800";case"financial":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},v=y=>{switch(y){case"admin":return"Administrador";case"seller":return"Vendedor";case"delivery":return"Entregador";case"financial":return"Financeiro";default:return y}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-gray-900",children:"Gesto de Usurios"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Controle de acesso e permisses"})]}),e.jsxs(P,{onClick:()=>E(),className:"w-full sm:w-auto",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Novo Usurio"]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(U,{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-blue-100 rounded-lg mx-auto mb-3",children:e.jsx(ce,{className:"w-6 h-6 text-blue-600"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total de Usurios"})]}),e.jsxs(U,{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-green-100 rounded-lg mx-auto mb-3",children:e.jsx(Ie,{className:"w-6 h-6 text-green-600"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.filter(y=>y.isActive).length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Usurios Ativos"})]}),e.jsxs(U,{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-purple-100 rounded-lg mx-auto mb-3",children:e.jsx(Xs,{className:"w-6 h-6 text-purple-600"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.filter(y=>y.role==="admin").length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Administradores"})]}),e.jsxs(U,{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-orange-100 rounded-lg mx-auto mb-3",children:e.jsx(ce,{className:"w-6 h-6 text-orange-600"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.filter(y=>y.role==="seller").length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Vendedores"})]})]}),e.jsxs(U,{children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(at,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Buscar usurios...",value:a,onChange:y=>i(y.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("select",{value:o,onChange:y=>l(y.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"Todos os cargos"}),e.jsx("option",{value:"admin",children:"Administrador"}),e.jsx("option",{value:"seller",children:"Vendedor"}),e.jsx("option",{value:"delivery",children:"Entregador"}),e.jsx("option",{value:"financial",children:"Financeiro"})]})})]}),e.jsx("div",{className:"lg:hidden space-y-4",children:w.map(y=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(ce,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:y.name}),e.jsx("p",{className:"text-sm text-gray-600",children:y.email})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${k(y.role)}`,children:v(y.role)}),e.jsx("div",{className:`w-3 h-3 rounded-full ${y.isActive?"bg-green-500":"bg-red-500"}`})]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[y.phone&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Telefone:"}),e.jsx("span",{className:"font-medium",children:y.phone})]}),y.lastLogin&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"ltimo acesso:"}),e.jsx("span",{className:"font-medium",children:new Date(y.lastLogin).toLocaleDateString("pt-BR")})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{size:"sm",variant:"outline",onClick:()=>E(y),children:e.jsx(ge,{className:"w-3 h-3"})}),e.jsx(P,{size:"sm",variant:"danger",onClick:()=>I(y.id),children:e.jsx(ue,{className:"w-3 h-3"})})]}),e.jsx(P,{size:"sm",variant:y.isActive?"outline":"success",onClick:()=>b(y),children:y.isActive?e.jsx(Xt,{className:"w-3 h-3"}):e.jsx(Ie,{className:"w-3 h-3"})})]})]},y.id))}),e.jsxs("div",{className:"hidden lg:block overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Usurio"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Cargo"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Contato"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"ltimo Acesso"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-gray-600",children:"Aes"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:w.map(y=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(ce,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:y.name}),e.jsx("p",{className:"text-sm text-gray-500",children:y.email})]})]})}),e.jsx("td",{className:"py-4 px-2",children:e.jsx("span",{className:`inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium ${k(y.role)}`,children:v(y.role)})}),e.jsx("td",{className:"py-4 px-2 text-gray-600",children:y.phone||"-"}),e.jsx("td",{className:"py-4 px-2 text-gray-600",children:y.lastLogin?new Date(y.lastLogin).toLocaleDateString("pt-BR"):"Nunca"}),e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${y.isActive?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:`text-sm font-medium ${y.isActive?"text-green-600":"text-red-600"}`,children:y.isActive?"Ativo":"Inativo"})]})}),e.jsx("td",{className:"py-4 px-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{size:"sm",variant:"outline",onClick:()=>E(y),children:e.jsx(ge,{className:"w-3 h-3"})}),e.jsx(P,{size:"sm",variant:y.isActive?"outline":"success",onClick:()=>b(y),children:y.isActive?e.jsx(Xt,{className:"w-3 h-3"}):e.jsx(Ie,{className:"w-3 h-3"})}),e.jsx(P,{size:"sm",variant:"danger",onClick:()=>I(y.id),children:e.jsx(ue,{className:"w-3 h-3"})})]})})]},y.id))})]}),w.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ce,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Nenhum usurio encontrado"})]})]})]}),e.jsx(ve,{isOpen:c,onClose:N,title:d?"Editar Usurio":"Novo Usurio",size:"lg",children:e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Nome Completo",value:g.name,onChange:y=>p({...g,name:y.target.value}),required:!0}),e.jsx(R,{label:"Email",type:"email",value:g.email,onChange:y=>p({...g,email:y.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cargo"}),e.jsxs("select",{value:g.role,onChange:y=>p({...g,role:y.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"seller",children:"Vendedor"}),e.jsx("option",{value:"delivery",children:"Entregador"}),e.jsx("option",{value:"financial",children:"Financeiro"}),e.jsx("option",{value:"admin",children:"Administrador"})]})]}),e.jsx(R,{label:"Telefone",value:g.phone,onChange:y=>p({...g,phone:y.target.value})})]}),!d&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Senha",type:"password",value:g.password,onChange:y=>p({...g,password:y.target.value}),required:!d,placeholder:"Mnimo 6 caracteres"}),e.jsx(R,{label:"Confirmar Senha",type:"password",value:g.confirmPassword,onChange:y=>p({...g,confirmPassword:y.target.value}),required:!d,placeholder:"Confirme a senha"})]}),e.jsx(R,{label:"Endereo",value:g.address,onChange:y=>p({...g,address:y.target.value})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"isActive",checked:g.isActive,onChange:y=>p({...g,isActive:y.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"isActive",className:"text-sm font-medium text-gray-700",children:"Usurio ativo"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(P,{type:"button",variant:"outline",onClick:N,children:"Cancelar"}),e.jsxs(P,{type:"submit",children:[d?"Atualizar":"Criar"," Usurio"]})]})]})})]})},Fe=class Fe{static getInstance(){return Fe.instance||(Fe.instance=new Fe),Fe.instance}exportData(){const t={products:JSON.parse(localStorage.getItem("products")||"[]"),customers:JSON.parse(localStorage.getItem("customers")||"[]"),sales:JSON.parse(localStorage.getItem("sales")||"[]"),transactions:JSON.parse(localStorage.getItem("transactions")||"[]"),deliveries:JSON.parse(localStorage.getItem("deliveries")||"[]"),users:JSON.parse(localStorage.getItem("users")||"[]"),company:JSON.parse(localStorage.getItem("company")||"{}"),settings:JSON.parse(localStorage.getItem("settings")||"{}"),exportDate:new Date().toISOString()};return JSON.stringify(t,null,2)}importData(t){try{const s=JSON.parse(t),r=["products","customers","sales","transactions","deliveries","users"];for(const a of r)if(!Array.isArray(s[a]))throw new Error(`Invalid data structure: ${a} must be an array`);return Object.keys(s).forEach(a=>{a!=="exportDate"&&localStorage.setItem(a,JSON.stringify(s[a]))}),!0}catch(s){return console.error("Import failed:",s),!1}}clearAllData(){["products","customers","sales","transactions","deliveries","users","company","settings"].forEach(s=>localStorage.removeItem(s))}validateData(){const t=[];try{const s=JSON.parse(localStorage.getItem("products")||"[]"),r=JSON.parse(localStorage.getItem("customers")||"[]"),a=JSON.parse(localStorage.getItem("sales")||"[]");s.forEach((i,o)=>{(!i.id||!i.name||typeof i.price!="number")&&t.push(`Product at index ${o} is invalid`)}),r.forEach((i,o)=>{(!i.id||!i.name||!i.document)&&t.push(`Customer at index ${o} is invalid`)}),a.forEach((i,o)=>{r.some(c=>c.id===i.customerId)||t.push(`Sale at index ${o} references non-existent customer`)})}catch{t.push("Data corruption detected")}return{isValid:t.length===0,errors:t}}};vt(Fe,"instance");let ms=Fe;const to=()=>{var F,W,j,q,G,X,K,re,be;const{company:n,settings:t,updateCompany:s,updateSettings:r,users:a,updateUser:i}=ye(),{user:o}=pt(),{isDark:l,toggleTheme:c}=Er(),[u,d]=C.useState("company"),[h,g]=C.useState(n),[p,w]=C.useState(t),[E,N]=C.useState(o||{}),[f,I]=C.useState({isOpen:!1,type:""}),[b,$]=C.useState(!1),k=ms.getInstance(),v=()=>{s(h);const x=new CustomEvent("showToast",{detail:{type:"success",message:"Dados da empresa salvos com sucesso!"}});window.dispatchEvent(x)},y=()=>{r(p);const x=new CustomEvent("showToast",{detail:{type:"success",message:"Configuraes salvas com sucesso!"}});window.dispatchEvent(x)},V=()=>{const x=k.exportData(),D=new Blob([x],{type:"application/json"}),L=URL.createObjectURL(D),S=document.createElement("a");S.href=L,S.download=`gas-gestao-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(L)},Y=x=>{var S;const D=(S=x.target.files)==null?void 0:S[0];if(!D)return;const L=new FileReader;L.onload=T=>{var O;const A=(O=T.target)==null?void 0:O.result;if(k.importData(A)){const B=new CustomEvent("showToast",{detail:{type:"success",message:"Dados importados com sucesso! Recarregue a pgina."}});window.dispatchEvent(B)}else{const B=new CustomEvent("showToast",{detail:{type:"error",message:"Erro ao importar dados. Verifique o arquivo."}});window.dispatchEvent(B)}},L.readAsText(D)},H=()=>{k.clearAllData();const x=new CustomEvent("showToast",{detail:{type:"success",message:"Todos os dados foram removidos! Recarregue a pgina."}});window.dispatchEvent(x)},te=[{id:"company",name:"Empresa",icon:Es},{id:"profile",name:"Meu Perfil",icon:ce},{id:"notifications",name:"Notificaes",icon:fs},{id:"integrations",name:"Integraes",icon:Ts},{id:"features",name:"Recursos",icon:Xs},{id:"system",name:"Sistema",icon:xs},{id:"backup",name:"Backup",icon:St}],oe=x=>{var L;const D=(L=x.target.files)==null?void 0:L[0];if(D){const S=new FileReader;S.onload=T=>{var m;const A=(m=T.target)==null?void 0:m.result;g({...h,logo:A})},S.readAsDataURL(D)}},se=x=>{var L;const D=(L=x.target.files)==null?void 0:L[0];if(D){const S=new FileReader;S.onload=T=>{var m;const A=(m=T.target)==null?void 0:m.result;N({...E,avatar:A})},S.readAsDataURL(D)}},_=()=>{if(o){i(o.id,E);const x=new CustomEvent("showToast",{detail:{type:"success",message:"Perfil atualizado com sucesso!"}});window.dispatchEvent(x)}};return e.jsxs("div",{className:"space-y-6 min-h-screen bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-gray-900",children:"Configuraes"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie as configuraes do sistema"})]}),e.jsxs("div",{className:"flex flex-col xl:flex-row gap-6",children:[e.jsx("div",{className:"xl:w-80",children:e.jsx(U,{padding:!1,children:e.jsx("nav",{className:"space-y-1 p-4",children:te.map(x=>e.jsxs("button",{onClick:()=>d(x.id),className:`w-full flex items-center space-x-3 px-3 py-2 text-left rounded-lg transition-colors ${u===x.id?"bg-blue-50 text-blue-700 border-l-4 border-blue-600":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"}`,children:[e.jsx(x.icon,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:x.name})]},x.id))})})}),e.jsxs("div",{className:"flex-1",children:[u==="company"&&e.jsxs(U,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Dados da Empresa"}),e.jsxs(P,{onClick:v,children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),"Salvar"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Nome da Empresa",value:h.name,onChange:x=>g({...h,name:x.target.value})}),e.jsx(R,{label:"CNPJ",value:h.document,onChange:x=>g({...h,document:x.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Telefone",value:h.phone,onChange:x=>g({...h,phone:x.target.value})}),e.jsx(R,{label:"Email",type:"email",value:h.email,onChange:x=>g({...h,email:x.target.value})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-4",children:"Logo da Empresa"}),e.jsxs("div",{className:"flex items-center space-x-6 mb-6",children:[e.jsx("div",{className:"w-40 h-40 bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden border-2 border-dashed border-gray-300",children:h.logo?e.jsx("img",{src:h.logo,alt:"Logo",className:"w-full h-full object-cover"}):e.jsxs("div",{className:"text-center",children:[e.jsx(Es,{className:"w-16 h-16 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Logo da Empresa"})]})}),e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:"image/*",onChange:oe,className:"hidden",id:"logo-upload"}),e.jsx("label",{htmlFor:"logo-upload",children:e.jsxs(P,{variant:"outline",as:"span",children:[e.jsx(Ps,{className:"w-4 h-4 mr-2"}),"Alterar Logo"]})}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Formatos aceitos: PNG, JPG, GIF",e.jsx("br",{}),"Tamanho mximo: 2MB",e.jsx("br",{}),"Recomendado: 400x400px"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-4",children:"Endereo"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(R,{label:"Logradouro",value:h.address.street,onChange:x=>g({...h,address:{...h.address,street:x.target.value}})})}),e.jsx(R,{label:"Nmero",value:h.address.number,onChange:x=>g({...h,address:{...h.address,number:x.target.value}})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:[e.jsx(R,{label:"Bairro",value:h.address.district,onChange:x=>g({...h,address:{...h.address,district:x.target.value}})}),e.jsx(R,{label:"Cidade",value:h.address.city,onChange:x=>g({...h,address:{...h.address,city:x.target.value}})}),e.jsx(R,{label:"CEP",value:h.address.zipCode,onChange:x=>g({...h,address:{...h.address,zipCode:x.target.value}})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-4",children:"Configuraes de Entrega"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Raio de Entrega (km)",type:"number",value:h.deliveryRadius,onChange:x=>g({...h,deliveryRadius:parseInt(x.target.value)})}),e.jsx(R,{label:"Valor Mnimo para Entrega (R$)",type:"number",step:"0.01",value:h.minimumDeliveryValue,onChange:x=>g({...h,minimumDeliveryValue:parseFloat(x.target.value)})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-4",children:"Redes Sociais"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"WhatsApp",value:((F=h.socialMedia)==null?void 0:F.whatsapp)||"",onChange:x=>g({...h,socialMedia:{...h.socialMedia,whatsapp:x.target.value}}),placeholder:"(11) 99999-9999"}),e.jsx(R,{label:"Instagram",value:((W=h.socialMedia)==null?void 0:W.instagram)||"",onChange:x=>g({...h,socialMedia:{...h.socialMedia,instagram:x.target.value}}),placeholder:"@empresa"})]})]})]})]}),u==="profile"&&e.jsxs(U,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Meu Perfil"}),e.jsxs(P,{onClick:_,children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),"Salvar"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-4",children:"Foto do Perfil"}),e.jsxs("div",{className:"flex items-center space-x-6 mb-6",children:[e.jsx("div",{className:"w-32 h-32 bg-gray-100 rounded-full flex items-center justify-center overflow-hidden",children:E.avatar?e.jsx("img",{src:E.avatar,alt:"Avatar",className:"w-full h-full object-cover"}):e.jsx(ce,{className:"w-12 h-12 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:"image/*",onChange:se,className:"hidden",id:"avatar-upload"}),e.jsx("label",{htmlFor:"avatar-upload",children:e.jsxs(P,{variant:"outline",as:"span",children:[e.jsx(Ps,{className:"w-4 h-4 mr-2"}),"Alterar Foto"]})}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["PNG, JPG at 2MB",e.jsx("br",{}),"Recomendado: 200x200px"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Nome Completo",value:E.name||"",onChange:x=>N({...E,name:x.target.value})}),e.jsx(R,{label:"Email",type:"email",value:E.email||"",onChange:x=>N({...E,email:x.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(R,{label:"Telefone",value:E.phone||"",onChange:x=>N({...E,phone:x.target.value})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cargo"}),e.jsx("div",{className:"px-3 py-2 bg-gray-100 border border-gray-300 rounded-lg text-gray-900 capitalize",children:E.role==="admin"?"Administrador":E.role==="seller"?"Vendedor":E.role==="delivery"?"Entregador":"Financeiro"})]})]}),e.jsx(R,{label:"Endereo",value:E.address||"",onChange:x=>N({...E,address:x.target.value})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-4",children:"Alterar Senha"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(R,{label:"Nova Senha",type:b?"text":"password",placeholder:"Digite a nova senha"}),e.jsx("button",{type:"button",onClick:()=>$(!b),className:"absolute right-3 top-8 text-gray-400 hover:text-gray-600",children:b?e.jsx(Xt,{className:"w-4 h-4"}):e.jsx(Ie,{className:"w-4 h-4"})})]}),e.jsx(R,{label:"Confirmar Senha",type:b?"text":"password",placeholder:"Confirme a nova senha"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-6 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-3",children:"Informaes da Conta"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700",children:"ltimo acesso:"}),e.jsx("span",{className:"font-medium text-blue-900",children:E.lastLogin?new Date(E.lastLogin).toLocaleString("pt-BR"):"Nunca"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700",children:"Status:"}),e.jsx("span",{className:`font-medium ${E.isActive?"text-green-600":"text-red-600"}`,children:E.isActive?"Ativo":"Inativo"})]})]})]})]})]}),u==="notifications"&&e.jsxs(U,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Notificaes"}),e.jsxs(P,{onClick:y,children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),"Salvar"]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-lg",children:"Notificaes por Email"}),e.jsx("p",{className:"text-gray-600",children:"Receber notificaes importantes por email"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p.notifications.email,onChange:x=>w({...p,notifications:{...p.notifications,email:x.target.checked}}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-lg",children:"Notificaes por SMS"}),e.jsx("p",{className:"text-gray-600",children:"Receber alertas importantes por SMS"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p.notifications.sms,onChange:x=>w({...p,notifications:{...p.notifications,sms:x.target.checked}}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-lg",children:"Notificaes por WhatsApp"}),e.jsx("p",{className:"text-gray-600",children:"Receber notificaes via WhatsApp"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p.notifications.whatsapp,onChange:x=>w({...p,notifications:{...p.notifications,whatsapp:x.target.checked}}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})]})})]}),u==="integrations"&&e.jsxs(U,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Integraes"}),e.jsxs(P,{onClick:y,children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),"Salvar"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(Ts,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"WhatsApp API"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Integrao para envio automtico de mensagens"})]})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((j=p.integrations.whatsappApi)==null?void 0:j.enabled)||!1,onChange:x=>w({...p,integrations:{...p.integrations,whatsappApi:{...p.integrations.whatsappApi,enabled:x.target.checked}}}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),((q=p.integrations.whatsappApi)==null?void 0:q.enabled)&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(R,{label:"Token da API",value:((G=p.integrations.whatsappApi)==null?void 0:G.token)||"",onChange:x=>w({...p,integrations:{...p.integrations,whatsappApi:{...p.integrations.whatsappApi,token:x.target.value}}}),placeholder:"Insira o token da API do WhatsApp"}),e.jsx(R,{label:"Nmero do WhatsApp",value:((X=p.integrations.whatsappApi)==null?void 0:X.phoneNumber)||"",onChange:x=>w({...p,integrations:{...p.integrations,whatsappApi:{...p.integrations.whatsappApi,phoneNumber:x.target.value}}}),placeholder:"(11) 99999-9999"})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Zr,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Gateway de Pagamento"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Integrao para processamento de pagamentos"})]})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((K=p.integrations.paymentGateway)==null?void 0:K.enabled)||!1,onChange:x=>w({...p,integrations:{...p.integrations,paymentGateway:{...p.integrations.paymentGateway,enabled:x.target.checked}}}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),((re=p.integrations.paymentGateway)==null?void 0:re.enabled)&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Provedor"}),e.jsxs("select",{value:((be=p.integrations.paymentGateway)==null?void 0:be.provider)||"",onChange:x=>w({...p,integrations:{...p.integrations,paymentGateway:{...p.integrations.paymentGateway,provider:x.target.value}}}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione um provedor"}),e.jsx("option",{value:"stripe",children:"Stripe"}),e.jsx("option",{value:"mercadopago",children:"Mercado Pago"}),e.jsx("option",{value:"pagseguro",children:"PagSeguro"})]})]})})]})]})]}),u==="features"&&e.jsxs(U,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Recursos do Sistema"}),e.jsxs(P,{onClick:y,children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),"Salvar"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-lg",children:"Mdulo de Entregas"}),e.jsx("p",{className:"text-gray-600",children:"Ativar sistema de controle de entregas"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p.features.deliveryModule,onChange:x=>w({...p,features:{...p.features,deliveryModule:x.target.checked}}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-lg",children:"Gerao de Notas Fiscais"}),e.jsx("p",{className:"text-gray-600",children:"Ativar emisso automtica de notas fiscais"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p.features.invoiceGeneration,onChange:x=>w({...p,features:{...p.features,invoiceGeneration:x.target.checked}}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-lg",children:"Mltiplas Formas de Pagamento"}),e.jsx("p",{className:"text-gray-600",children:"Permitir diferentes mtodos de pagamento"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p.features.multiplePaymentMethods,onChange:x=>w({...p,features:{...p.features,multiplePaymentMethods:x.target.checked}}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-lg",children:"Portal do Cliente"}),e.jsx("p",{className:"text-gray-600",children:"Permitir que clientes acessem seus dados"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p.features.customerPortal,onChange:x=>w({...p,features:{...p.features,customerPortal:x.target.checked}}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})]})]}),u==="system"&&e.jsxs(U,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Configuraes do Sistema"}),e.jsxs(P,{onClick:y,children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),"Salvar"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-xl font-semibold text-blue-900 mb-4",children:"Informaes do Sistema"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 block font-medium",children:"Verso:"}),e.jsx("span",{className:"text-blue-900",children:"Gas Gesto+ v2.0.0"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 block font-medium",children:"ltima Atualizao:"}),e.jsx("span",{className:"text-blue-900",children:new Date().toLocaleDateString("pt-BR")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 block font-medium",children:"Licena:"}),e.jsx("span",{className:"text-blue-900",children:"Comercial"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 block font-medium",children:"Suporte:"}),e.jsx("span",{className:"text-blue-900",children:"Ativo"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-lg",children:"Modo de Produo"}),e.jsx("p",{className:"text-gray-600",children:"Sistema configurado para ambiente de produo"})]}),e.jsx("span",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium",children:"Ativo"})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-lg",children:"Backup Automtico"}),e.jsx("p",{className:"text-gray-600",children:"Backup dirio dos dados do sistema"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:!0,className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-lg",children:"Logs do Sistema"}),e.jsx("p",{className:"text-gray-600",children:"Registrar atividades do sistema"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:!0,className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})]})]})]}),u==="backup"&&e.jsxs(U,{children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Backup e Restaurao"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-4",children:"Exportar Dados"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Faa backup de todos os dados do sistema em um arquivo JSON."}),e.jsxs(P,{onClick:V,children:[e.jsx(St,{className:"w-4 h-4 mr-2"}),"Exportar Backup"]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-4",children:"Importar Dados"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Restaure dados de um arquivo de backup. Isso substituir todos os dados atuais."}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"file",accept:".json",onChange:Y,className:"hidden",id:"import-file"}),e.jsx("label",{htmlFor:"import-file",children:e.jsxs(P,{variant:"outline",as:"span",children:[e.jsx(ea,{className:"w-4 h-4 mr-2"}),"Selecionar Arquivo"]})})]})]}),e.jsxs("div",{className:"border border-red-200 rounded-lg p-6 bg-red-50",children:[e.jsx("h3",{className:"text-xl font-medium text-red-900 mb-4",children:"Zona de Perigo"}),e.jsx("p",{className:"text-red-700 mb-4",children:"Esta ao remover permanentemente todos os dados do sistema."}),e.jsxs(P,{variant:"danger",onClick:()=>I({isOpen:!0,type:"clear"}),children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Limpar Todos os Dados"]})]})]})]})]})]}),e.jsx(ks,{isOpen:f.isOpen,onClose:()=>I({isOpen:!1,type:""}),onConfirm:H,title:"Limpar Todos os Dados",message:"Esta ao remover permanentemente todos os dados do sistema. Esta ao no pode ser desfeita.",confirmText:"Limpar Dados",cancelText:"Cancelar"})]})},Ne=({children:n})=>{const{isAuthenticated:t}=pt();return t?e.jsx(e.Fragment,{children:n}):e.jsx(ps,{to:"/login",replace:!0})},so=()=>e.jsxs(ra,{children:[e.jsx(me,{path:"/login",element:e.jsx(Gi,{})}),e.jsx(me,{path:"/",element:e.jsx(Ne,{children:e.jsx(we,{children:e.jsx(Ji,{})})})}),e.jsx(me,{path:"/products",element:e.jsx(Ne,{children:e.jsx(we,{children:e.jsx(Ki,{})})})}),e.jsx(me,{path:"/customers",element:e.jsx(Ne,{children:e.jsx(we,{children:e.jsx(Hi,{})})})}),e.jsx(me,{path:"/sales",element:e.jsx(Ne,{children:e.jsx(we,{children:e.jsx(Qi,{})})})}),e.jsx(me,{path:"/deliveries",element:e.jsx(Ne,{children:e.jsx(we,{children:e.jsx(Yi,{})})})}),e.jsx(me,{path:"/financial",element:e.jsx(Ne,{children:e.jsx(we,{children:e.jsx(Xi,{})})})}),e.jsx(me,{path:"/reports",element:e.jsx(Ne,{children:e.jsx(we,{children:e.jsx(Zi,{})})})}),e.jsx(me,{path:"/users",element:e.jsx(Ne,{children:e.jsx(we,{children:e.jsx(eo,{})})})}),e.jsx(me,{path:"/settings",element:e.jsx(Ne,{children:e.jsx(we,{children:e.jsx(to,{})})})}),e.jsx(me,{path:"*",element:e.jsx(ps,{to:"/",replace:!0})})]});function ro(){return e.jsx(Oi,{children:e.jsx(sa,{children:e.jsx(Ai,{children:e.jsxs(Li,{children:[e.jsx(so,{}),e.jsx(Ui,{}),e.jsx(zi,{})]})})})})}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(n=>{It.info("SW registered: ",n)}).catch(n=>{It.error("SW registration failed: ",n)})});It.info(" Gas Gesto+ iniciando...",{version:"2.0.0",environment:"production",timestamp:new Date().toISOString()});sr(document.getElementById("root")).render(e.jsx(C.StrictMode,{children:e.jsx(ro,{})}));
